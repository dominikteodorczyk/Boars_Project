<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>src.epr_trajectory API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../src.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;src</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#EPRTrajectory">EPRTrajectory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EPRTrajectory.__init__">EPRTrajectory</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.logger">logger</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.config_manager">config_manager</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.n_agents">n_agents</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.start_time">start_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.end_time">end_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.output_dir_path">output_dir_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.beta">beta</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.gamma">gamma</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.rho">rho</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.filtered_data_means">filtered_data_means</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.raw_trajectory">raw_trajectory</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.tessellation">tessellation</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.starting_positions">starting_positions</a>
                        </li>
                        <li>
                                <a class="variable" href="#EPRTrajectory.geo_processor">geo_processor</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.longest_visited_row">longest_visited_row</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.truncated_power_law_pdf">truncated_power_law_pdf</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.log_likelihood">log_likelihood</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.estimate_beta_tau_mle">estimate_beta_tau_mle</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.param_estimate">param_estimate</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.process_generated_trajectory">process_generated_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.find_best_fit">find_best_fit</a>
                        </li>
                        <li>
                                <a class="function" href="#EPRTrajectory.generate_trajectory">generate_trajectory</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../src.html">src</a><wbr>.epr_trajectory    </h1>

                
                        <input id="mod-epr_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-epr_trajectory-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">distfit</span><span class="w"> </span><span class="kn">import</span> <span class="n">distfit</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">linregress</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">skmob.models.epr</span><span class="w"> </span><span class="kn">import</span> <span class="n">DensityEPR</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">geo_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeoProcessor</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">trajectory_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">TrajectoryProcessor</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">config_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigManager</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EPRTrajectory</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Class to simulate trajectories using the EPR (Exploration and Preferential Return) model.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    It estimates model parameters from filtered trajectory data and generates synthetic trajectories.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_manager</span><span class="p">:</span> <span class="n">ConfigManager</span><span class="p">,</span> <span class="n">filtered_data_means</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>                 <span class="n">raw_trajectory</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">starting_positions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>                 <span class="n">start_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>                 <span class="n">output_dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        Initialize the EPRTrajectory with configuration and data. Estimate model parameters.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        Args:</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">            config_manager (ConfigManager): Configuration manager with settings.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">            filtered_data_means (gpd.GeoDataFrame): Filtered trajectory data with mean points for each label.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">            raw_trajectory (gpd.GeoDataFrame): Raw trajectory data.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            tessellation (gpd.GeoDataFrame): Spatial tessellation for the area.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            starting_positions (list): List of starting positions (grid IDs) for agents.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            start_time (pd.Timestamp | None): Start time for trajectory generation.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">            end_time (pd.Timestamp | None): End time for trajectory generation.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">            n_agents (int | None): Number of agents to simulate.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">            output_dir_path (str): Directory path to save output files.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">config_manager</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;EPR&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span> <span class="o">=</span> <span class="n">n_agents</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">end_time</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">output_dir_path</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span> <span class="o">=</span> <span class="n">filtered_data_means</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span> <span class="o">=</span> <span class="n">raw_trajectory</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">tessellation</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span> <span class="o">=</span> <span class="n">starting_positions</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_estimate</span><span class="p">()</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span> <span class="o">=</span> <span class="n">GeoProcessor</span><span class="p">()</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="c1"># Resample by 1-hour interval and select the label with the longest duration</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">longest_visited_row</span><span class="p">(</span><span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Returns the row where the individual spent the longest time in an interval. If the group is empty, returns</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        an empty Series. If multiple rows have the same longest duration, returns the first one.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Args:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            group (pd.DataFrame): Grouped DataFrame for an individual in a time interval.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Returns:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">            pd.Series: Row with the longest duration or an empty Series if the group is empty.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>  <span class="c1"># Ensure an empty series is returned</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">max_label</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># Find label with longest total duration</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="c1"># Select first row where this label appears</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_label</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Return full row</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Truncated power-law probability density function (PDF).</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Args:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            x (float): Value to evaluate the PDF at.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            beta (float): Power-law exponent.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            tau (float): Exponential cutoff parameter.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        Returns:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            float: Value of the PDF at x.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Log-likelihood function for the truncated power-law distribution.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Args:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">            params (list): List containing [beta, tau] parameters.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        Returns:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">            float: Negative log-likelihood value.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tau</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">)))</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">normalization</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">ll</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">normalization</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="o">-</span><span class="n">ll</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_beta_tau_mle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Estimate the parameters beta and tau of the truncated power-law distribution using</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        Maximum Likelihood Estimation (MLE).</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        1. Initial guess for beta and tau.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        2. Bounds for beta and tau to ensure they are positive.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        3. Use scipy.optimize.minimize to find the parameters that minimize the negative log-likelihood.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Args:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">            tuple[float | None, float | None]: Estimated (beta, tau) parameters or (None, None) if optimization fails.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        The estimation process involves:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">]</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization failed. Message: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">param_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        Estimate the EPR model parameters ($\gamma$ and $\rho$) from the raw trajectory data.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        Steps:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        1. Resample the trajectory data to 1-hour intervals, selecting the label with the longest duration</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        in each interval.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        2. Identify when a new place is visited and compute the cumulative number of distinct places visited, $S(t)$.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        3. Fit:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">           - $n(t) \sim t^{\beta}$</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">           - $S(t) \sim t^{\alpha}$</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">           using linear regression on log-log transformed data.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        4. Compute $\gamma$ from the relationship:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">           $$</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">           \alpha = \frac{\beta}{1 + \gamma}</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">           $$</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        5. Compute $\rho$ from the prefactor relationship involving $K_{\text{est}}$, $C_{\text{est}}$, and $\gamma$.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        Returns:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">            None: Updates the instance variables `self.gamma` and `self.rho` with estimated values.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">to_concat</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="o">~</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>  <span class="c1"># Remove duplicate timestamps within the same individual</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>                <span class="k">continue</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="n">group</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Set time as the index for time-based operations</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;moved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;moved&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="c1"># Fill missing data using forward-fill and backward-fill</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="c1"># Store processed data for concatenation</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="n">to_concat</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_resampled</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># Combine all processed individual datasets back into a single DataFrame</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="k">return</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="c1"># Identify when a new place is visited for each individual</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">~</span><span class="n">x</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="c1"># Compute cumulative number of distinct places visited (S(t)) for each individual</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">is_new</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="c1"># Compute the median number of observations per individual (to determine a common max time step) - cast to integer</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="c1"># Prepare averaged data for population-level analysis</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="c1"># n_data: Sequence of step indices (1 to nrows)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="c1"># S_data: Mean S(n) across all individuals at each time step</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="n">S_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="c1"># 1. Fit n(t) ~ t^beta - steps vs time</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">log_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">log_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">slope_n</span><span class="p">,</span> <span class="n">intercept_n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_n</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">beta_est</span> <span class="o">=</span> <span class="n">slope_n</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">C_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_n</span><span class="p">)</span>  <span class="c1"># n(t) ~ C_est * t^beta_est</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># 2. Fit S(t) ~ t^alpha</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">log_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">slope_s</span><span class="p">,</span> <span class="n">intercept_s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_S</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">alpha_est</span> <span class="o">=</span> <span class="n">slope_s</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">K_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_s</span><span class="p">)</span>  <span class="c1"># S(t) ~ K_est * t^alpha_est</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="c1"># 3. Compute gamma from alpha = beta / (1 + gamma)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="n">gamma_est</span> <span class="o">=</span> <span class="n">beta_est</span> <span class="o">/</span> <span class="n">alpha_est</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="c1"># 4. Compute rho from the prefactor</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="c1"># We have: K_est = (1 + gamma) * [rho * C_est]^(1/(1 + gamma))</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="c1"># =&gt; ln(K_est) = ln(1 + gamma_est) + (1/(1 + gamma_est)) [ln(rho) + ln(C_est)]</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="c1"># Solve for rho:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="c1">#    ln(rho) = (1 + gamma_est)* [ ln(K_est) - ln(1 + gamma_est) ] - ln(C_est)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="c1"># (Some algebra rearranging the terms.)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="c1"># It&#39;s often easier to do it step by step:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K_est</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="n">den</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="c1"># =&gt; num / den = ln(rho) + ln(C_est)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">C_est</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">rho_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="c1"># self.beta = beta_est</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="c1"># self.alpha = alpha_est</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_est</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho_est</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Estimated parameters:&quot;</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  beta (from n(t)):   </span><span class="si">{</span><span class="n">beta_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  alpha (from S(t)):  </span><span class="si">{</span><span class="n">alpha_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  gamma:              </span><span class="si">{</span><span class="n">gamma_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  rho:                </span><span class="si">{</span><span class="n">rho_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_generated_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synt_traj</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        Process the generated trajectory to match the format of the original data. Assign tessellation IDs and resample</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        to 1-hour intervals.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        Steps:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">            1. Convert the generated trajectory to a GeoDataFrame and set the coordinate reference system (CRS).</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">            2. Perform a spatial join with the tessellation to assign tessellation IDs to each point.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">            3. Rename columns to match the original data format.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">            4. Resample the trajectory to 1-hour intervals, ensuring that each agent&#39;s trajectory is continuous.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            5. Create a new GeoDataFrame with the resampled data, including latitude and longitude columns.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        Args:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            synt_traj (gpd.GeoDataFrame): Generated trajectory from the EPR model.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        Returns:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">            gpd.GeoDataFrame: Processed trajectory with tessellation IDs and resampled to 1-hour intervals.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">trajectory_processor</span> <span class="o">=</span> <span class="n">TrajectoryProcessor</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">generated_traj</span> <span class="o">=</span> <span class="n">synt_traj</span><span class="o">.</span><span class="n">to_geodataframe</span><span class="p">()</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">generated_traj_joined_with_tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                                                            <span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">generated_traj</span><span class="p">[</span><span class="s1">&#39;tessellation_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generated_traj_joined_with_tessellation</span><span class="p">[</span><span class="s1">&#39;index_right&#39;</span><span class="p">]</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">resampled_generated_traj</span> <span class="o">=</span> <span class="n">trajectory_processor</span><span class="o">.</span><span class="n">resample_time</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="s1">&#39;1h&#39;</span><span class="p">,</span> <span class="s1">&#39;tessellation_id&#39;</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                               <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                               <span class="n">crs</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">gdf</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">distfit</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        Fit various statistical distributions to the waiting times derived from the trajectory data and identify the</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        best-fitting distribution.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Steps:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">            1. Compressing the trajectory to identify distinct locations and their associated waiting times.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            2. Calculating waiting times as the duration spent at each location.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            3. Using the `distfit` library to fit a range of distributions to the waiting time data.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            4. Evaluating the goodness-of-fit using the Wasserstein distance metric.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">            5. Plotting the best-fitting distribution against the empirical data for visual assessment.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">            6. Saving the plots to the specified output directory.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">            distfit: Fitted distfit object containing the best-fitting distribution and parameters.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">trajectory_compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">trajectory_compression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="n">waiting_times_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">waiting_times</span><span class="p">(</span><span class="n">trajectory_compressed</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="n">dfit</span> <span class="o">=</span> <span class="n">distfit</span><span class="p">(</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="n">distr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="s1">&#39;expon&#39;</span><span class="p">,</span> <span class="s1">&#39;pareto&#39;</span><span class="p">,</span> <span class="s1">&#39;dweibull&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;genextreme&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;lognorm&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                   <span class="s1">&#39;loggamma&#39;</span><span class="p">,</span> <span class="s1">&#39;truncexpon&#39;</span><span class="p">,</span> <span class="s1">&#39;truncnorm&#39;</span><span class="p">,</span> <span class="s1">&#39;truncpareto&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">],</span> <span class="n">stats</span><span class="o">=</span><span class="s2">&quot;wasserstein&quot;</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">waiting_times_df</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">])</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best fit: </span><span class="si">{</span><span class="n">dfit</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit.png&quot;</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">pdf_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#472D30&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">},</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">bar_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="n">cii_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">emp_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#E26D5C&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">},</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit_.png&quot;</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="n">dfit</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        Generate synthetic trajectories using the EPR model with estimated parameters.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">        Steps:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">            1. Copying the starting positions for agents.</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">            2. Finding the best-fitting distribution for waiting times using the `find_best_fit` method.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">            3. Initializing the DensityEPR model with the estimated parameters (rho and gamma).</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">            4. Generating synthetic trajectories for the specified number of agents over the defined time period and</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">            spatial tessellation.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">            5. Processing the generated trajectory to match the format of the original data using</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">            the `process_generated_trajectory` method.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            6. Returning the processed synthetic trajectory as a GeoDataFrame.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">        Returns:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">            gpd.GeoDataFrame: Processed synthetic trajectory generated by the EPR model.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">starting_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="n">wt_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_best_fit</span><span class="p">()</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="c1"># min_wait_time_minutes = 20</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="c1"># compressed_traj_data = self.geo_processor.trajectory_compression(self.filtered_data_means)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="c1"># waiting_times_data = self.geo_processor.waiting_times(compressed_traj_data)[&quot;waiting_time&quot;]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="c1"># estimated_beta, estimated_tau = self.estimate_beta_tau_mle(waiting_times_data.dropna().values, min_wait_time_minutes)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1"># self.logger.info(&quot;Estimated parameters KK:&quot;)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated beta: {self.beta}&quot;)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated tau: {self.tau}&quot;)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">epr</span> <span class="o">=</span> <span class="n">DensityEPR</span><span class="p">(</span><span class="n">wt_model</span><span class="o">=</span><span class="n">wt_model</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="n">epr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                                 <span class="n">spatial_tessellation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                                 <span class="n">starting_locations</span><span class="o">=</span><span class="n">starting_points</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                                 <span class="n">relevance_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epr_params</span><span class="o">.</span><span class="n">relevance_column</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>                                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_generated_trajectory</span><span class="p">(</span><span class="n">synt_traj</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">synt_traj</span>
</span></pre></div>


            </section>
                <section id="EPRTrajectory">
                            <input id="EPRTrajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EPRTrajectory</span>:

                <label class="view-source-button" for="EPRTrajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory-23"><a href="#EPRTrajectory-23"><span class="linenos"> 23</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EPRTrajectory</span><span class="p">:</span>
</span><span id="EPRTrajectory-24"><a href="#EPRTrajectory-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-25"><a href="#EPRTrajectory-25"><span class="linenos"> 25</span></a><span class="sd">    Class to simulate trajectories using the EPR (Exploration and Preferential Return) model.</span>
</span><span id="EPRTrajectory-26"><a href="#EPRTrajectory-26"><span class="linenos"> 26</span></a><span class="sd">    It estimates model parameters from filtered trajectory data and generates synthetic trajectories.</span>
</span><span id="EPRTrajectory-27"><a href="#EPRTrajectory-27"><span class="linenos"> 27</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-28"><a href="#EPRTrajectory-28"><span class="linenos"> 28</span></a>
</span><span id="EPRTrajectory-29"><a href="#EPRTrajectory-29"><span class="linenos"> 29</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_manager</span><span class="p">:</span> <span class="n">ConfigManager</span><span class="p">,</span> <span class="n">filtered_data_means</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="EPRTrajectory-30"><a href="#EPRTrajectory-30"><span class="linenos"> 30</span></a>                 <span class="n">raw_trajectory</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">starting_positions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="EPRTrajectory-31"><a href="#EPRTrajectory-31"><span class="linenos"> 31</span></a>                 <span class="n">start_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory-32"><a href="#EPRTrajectory-32"><span class="linenos"> 32</span></a>                 <span class="n">output_dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EPRTrajectory-33"><a href="#EPRTrajectory-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-34"><a href="#EPRTrajectory-34"><span class="linenos"> 34</span></a><span class="sd">        Initialize the EPRTrajectory with configuration and data. Estimate model parameters.</span>
</span><span id="EPRTrajectory-35"><a href="#EPRTrajectory-35"><span class="linenos"> 35</span></a>
</span><span id="EPRTrajectory-36"><a href="#EPRTrajectory-36"><span class="linenos"> 36</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-37"><a href="#EPRTrajectory-37"><span class="linenos"> 37</span></a><span class="sd">            config_manager (ConfigManager): Configuration manager with settings.</span>
</span><span id="EPRTrajectory-38"><a href="#EPRTrajectory-38"><span class="linenos"> 38</span></a><span class="sd">            filtered_data_means (gpd.GeoDataFrame): Filtered trajectory data with mean points for each label.</span>
</span><span id="EPRTrajectory-39"><a href="#EPRTrajectory-39"><span class="linenos"> 39</span></a><span class="sd">            raw_trajectory (gpd.GeoDataFrame): Raw trajectory data.</span>
</span><span id="EPRTrajectory-40"><a href="#EPRTrajectory-40"><span class="linenos"> 40</span></a><span class="sd">            tessellation (gpd.GeoDataFrame): Spatial tessellation for the area.</span>
</span><span id="EPRTrajectory-41"><a href="#EPRTrajectory-41"><span class="linenos"> 41</span></a><span class="sd">            starting_positions (list): List of starting positions (grid IDs) for agents.</span>
</span><span id="EPRTrajectory-42"><a href="#EPRTrajectory-42"><span class="linenos"> 42</span></a><span class="sd">            start_time (pd.Timestamp | None): Start time for trajectory generation.</span>
</span><span id="EPRTrajectory-43"><a href="#EPRTrajectory-43"><span class="linenos"> 43</span></a><span class="sd">            end_time (pd.Timestamp | None): End time for trajectory generation.</span>
</span><span id="EPRTrajectory-44"><a href="#EPRTrajectory-44"><span class="linenos"> 44</span></a><span class="sd">            n_agents (int | None): Number of agents to simulate.</span>
</span><span id="EPRTrajectory-45"><a href="#EPRTrajectory-45"><span class="linenos"> 45</span></a><span class="sd">            output_dir_path (str): Directory path to save output files.</span>
</span><span id="EPRTrajectory-46"><a href="#EPRTrajectory-46"><span class="linenos"> 46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-47"><a href="#EPRTrajectory-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
</span><span id="EPRTrajectory-48"><a href="#EPRTrajectory-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">config_manager</span>
</span><span id="EPRTrajectory-49"><a href="#EPRTrajectory-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;EPR&quot;</span>
</span><span id="EPRTrajectory-50"><a href="#EPRTrajectory-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span> <span class="o">=</span> <span class="n">n_agents</span>
</span><span id="EPRTrajectory-51"><a href="#EPRTrajectory-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
</span><span id="EPRTrajectory-52"><a href="#EPRTrajectory-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">end_time</span>
</span><span id="EPRTrajectory-53"><a href="#EPRTrajectory-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">output_dir_path</span>
</span><span id="EPRTrajectory-54"><a href="#EPRTrajectory-54"><span class="linenos"> 54</span></a>
</span><span id="EPRTrajectory-55"><a href="#EPRTrajectory-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory-56"><a href="#EPRTrajectory-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory-57"><a href="#EPRTrajectory-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory-58"><a href="#EPRTrajectory-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory-59"><a href="#EPRTrajectory-59"><span class="linenos"> 59</span></a>
</span><span id="EPRTrajectory-60"><a href="#EPRTrajectory-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span> <span class="o">=</span> <span class="n">filtered_data_means</span>
</span><span id="EPRTrajectory-61"><a href="#EPRTrajectory-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span> <span class="o">=</span> <span class="n">raw_trajectory</span>
</span><span id="EPRTrajectory-62"><a href="#EPRTrajectory-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">tessellation</span>
</span><span id="EPRTrajectory-63"><a href="#EPRTrajectory-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span> <span class="o">=</span> <span class="n">starting_positions</span>
</span><span id="EPRTrajectory-64"><a href="#EPRTrajectory-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_estimate</span><span class="p">()</span>
</span><span id="EPRTrajectory-65"><a href="#EPRTrajectory-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span> <span class="o">=</span> <span class="n">GeoProcessor</span><span class="p">()</span>
</span><span id="EPRTrajectory-66"><a href="#EPRTrajectory-66"><span class="linenos"> 66</span></a>
</span><span id="EPRTrajectory-67"><a href="#EPRTrajectory-67"><span class="linenos"> 67</span></a>    <span class="c1"># Resample by 1-hour interval and select the label with the longest duration</span>
</span><span id="EPRTrajectory-68"><a href="#EPRTrajectory-68"><span class="linenos"> 68</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EPRTrajectory-69"><a href="#EPRTrajectory-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">longest_visited_row</span><span class="p">(</span><span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="EPRTrajectory-70"><a href="#EPRTrajectory-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-71"><a href="#EPRTrajectory-71"><span class="linenos"> 71</span></a><span class="sd">        Returns the row where the individual spent the longest time in an interval. If the group is empty, returns</span>
</span><span id="EPRTrajectory-72"><a href="#EPRTrajectory-72"><span class="linenos"> 72</span></a><span class="sd">        an empty Series. If multiple rows have the same longest duration, returns the first one.</span>
</span><span id="EPRTrajectory-73"><a href="#EPRTrajectory-73"><span class="linenos"> 73</span></a>
</span><span id="EPRTrajectory-74"><a href="#EPRTrajectory-74"><span class="linenos"> 74</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-75"><a href="#EPRTrajectory-75"><span class="linenos"> 75</span></a><span class="sd">            group (pd.DataFrame): Grouped DataFrame for an individual in a time interval.</span>
</span><span id="EPRTrajectory-76"><a href="#EPRTrajectory-76"><span class="linenos"> 76</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-77"><a href="#EPRTrajectory-77"><span class="linenos"> 77</span></a><span class="sd">            pd.Series: Row with the longest duration or an empty Series if the group is empty.</span>
</span><span id="EPRTrajectory-78"><a href="#EPRTrajectory-78"><span class="linenos"> 78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-79"><a href="#EPRTrajectory-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="EPRTrajectory-80"><a href="#EPRTrajectory-80"><span class="linenos"> 80</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>  <span class="c1"># Ensure an empty series is returned</span>
</span><span id="EPRTrajectory-81"><a href="#EPRTrajectory-81"><span class="linenos"> 81</span></a>
</span><span id="EPRTrajectory-82"><a href="#EPRTrajectory-82"><span class="linenos"> 82</span></a>        <span class="n">max_label</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># Find label with longest total duration</span>
</span><span id="EPRTrajectory-83"><a href="#EPRTrajectory-83"><span class="linenos"> 83</span></a>
</span><span id="EPRTrajectory-84"><a href="#EPRTrajectory-84"><span class="linenos"> 84</span></a>        <span class="c1"># Select first row where this label appears</span>
</span><span id="EPRTrajectory-85"><a href="#EPRTrajectory-85"><span class="linenos"> 85</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_label</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EPRTrajectory-86"><a href="#EPRTrajectory-86"><span class="linenos"> 86</span></a>
</span><span id="EPRTrajectory-87"><a href="#EPRTrajectory-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Return full row</span>
</span><span id="EPRTrajectory-88"><a href="#EPRTrajectory-88"><span class="linenos"> 88</span></a>
</span><span id="EPRTrajectory-89"><a href="#EPRTrajectory-89"><span class="linenos"> 89</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EPRTrajectory-90"><a href="#EPRTrajectory-90"><span class="linenos"> 90</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="EPRTrajectory-91"><a href="#EPRTrajectory-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-92"><a href="#EPRTrajectory-92"><span class="linenos"> 92</span></a><span class="sd">        Truncated power-law probability density function (PDF).</span>
</span><span id="EPRTrajectory-93"><a href="#EPRTrajectory-93"><span class="linenos"> 93</span></a>
</span><span id="EPRTrajectory-94"><a href="#EPRTrajectory-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-95"><a href="#EPRTrajectory-95"><span class="linenos"> 95</span></a><span class="sd">            x (float): Value to evaluate the PDF at.</span>
</span><span id="EPRTrajectory-96"><a href="#EPRTrajectory-96"><span class="linenos"> 96</span></a><span class="sd">            beta (float): Power-law exponent.</span>
</span><span id="EPRTrajectory-97"><a href="#EPRTrajectory-97"><span class="linenos"> 97</span></a><span class="sd">            tau (float): Exponential cutoff parameter.</span>
</span><span id="EPRTrajectory-98"><a href="#EPRTrajectory-98"><span class="linenos"> 98</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory-99"><a href="#EPRTrajectory-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-100"><a href="#EPRTrajectory-100"><span class="linenos">100</span></a><span class="sd">            float: Value of the PDF at x.</span>
</span><span id="EPRTrajectory-101"><a href="#EPRTrajectory-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-102"><a href="#EPRTrajectory-102"><span class="linenos">102</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="EPRTrajectory-103"><a href="#EPRTrajectory-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span>
</span><span id="EPRTrajectory-104"><a href="#EPRTrajectory-104"><span class="linenos">104</span></a>
</span><span id="EPRTrajectory-105"><a href="#EPRTrajectory-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="EPRTrajectory-106"><a href="#EPRTrajectory-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-107"><a href="#EPRTrajectory-107"><span class="linenos">107</span></a><span class="sd">        Log-likelihood function for the truncated power-law distribution.</span>
</span><span id="EPRTrajectory-108"><a href="#EPRTrajectory-108"><span class="linenos">108</span></a>
</span><span id="EPRTrajectory-109"><a href="#EPRTrajectory-109"><span class="linenos">109</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-110"><a href="#EPRTrajectory-110"><span class="linenos">110</span></a><span class="sd">            params (list): List containing [beta, tau] parameters.</span>
</span><span id="EPRTrajectory-111"><a href="#EPRTrajectory-111"><span class="linenos">111</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="EPRTrajectory-112"><a href="#EPRTrajectory-112"><span class="linenos">112</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory-113"><a href="#EPRTrajectory-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-114"><a href="#EPRTrajectory-114"><span class="linenos">114</span></a><span class="sd">            float: Negative log-likelihood value.</span>
</span><span id="EPRTrajectory-115"><a href="#EPRTrajectory-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-116"><a href="#EPRTrajectory-116"><span class="linenos">116</span></a>        <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="EPRTrajectory-117"><a href="#EPRTrajectory-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tau</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EPRTrajectory-118"><a href="#EPRTrajectory-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="EPRTrajectory-119"><a href="#EPRTrajectory-119"><span class="linenos">119</span></a>
</span><span id="EPRTrajectory-120"><a href="#EPRTrajectory-120"><span class="linenos">120</span></a>        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">)))</span>
</span><span id="EPRTrajectory-121"><a href="#EPRTrajectory-121"><span class="linenos">121</span></a>        <span class="n">normalization</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="EPRTrajectory-122"><a href="#EPRTrajectory-122"><span class="linenos">122</span></a>        <span class="n">ll</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">normalization</span><span class="p">)</span>
</span><span id="EPRTrajectory-123"><a href="#EPRTrajectory-123"><span class="linenos">123</span></a>
</span><span id="EPRTrajectory-124"><a href="#EPRTrajectory-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="o">-</span><span class="n">ll</span>
</span><span id="EPRTrajectory-125"><a href="#EPRTrajectory-125"><span class="linenos">125</span></a>
</span><span id="EPRTrajectory-126"><a href="#EPRTrajectory-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_beta_tau_mle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="EPRTrajectory-127"><a href="#EPRTrajectory-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-128"><a href="#EPRTrajectory-128"><span class="linenos">128</span></a><span class="sd">        Estimate the parameters beta and tau of the truncated power-law distribution using</span>
</span><span id="EPRTrajectory-129"><a href="#EPRTrajectory-129"><span class="linenos">129</span></a><span class="sd">        Maximum Likelihood Estimation (MLE).</span>
</span><span id="EPRTrajectory-130"><a href="#EPRTrajectory-130"><span class="linenos">130</span></a>
</span><span id="EPRTrajectory-131"><a href="#EPRTrajectory-131"><span class="linenos">131</span></a><span class="sd">        1. Initial guess for beta and tau.</span>
</span><span id="EPRTrajectory-132"><a href="#EPRTrajectory-132"><span class="linenos">132</span></a><span class="sd">        2. Bounds for beta and tau to ensure they are positive.</span>
</span><span id="EPRTrajectory-133"><a href="#EPRTrajectory-133"><span class="linenos">133</span></a><span class="sd">        3. Use scipy.optimize.minimize to find the parameters that minimize the negative log-likelihood.</span>
</span><span id="EPRTrajectory-134"><a href="#EPRTrajectory-134"><span class="linenos">134</span></a>
</span><span id="EPRTrajectory-135"><a href="#EPRTrajectory-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-136"><a href="#EPRTrajectory-136"><span class="linenos">136</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="EPRTrajectory-137"><a href="#EPRTrajectory-137"><span class="linenos">137</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory-138"><a href="#EPRTrajectory-138"><span class="linenos">138</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-139"><a href="#EPRTrajectory-139"><span class="linenos">139</span></a><span class="sd">            tuple[float | None, float | None]: Estimated (beta, tau) parameters or (None, None) if optimization fails.</span>
</span><span id="EPRTrajectory-140"><a href="#EPRTrajectory-140"><span class="linenos">140</span></a><span class="sd">        The estimation process involves:</span>
</span><span id="EPRTrajectory-141"><a href="#EPRTrajectory-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-142"><a href="#EPRTrajectory-142"><span class="linenos">142</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">]</span>
</span><span id="EPRTrajectory-143"><a href="#EPRTrajectory-143"><span class="linenos">143</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
</span><span id="EPRTrajectory-144"><a href="#EPRTrajectory-144"><span class="linenos">144</span></a>
</span><span id="EPRTrajectory-145"><a href="#EPRTrajectory-145"><span class="linenos">145</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span>
</span><span id="EPRTrajectory-146"><a href="#EPRTrajectory-146"><span class="linenos">146</span></a>                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</span><span id="EPRTrajectory-147"><a href="#EPRTrajectory-147"><span class="linenos">147</span></a>
</span><span id="EPRTrajectory-148"><a href="#EPRTrajectory-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="EPRTrajectory-149"><a href="#EPRTrajectory-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="EPRTrajectory-150"><a href="#EPRTrajectory-150"><span class="linenos">150</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EPRTrajectory-151"><a href="#EPRTrajectory-151"><span class="linenos">151</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization failed. Message: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-152"><a href="#EPRTrajectory-152"><span class="linenos">152</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="EPRTrajectory-153"><a href="#EPRTrajectory-153"><span class="linenos">153</span></a>
</span><span id="EPRTrajectory-154"><a href="#EPRTrajectory-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">param_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EPRTrajectory-155"><a href="#EPRTrajectory-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-156"><a href="#EPRTrajectory-156"><span class="linenos">156</span></a><span class="sd">        Estimate the EPR model parameters ($\gamma$ and $\rho$) from the raw trajectory data.</span>
</span><span id="EPRTrajectory-157"><a href="#EPRTrajectory-157"><span class="linenos">157</span></a>
</span><span id="EPRTrajectory-158"><a href="#EPRTrajectory-158"><span class="linenos">158</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory-159"><a href="#EPRTrajectory-159"><span class="linenos">159</span></a>
</span><span id="EPRTrajectory-160"><a href="#EPRTrajectory-160"><span class="linenos">160</span></a><span class="sd">        1. Resample the trajectory data to 1-hour intervals, selecting the label with the longest duration</span>
</span><span id="EPRTrajectory-161"><a href="#EPRTrajectory-161"><span class="linenos">161</span></a><span class="sd">        in each interval.</span>
</span><span id="EPRTrajectory-162"><a href="#EPRTrajectory-162"><span class="linenos">162</span></a><span class="sd">        2. Identify when a new place is visited and compute the cumulative number of distinct places visited, $S(t)$.</span>
</span><span id="EPRTrajectory-163"><a href="#EPRTrajectory-163"><span class="linenos">163</span></a><span class="sd">        3. Fit:</span>
</span><span id="EPRTrajectory-164"><a href="#EPRTrajectory-164"><span class="linenos">164</span></a><span class="sd">           - $n(t) \sim t^{\beta}$</span>
</span><span id="EPRTrajectory-165"><a href="#EPRTrajectory-165"><span class="linenos">165</span></a><span class="sd">           - $S(t) \sim t^{\alpha}$</span>
</span><span id="EPRTrajectory-166"><a href="#EPRTrajectory-166"><span class="linenos">166</span></a>
</span><span id="EPRTrajectory-167"><a href="#EPRTrajectory-167"><span class="linenos">167</span></a><span class="sd">           using linear regression on log-log transformed data.</span>
</span><span id="EPRTrajectory-168"><a href="#EPRTrajectory-168"><span class="linenos">168</span></a><span class="sd">        4. Compute $\gamma$ from the relationship:</span>
</span><span id="EPRTrajectory-169"><a href="#EPRTrajectory-169"><span class="linenos">169</span></a>
</span><span id="EPRTrajectory-170"><a href="#EPRTrajectory-170"><span class="linenos">170</span></a><span class="sd">           $$</span>
</span><span id="EPRTrajectory-171"><a href="#EPRTrajectory-171"><span class="linenos">171</span></a><span class="sd">           \alpha = \frac{\beta}{1 + \gamma}</span>
</span><span id="EPRTrajectory-172"><a href="#EPRTrajectory-172"><span class="linenos">172</span></a><span class="sd">           $$</span>
</span><span id="EPRTrajectory-173"><a href="#EPRTrajectory-173"><span class="linenos">173</span></a>
</span><span id="EPRTrajectory-174"><a href="#EPRTrajectory-174"><span class="linenos">174</span></a><span class="sd">        5. Compute $\rho$ from the prefactor relationship involving $K_{\text{est}}$, $C_{\text{est}}$, and $\gamma$.</span>
</span><span id="EPRTrajectory-175"><a href="#EPRTrajectory-175"><span class="linenos">175</span></a>
</span><span id="EPRTrajectory-176"><a href="#EPRTrajectory-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-177"><a href="#EPRTrajectory-177"><span class="linenos">177</span></a><span class="sd">            None: Updates the instance variables `self.gamma` and `self.rho` with estimated values.</span>
</span><span id="EPRTrajectory-178"><a href="#EPRTrajectory-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-179"><a href="#EPRTrajectory-179"><span class="linenos">179</span></a>
</span><span id="EPRTrajectory-180"><a href="#EPRTrajectory-180"><span class="linenos">180</span></a>        <span class="n">to_concat</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="EPRTrajectory-181"><a href="#EPRTrajectory-181"><span class="linenos">181</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="EPRTrajectory-182"><a href="#EPRTrajectory-182"><span class="linenos">182</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory-183"><a href="#EPRTrajectory-183"><span class="linenos">183</span></a>        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="EPRTrajectory-184"><a href="#EPRTrajectory-184"><span class="linenos">184</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="o">~</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>  <span class="c1"># Remove duplicate timestamps within the same individual</span>
</span><span id="EPRTrajectory-185"><a href="#EPRTrajectory-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EPRTrajectory-186"><a href="#EPRTrajectory-186"><span class="linenos">186</span></a>                <span class="k">continue</span>
</span><span id="EPRTrajectory-187"><a href="#EPRTrajectory-187"><span class="linenos">187</span></a>            <span class="n">group</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Set time as the index for time-based operations</span>
</span><span id="EPRTrajectory-188"><a href="#EPRTrajectory-188"><span class="linenos">188</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="EPRTrajectory-189"><a href="#EPRTrajectory-189"><span class="linenos">189</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="EPRTrajectory-190"><a href="#EPRTrajectory-190"><span class="linenos">190</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;moved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span><span id="EPRTrajectory-191"><a href="#EPRTrajectory-191"><span class="linenos">191</span></a>            <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;moved&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span><span id="EPRTrajectory-192"><a href="#EPRTrajectory-192"><span class="linenos">192</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span id="EPRTrajectory-193"><a href="#EPRTrajectory-193"><span class="linenos">193</span></a>
</span><span id="EPRTrajectory-194"><a href="#EPRTrajectory-194"><span class="linenos">194</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="EPRTrajectory-195"><a href="#EPRTrajectory-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EPRTrajectory-196"><a href="#EPRTrajectory-196"><span class="linenos">196</span></a>                <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span>
</span><span id="EPRTrajectory-197"><a href="#EPRTrajectory-197"><span class="linenos">197</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="EPRTrajectory-198"><a href="#EPRTrajectory-198"><span class="linenos">198</span></a>            <span class="c1"># Fill missing data using forward-fill and backward-fill</span>
</span><span id="EPRTrajectory-199"><a href="#EPRTrajectory-199"><span class="linenos">199</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="EPRTrajectory-200"><a href="#EPRTrajectory-200"><span class="linenos">200</span></a>
</span><span id="EPRTrajectory-201"><a href="#EPRTrajectory-201"><span class="linenos">201</span></a>            <span class="c1"># Store processed data for concatenation</span>
</span><span id="EPRTrajectory-202"><a href="#EPRTrajectory-202"><span class="linenos">202</span></a>            <span class="n">to_concat</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_resampled</span>
</span><span id="EPRTrajectory-203"><a href="#EPRTrajectory-203"><span class="linenos">203</span></a>        <span class="c1"># Combine all processed individual datasets back into a single DataFrame</span>
</span><span id="EPRTrajectory-204"><a href="#EPRTrajectory-204"><span class="linenos">204</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="EPRTrajectory-205"><a href="#EPRTrajectory-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EPRTrajectory-206"><a href="#EPRTrajectory-206"><span class="linenos">206</span></a>            <span class="k">return</span>
</span><span id="EPRTrajectory-207"><a href="#EPRTrajectory-207"><span class="linenos">207</span></a>        <span class="c1"># Identify when a new place is visited for each individual</span>
</span><span id="EPRTrajectory-208"><a href="#EPRTrajectory-208"><span class="linenos">208</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">~</span><span class="n">x</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
</span><span id="EPRTrajectory-209"><a href="#EPRTrajectory-209"><span class="linenos">209</span></a>
</span><span id="EPRTrajectory-210"><a href="#EPRTrajectory-210"><span class="linenos">210</span></a>        <span class="c1"># Compute cumulative number of distinct places visited (S(t)) for each individual</span>
</span><span id="EPRTrajectory-211"><a href="#EPRTrajectory-211"><span class="linenos">211</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">is_new</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory-212"><a href="#EPRTrajectory-212"><span class="linenos">212</span></a>
</span><span id="EPRTrajectory-213"><a href="#EPRTrajectory-213"><span class="linenos">213</span></a>        <span class="c1"># Compute the median number of observations per individual (to determine a common max time step) - cast to integer</span>
</span><span id="EPRTrajectory-214"><a href="#EPRTrajectory-214"><span class="linenos">214</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="EPRTrajectory-215"><a href="#EPRTrajectory-215"><span class="linenos">215</span></a>
</span><span id="EPRTrajectory-216"><a href="#EPRTrajectory-216"><span class="linenos">216</span></a>        <span class="c1"># Prepare averaged data for population-level analysis</span>
</span><span id="EPRTrajectory-217"><a href="#EPRTrajectory-217"><span class="linenos">217</span></a>        <span class="c1"># n_data: Sequence of step indices (1 to nrows)</span>
</span><span id="EPRTrajectory-218"><a href="#EPRTrajectory-218"><span class="linenos">218</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory-219"><a href="#EPRTrajectory-219"><span class="linenos">219</span></a>
</span><span id="EPRTrajectory-220"><a href="#EPRTrajectory-220"><span class="linenos">220</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
</span><span id="EPRTrajectory-221"><a href="#EPRTrajectory-221"><span class="linenos">221</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="EPRTrajectory-222"><a href="#EPRTrajectory-222"><span class="linenos">222</span></a>
</span><span id="EPRTrajectory-223"><a href="#EPRTrajectory-223"><span class="linenos">223</span></a>        <span class="c1"># S_data: Mean S(n) across all individuals at each time step</span>
</span><span id="EPRTrajectory-224"><a href="#EPRTrajectory-224"><span class="linenos">224</span></a>        <span class="n">S_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="EPRTrajectory-225"><a href="#EPRTrajectory-225"><span class="linenos">225</span></a>
</span><span id="EPRTrajectory-226"><a href="#EPRTrajectory-226"><span class="linenos">226</span></a>        <span class="c1"># 1. Fit n(t) ~ t^beta - steps vs time</span>
</span><span id="EPRTrajectory-227"><a href="#EPRTrajectory-227"><span class="linenos">227</span></a>        <span class="n">log_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="EPRTrajectory-228"><a href="#EPRTrajectory-228"><span class="linenos">228</span></a>        <span class="n">log_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="EPRTrajectory-229"><a href="#EPRTrajectory-229"><span class="linenos">229</span></a>        <span class="n">slope_n</span><span class="p">,</span> <span class="n">intercept_n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_n</span><span class="p">)</span>
</span><span id="EPRTrajectory-230"><a href="#EPRTrajectory-230"><span class="linenos">230</span></a>        <span class="n">beta_est</span> <span class="o">=</span> <span class="n">slope_n</span>
</span><span id="EPRTrajectory-231"><a href="#EPRTrajectory-231"><span class="linenos">231</span></a>        <span class="n">C_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_n</span><span class="p">)</span>  <span class="c1"># n(t) ~ C_est * t^beta_est</span>
</span><span id="EPRTrajectory-232"><a href="#EPRTrajectory-232"><span class="linenos">232</span></a>
</span><span id="EPRTrajectory-233"><a href="#EPRTrajectory-233"><span class="linenos">233</span></a>        <span class="c1"># 2. Fit S(t) ~ t^alpha</span>
</span><span id="EPRTrajectory-234"><a href="#EPRTrajectory-234"><span class="linenos">234</span></a>        <span class="n">log_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="EPRTrajectory-235"><a href="#EPRTrajectory-235"><span class="linenos">235</span></a>        <span class="n">slope_s</span><span class="p">,</span> <span class="n">intercept_s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_S</span><span class="p">)</span>
</span><span id="EPRTrajectory-236"><a href="#EPRTrajectory-236"><span class="linenos">236</span></a>        <span class="n">alpha_est</span> <span class="o">=</span> <span class="n">slope_s</span>
</span><span id="EPRTrajectory-237"><a href="#EPRTrajectory-237"><span class="linenos">237</span></a>        <span class="n">K_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_s</span><span class="p">)</span>  <span class="c1"># S(t) ~ K_est * t^alpha_est</span>
</span><span id="EPRTrajectory-238"><a href="#EPRTrajectory-238"><span class="linenos">238</span></a>
</span><span id="EPRTrajectory-239"><a href="#EPRTrajectory-239"><span class="linenos">239</span></a>        <span class="c1"># 3. Compute gamma from alpha = beta / (1 + gamma)</span>
</span><span id="EPRTrajectory-240"><a href="#EPRTrajectory-240"><span class="linenos">240</span></a>        <span class="n">gamma_est</span> <span class="o">=</span> <span class="n">beta_est</span> <span class="o">/</span> <span class="n">alpha_est</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="EPRTrajectory-241"><a href="#EPRTrajectory-241"><span class="linenos">241</span></a>
</span><span id="EPRTrajectory-242"><a href="#EPRTrajectory-242"><span class="linenos">242</span></a>        <span class="c1"># 4. Compute rho from the prefactor</span>
</span><span id="EPRTrajectory-243"><a href="#EPRTrajectory-243"><span class="linenos">243</span></a>        <span class="c1"># We have: K_est = (1 + gamma) * [rho * C_est]^(1/(1 + gamma))</span>
</span><span id="EPRTrajectory-244"><a href="#EPRTrajectory-244"><span class="linenos">244</span></a>        <span class="c1"># =&gt; ln(K_est) = ln(1 + gamma_est) + (1/(1 + gamma_est)) [ln(rho) + ln(C_est)]</span>
</span><span id="EPRTrajectory-245"><a href="#EPRTrajectory-245"><span class="linenos">245</span></a>        <span class="c1"># Solve for rho:</span>
</span><span id="EPRTrajectory-246"><a href="#EPRTrajectory-246"><span class="linenos">246</span></a>        <span class="c1">#    ln(rho) = (1 + gamma_est)* [ ln(K_est) - ln(1 + gamma_est) ] - ln(C_est)</span>
</span><span id="EPRTrajectory-247"><a href="#EPRTrajectory-247"><span class="linenos">247</span></a>        <span class="c1"># (Some algebra rearranging the terms.)</span>
</span><span id="EPRTrajectory-248"><a href="#EPRTrajectory-248"><span class="linenos">248</span></a>        <span class="c1"># It&#39;s often easier to do it step by step:</span>
</span><span id="EPRTrajectory-249"><a href="#EPRTrajectory-249"><span class="linenos">249</span></a>
</span><span id="EPRTrajectory-250"><a href="#EPRTrajectory-250"><span class="linenos">250</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K_est</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="EPRTrajectory-251"><a href="#EPRTrajectory-251"><span class="linenos">251</span></a>        <span class="n">den</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="EPRTrajectory-252"><a href="#EPRTrajectory-252"><span class="linenos">252</span></a>        <span class="c1"># =&gt; num / den = ln(rho) + ln(C_est)</span>
</span><span id="EPRTrajectory-253"><a href="#EPRTrajectory-253"><span class="linenos">253</span></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">C_est</span><span class="p">)</span>
</span><span id="EPRTrajectory-254"><a href="#EPRTrajectory-254"><span class="linenos">254</span></a>        <span class="n">rho_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="EPRTrajectory-255"><a href="#EPRTrajectory-255"><span class="linenos">255</span></a>
</span><span id="EPRTrajectory-256"><a href="#EPRTrajectory-256"><span class="linenos">256</span></a>        <span class="c1"># self.beta = beta_est</span>
</span><span id="EPRTrajectory-257"><a href="#EPRTrajectory-257"><span class="linenos">257</span></a>        <span class="c1"># self.alpha = alpha_est</span>
</span><span id="EPRTrajectory-258"><a href="#EPRTrajectory-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_est</span>
</span><span id="EPRTrajectory-259"><a href="#EPRTrajectory-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho_est</span>
</span><span id="EPRTrajectory-260"><a href="#EPRTrajectory-260"><span class="linenos">260</span></a>
</span><span id="EPRTrajectory-261"><a href="#EPRTrajectory-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Estimated parameters:&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-262"><a href="#EPRTrajectory-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  beta (from n(t)):   </span><span class="si">{</span><span class="n">beta_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-263"><a href="#EPRTrajectory-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  alpha (from S(t)):  </span><span class="si">{</span><span class="n">alpha_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-264"><a href="#EPRTrajectory-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  gamma:              </span><span class="si">{</span><span class="n">gamma_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-265"><a href="#EPRTrajectory-265"><span class="linenos">265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  rho:                </span><span class="si">{</span><span class="n">rho_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-266"><a href="#EPRTrajectory-266"><span class="linenos">266</span></a>
</span><span id="EPRTrajectory-267"><a href="#EPRTrajectory-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_generated_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synt_traj</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="EPRTrajectory-268"><a href="#EPRTrajectory-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-269"><a href="#EPRTrajectory-269"><span class="linenos">269</span></a><span class="sd">        Process the generated trajectory to match the format of the original data. Assign tessellation IDs and resample</span>
</span><span id="EPRTrajectory-270"><a href="#EPRTrajectory-270"><span class="linenos">270</span></a><span class="sd">        to 1-hour intervals.</span>
</span><span id="EPRTrajectory-271"><a href="#EPRTrajectory-271"><span class="linenos">271</span></a>
</span><span id="EPRTrajectory-272"><a href="#EPRTrajectory-272"><span class="linenos">272</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory-273"><a href="#EPRTrajectory-273"><span class="linenos">273</span></a>
</span><span id="EPRTrajectory-274"><a href="#EPRTrajectory-274"><span class="linenos">274</span></a><span class="sd">            1. Convert the generated trajectory to a GeoDataFrame and set the coordinate reference system (CRS).</span>
</span><span id="EPRTrajectory-275"><a href="#EPRTrajectory-275"><span class="linenos">275</span></a><span class="sd">            2. Perform a spatial join with the tessellation to assign tessellation IDs to each point.</span>
</span><span id="EPRTrajectory-276"><a href="#EPRTrajectory-276"><span class="linenos">276</span></a><span class="sd">            3. Rename columns to match the original data format.</span>
</span><span id="EPRTrajectory-277"><a href="#EPRTrajectory-277"><span class="linenos">277</span></a><span class="sd">            4. Resample the trajectory to 1-hour intervals, ensuring that each agent&#39;s trajectory is continuous.</span>
</span><span id="EPRTrajectory-278"><a href="#EPRTrajectory-278"><span class="linenos">278</span></a><span class="sd">            5. Create a new GeoDataFrame with the resampled data, including latitude and longitude columns.</span>
</span><span id="EPRTrajectory-279"><a href="#EPRTrajectory-279"><span class="linenos">279</span></a>
</span><span id="EPRTrajectory-280"><a href="#EPRTrajectory-280"><span class="linenos">280</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory-281"><a href="#EPRTrajectory-281"><span class="linenos">281</span></a><span class="sd">            synt_traj (gpd.GeoDataFrame): Generated trajectory from the EPR model.</span>
</span><span id="EPRTrajectory-282"><a href="#EPRTrajectory-282"><span class="linenos">282</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-283"><a href="#EPRTrajectory-283"><span class="linenos">283</span></a><span class="sd">            gpd.GeoDataFrame: Processed trajectory with tessellation IDs and resampled to 1-hour intervals.</span>
</span><span id="EPRTrajectory-284"><a href="#EPRTrajectory-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-285"><a href="#EPRTrajectory-285"><span class="linenos">285</span></a>        <span class="n">trajectory_processor</span> <span class="o">=</span> <span class="n">TrajectoryProcessor</span><span class="p">()</span>
</span><span id="EPRTrajectory-286"><a href="#EPRTrajectory-286"><span class="linenos">286</span></a>
</span><span id="EPRTrajectory-287"><a href="#EPRTrajectory-287"><span class="linenos">287</span></a>        <span class="n">generated_traj</span> <span class="o">=</span> <span class="n">synt_traj</span><span class="o">.</span><span class="n">to_geodataframe</span><span class="p">()</span>
</span><span id="EPRTrajectory-288"><a href="#EPRTrajectory-288"><span class="linenos">288</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory-289"><a href="#EPRTrajectory-289"><span class="linenos">289</span></a>        <span class="n">generated_traj_joined_with_tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="EPRTrajectory-290"><a href="#EPRTrajectory-290"><span class="linenos">290</span></a>                                                            <span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">)</span>
</span><span id="EPRTrajectory-291"><a href="#EPRTrajectory-291"><span class="linenos">291</span></a>        <span class="n">generated_traj</span><span class="p">[</span><span class="s1">&#39;tessellation_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generated_traj_joined_with_tessellation</span><span class="p">[</span><span class="s1">&#39;index_right&#39;</span><span class="p">]</span>
</span><span id="EPRTrajectory-292"><a href="#EPRTrajectory-292"><span class="linenos">292</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory-293"><a href="#EPRTrajectory-293"><span class="linenos">293</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory-294"><a href="#EPRTrajectory-294"><span class="linenos">294</span></a>
</span><span id="EPRTrajectory-295"><a href="#EPRTrajectory-295"><span class="linenos">295</span></a>        <span class="n">resampled_generated_traj</span> <span class="o">=</span> <span class="n">trajectory_processor</span><span class="o">.</span><span class="n">resample_time</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="s1">&#39;1h&#39;</span><span class="p">,</span> <span class="s1">&#39;tessellation_id&#39;</span><span class="p">)</span>
</span><span id="EPRTrajectory-296"><a href="#EPRTrajectory-296"><span class="linenos">296</span></a>        <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory-297"><a href="#EPRTrajectory-297"><span class="linenos">297</span></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="p">,</span>
</span><span id="EPRTrajectory-298"><a href="#EPRTrajectory-298"><span class="linenos">298</span></a>                               <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
</span><span id="EPRTrajectory-299"><a href="#EPRTrajectory-299"><span class="linenos">299</span></a>                               <span class="n">crs</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</span><span id="EPRTrajectory-300"><a href="#EPRTrajectory-300"><span class="linenos">300</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
</span><span id="EPRTrajectory-301"><a href="#EPRTrajectory-301"><span class="linenos">301</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
</span><span id="EPRTrajectory-302"><a href="#EPRTrajectory-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">gdf</span>
</span><span id="EPRTrajectory-303"><a href="#EPRTrajectory-303"><span class="linenos">303</span></a>
</span><span id="EPRTrajectory-304"><a href="#EPRTrajectory-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">distfit</span><span class="p">:</span>
</span><span id="EPRTrajectory-305"><a href="#EPRTrajectory-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-306"><a href="#EPRTrajectory-306"><span class="linenos">306</span></a><span class="sd">        Fit various statistical distributions to the waiting times derived from the trajectory data and identify the</span>
</span><span id="EPRTrajectory-307"><a href="#EPRTrajectory-307"><span class="linenos">307</span></a><span class="sd">        best-fitting distribution.</span>
</span><span id="EPRTrajectory-308"><a href="#EPRTrajectory-308"><span class="linenos">308</span></a>
</span><span id="EPRTrajectory-309"><a href="#EPRTrajectory-309"><span class="linenos">309</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory-310"><a href="#EPRTrajectory-310"><span class="linenos">310</span></a>
</span><span id="EPRTrajectory-311"><a href="#EPRTrajectory-311"><span class="linenos">311</span></a><span class="sd">            1. Compressing the trajectory to identify distinct locations and their associated waiting times.</span>
</span><span id="EPRTrajectory-312"><a href="#EPRTrajectory-312"><span class="linenos">312</span></a><span class="sd">            2. Calculating waiting times as the duration spent at each location.</span>
</span><span id="EPRTrajectory-313"><a href="#EPRTrajectory-313"><span class="linenos">313</span></a><span class="sd">            3. Using the `distfit` library to fit a range of distributions to the waiting time data.</span>
</span><span id="EPRTrajectory-314"><a href="#EPRTrajectory-314"><span class="linenos">314</span></a><span class="sd">            4. Evaluating the goodness-of-fit using the Wasserstein distance metric.</span>
</span><span id="EPRTrajectory-315"><a href="#EPRTrajectory-315"><span class="linenos">315</span></a><span class="sd">            5. Plotting the best-fitting distribution against the empirical data for visual assessment.</span>
</span><span id="EPRTrajectory-316"><a href="#EPRTrajectory-316"><span class="linenos">316</span></a><span class="sd">            6. Saving the plots to the specified output directory.</span>
</span><span id="EPRTrajectory-317"><a href="#EPRTrajectory-317"><span class="linenos">317</span></a>
</span><span id="EPRTrajectory-318"><a href="#EPRTrajectory-318"><span class="linenos">318</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-319"><a href="#EPRTrajectory-319"><span class="linenos">319</span></a><span class="sd">            distfit: Fitted distfit object containing the best-fitting distribution and parameters.</span>
</span><span id="EPRTrajectory-320"><a href="#EPRTrajectory-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-321"><a href="#EPRTrajectory-321"><span class="linenos">321</span></a>        <span class="n">trajectory_compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">trajectory_compression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span><span class="p">)</span>
</span><span id="EPRTrajectory-322"><a href="#EPRTrajectory-322"><span class="linenos">322</span></a>        <span class="n">waiting_times_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">waiting_times</span><span class="p">(</span><span class="n">trajectory_compressed</span><span class="p">)</span>
</span><span id="EPRTrajectory-323"><a href="#EPRTrajectory-323"><span class="linenos">323</span></a>        <span class="n">dfit</span> <span class="o">=</span> <span class="n">distfit</span><span class="p">(</span>
</span><span id="EPRTrajectory-324"><a href="#EPRTrajectory-324"><span class="linenos">324</span></a>            <span class="n">distr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="s1">&#39;expon&#39;</span><span class="p">,</span> <span class="s1">&#39;pareto&#39;</span><span class="p">,</span> <span class="s1">&#39;dweibull&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;genextreme&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;lognorm&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
</span><span id="EPRTrajectory-325"><a href="#EPRTrajectory-325"><span class="linenos">325</span></a>                   <span class="s1">&#39;loggamma&#39;</span><span class="p">,</span> <span class="s1">&#39;truncexpon&#39;</span><span class="p">,</span> <span class="s1">&#39;truncnorm&#39;</span><span class="p">,</span> <span class="s1">&#39;truncpareto&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">],</span> <span class="n">stats</span><span class="o">=</span><span class="s2">&quot;wasserstein&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-326"><a href="#EPRTrajectory-326"><span class="linenos">326</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">waiting_times_df</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">])</span>
</span><span id="EPRTrajectory-327"><a href="#EPRTrajectory-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best fit: </span><span class="si">{</span><span class="n">dfit</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-328"><a href="#EPRTrajectory-328"><span class="linenos">328</span></a>
</span><span id="EPRTrajectory-329"><a href="#EPRTrajectory-329"><span class="linenos">329</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="EPRTrajectory-330"><a href="#EPRTrajectory-330"><span class="linenos">330</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="EPRTrajectory-331"><a href="#EPRTrajectory-331"><span class="linenos">331</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit.png&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-332"><a href="#EPRTrajectory-332"><span class="linenos">332</span></a>
</span><span id="EPRTrajectory-333"><a href="#EPRTrajectory-333"><span class="linenos">333</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="EPRTrajectory-334"><a href="#EPRTrajectory-334"><span class="linenos">334</span></a>            <span class="n">pdf_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#472D30&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">},</span>
</span><span id="EPRTrajectory-335"><a href="#EPRTrajectory-335"><span class="linenos">335</span></a>            <span class="n">bar_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory-336"><a href="#EPRTrajectory-336"><span class="linenos">336</span></a>            <span class="n">cii_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory-337"><a href="#EPRTrajectory-337"><span class="linenos">337</span></a>            <span class="n">emp_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#E26D5C&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">},</span>
</span><span id="EPRTrajectory-338"><a href="#EPRTrajectory-338"><span class="linenos">338</span></a>            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="EPRTrajectory-339"><a href="#EPRTrajectory-339"><span class="linenos">339</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="EPRTrajectory-340"><a href="#EPRTrajectory-340"><span class="linenos">340</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit_.png&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory-341"><a href="#EPRTrajectory-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">dfit</span>
</span><span id="EPRTrajectory-342"><a href="#EPRTrajectory-342"><span class="linenos">342</span></a>
</span><span id="EPRTrajectory-343"><a href="#EPRTrajectory-343"><span class="linenos">343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="EPRTrajectory-344"><a href="#EPRTrajectory-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-345"><a href="#EPRTrajectory-345"><span class="linenos">345</span></a><span class="sd">        Generate synthetic trajectories using the EPR model with estimated parameters.</span>
</span><span id="EPRTrajectory-346"><a href="#EPRTrajectory-346"><span class="linenos">346</span></a>
</span><span id="EPRTrajectory-347"><a href="#EPRTrajectory-347"><span class="linenos">347</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory-348"><a href="#EPRTrajectory-348"><span class="linenos">348</span></a>
</span><span id="EPRTrajectory-349"><a href="#EPRTrajectory-349"><span class="linenos">349</span></a><span class="sd">            1. Copying the starting positions for agents.</span>
</span><span id="EPRTrajectory-350"><a href="#EPRTrajectory-350"><span class="linenos">350</span></a><span class="sd">            2. Finding the best-fitting distribution for waiting times using the `find_best_fit` method.</span>
</span><span id="EPRTrajectory-351"><a href="#EPRTrajectory-351"><span class="linenos">351</span></a><span class="sd">            3. Initializing the DensityEPR model with the estimated parameters (rho and gamma).</span>
</span><span id="EPRTrajectory-352"><a href="#EPRTrajectory-352"><span class="linenos">352</span></a><span class="sd">            4. Generating synthetic trajectories for the specified number of agents over the defined time period and</span>
</span><span id="EPRTrajectory-353"><a href="#EPRTrajectory-353"><span class="linenos">353</span></a><span class="sd">            spatial tessellation.</span>
</span><span id="EPRTrajectory-354"><a href="#EPRTrajectory-354"><span class="linenos">354</span></a><span class="sd">            5. Processing the generated trajectory to match the format of the original data using</span>
</span><span id="EPRTrajectory-355"><a href="#EPRTrajectory-355"><span class="linenos">355</span></a><span class="sd">            the `process_generated_trajectory` method.</span>
</span><span id="EPRTrajectory-356"><a href="#EPRTrajectory-356"><span class="linenos">356</span></a><span class="sd">            6. Returning the processed synthetic trajectory as a GeoDataFrame.</span>
</span><span id="EPRTrajectory-357"><a href="#EPRTrajectory-357"><span class="linenos">357</span></a>
</span><span id="EPRTrajectory-358"><a href="#EPRTrajectory-358"><span class="linenos">358</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory-359"><a href="#EPRTrajectory-359"><span class="linenos">359</span></a><span class="sd">            gpd.GeoDataFrame: Processed synthetic trajectory generated by the EPR model.</span>
</span><span id="EPRTrajectory-360"><a href="#EPRTrajectory-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory-361"><a href="#EPRTrajectory-361"><span class="linenos">361</span></a>        <span class="n">starting_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="EPRTrajectory-362"><a href="#EPRTrajectory-362"><span class="linenos">362</span></a>        <span class="n">wt_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_best_fit</span><span class="p">()</span>
</span><span id="EPRTrajectory-363"><a href="#EPRTrajectory-363"><span class="linenos">363</span></a>
</span><span id="EPRTrajectory-364"><a href="#EPRTrajectory-364"><span class="linenos">364</span></a>        <span class="c1"># min_wait_time_minutes = 20</span>
</span><span id="EPRTrajectory-365"><a href="#EPRTrajectory-365"><span class="linenos">365</span></a>        <span class="c1"># compressed_traj_data = self.geo_processor.trajectory_compression(self.filtered_data_means)</span>
</span><span id="EPRTrajectory-366"><a href="#EPRTrajectory-366"><span class="linenos">366</span></a>        <span class="c1"># waiting_times_data = self.geo_processor.waiting_times(compressed_traj_data)[&quot;waiting_time&quot;]</span>
</span><span id="EPRTrajectory-367"><a href="#EPRTrajectory-367"><span class="linenos">367</span></a>        <span class="c1"># estimated_beta, estimated_tau = self.estimate_beta_tau_mle(waiting_times_data.dropna().values, min_wait_time_minutes)</span>
</span><span id="EPRTrajectory-368"><a href="#EPRTrajectory-368"><span class="linenos">368</span></a>        <span class="c1"># self.logger.info(&quot;Estimated parameters KK:&quot;)</span>
</span><span id="EPRTrajectory-369"><a href="#EPRTrajectory-369"><span class="linenos">369</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated beta: {self.beta}&quot;)</span>
</span><span id="EPRTrajectory-370"><a href="#EPRTrajectory-370"><span class="linenos">370</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated tau: {self.tau}&quot;)</span>
</span><span id="EPRTrajectory-371"><a href="#EPRTrajectory-371"><span class="linenos">371</span></a>
</span><span id="EPRTrajectory-372"><a href="#EPRTrajectory-372"><span class="linenos">372</span></a>        <span class="n">epr</span> <span class="o">=</span> <span class="n">DensityEPR</span><span class="p">(</span><span class="n">wt_model</span><span class="o">=</span><span class="n">wt_model</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
</span><span id="EPRTrajectory-373"><a href="#EPRTrajectory-373"><span class="linenos">373</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="n">epr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
</span><span id="EPRTrajectory-374"><a href="#EPRTrajectory-374"><span class="linenos">374</span></a>                                 <span class="n">spatial_tessellation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span><span class="p">,</span>
</span><span id="EPRTrajectory-375"><a href="#EPRTrajectory-375"><span class="linenos">375</span></a>                                 <span class="n">starting_locations</span><span class="o">=</span><span class="n">starting_points</span><span class="p">,</span>
</span><span id="EPRTrajectory-376"><a href="#EPRTrajectory-376"><span class="linenos">376</span></a>                                 <span class="n">relevance_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epr_params</span><span class="o">.</span><span class="n">relevance_column</span><span class="p">,</span>
</span><span id="EPRTrajectory-377"><a href="#EPRTrajectory-377"><span class="linenos">377</span></a>                                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory-378"><a href="#EPRTrajectory-378"><span class="linenos">378</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_generated_trajectory</span><span class="p">(</span><span class="n">synt_traj</span><span class="p">)</span>
</span><span id="EPRTrajectory-379"><a href="#EPRTrajectory-379"><span class="linenos">379</span></a>        <span class="k">return</span> <span class="n">synt_traj</span>
</span></pre></div>


            <div class="docstring"><p>Class to simulate trajectories using the EPR (Exploration and Preferential Return) model.
It estimates model parameters from filtered trajectory data and generates synthetic trajectories.</p>
</div>


                            <div id="EPRTrajectory.__init__" class="classattr">
                                        <input id="EPRTrajectory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EPRTrajectory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">config_manager</span><span class="p">:</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">ConfigManager</span>,</span><span class="param">	<span class="n">filtered_data_means</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">raw_trajectory</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">tessellation</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">starting_positions</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">start_time</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">end_time</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_dir_path</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="EPRTrajectory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.__init__-29"><a href="#EPRTrajectory.__init__-29"><span class="linenos">29</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_manager</span><span class="p">:</span> <span class="n">ConfigManager</span><span class="p">,</span> <span class="n">filtered_data_means</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="EPRTrajectory.__init__-30"><a href="#EPRTrajectory.__init__-30"><span class="linenos">30</span></a>                 <span class="n">raw_trajectory</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">starting_positions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="EPRTrajectory.__init__-31"><a href="#EPRTrajectory.__init__-31"><span class="linenos">31</span></a>                 <span class="n">start_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n_agents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory.__init__-32"><a href="#EPRTrajectory.__init__-32"><span class="linenos">32</span></a>                 <span class="n">output_dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="EPRTrajectory.__init__-33"><a href="#EPRTrajectory.__init__-33"><span class="linenos">33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.__init__-34"><a href="#EPRTrajectory.__init__-34"><span class="linenos">34</span></a><span class="sd">        Initialize the EPRTrajectory with configuration and data. Estimate model parameters.</span>
</span><span id="EPRTrajectory.__init__-35"><a href="#EPRTrajectory.__init__-35"><span class="linenos">35</span></a>
</span><span id="EPRTrajectory.__init__-36"><a href="#EPRTrajectory.__init__-36"><span class="linenos">36</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.__init__-37"><a href="#EPRTrajectory.__init__-37"><span class="linenos">37</span></a><span class="sd">            config_manager (ConfigManager): Configuration manager with settings.</span>
</span><span id="EPRTrajectory.__init__-38"><a href="#EPRTrajectory.__init__-38"><span class="linenos">38</span></a><span class="sd">            filtered_data_means (gpd.GeoDataFrame): Filtered trajectory data with mean points for each label.</span>
</span><span id="EPRTrajectory.__init__-39"><a href="#EPRTrajectory.__init__-39"><span class="linenos">39</span></a><span class="sd">            raw_trajectory (gpd.GeoDataFrame): Raw trajectory data.</span>
</span><span id="EPRTrajectory.__init__-40"><a href="#EPRTrajectory.__init__-40"><span class="linenos">40</span></a><span class="sd">            tessellation (gpd.GeoDataFrame): Spatial tessellation for the area.</span>
</span><span id="EPRTrajectory.__init__-41"><a href="#EPRTrajectory.__init__-41"><span class="linenos">41</span></a><span class="sd">            starting_positions (list): List of starting positions (grid IDs) for agents.</span>
</span><span id="EPRTrajectory.__init__-42"><a href="#EPRTrajectory.__init__-42"><span class="linenos">42</span></a><span class="sd">            start_time (pd.Timestamp | None): Start time for trajectory generation.</span>
</span><span id="EPRTrajectory.__init__-43"><a href="#EPRTrajectory.__init__-43"><span class="linenos">43</span></a><span class="sd">            end_time (pd.Timestamp | None): End time for trajectory generation.</span>
</span><span id="EPRTrajectory.__init__-44"><a href="#EPRTrajectory.__init__-44"><span class="linenos">44</span></a><span class="sd">            n_agents (int | None): Number of agents to simulate.</span>
</span><span id="EPRTrajectory.__init__-45"><a href="#EPRTrajectory.__init__-45"><span class="linenos">45</span></a><span class="sd">            output_dir_path (str): Directory path to save output files.</span>
</span><span id="EPRTrajectory.__init__-46"><a href="#EPRTrajectory.__init__-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.__init__-47"><a href="#EPRTrajectory.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
</span><span id="EPRTrajectory.__init__-48"><a href="#EPRTrajectory.__init__-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">config_manager</span>
</span><span id="EPRTrajectory.__init__-49"><a href="#EPRTrajectory.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;EPR&quot;</span>
</span><span id="EPRTrajectory.__init__-50"><a href="#EPRTrajectory.__init__-50"><span class="linenos">50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span> <span class="o">=</span> <span class="n">n_agents</span>
</span><span id="EPRTrajectory.__init__-51"><a href="#EPRTrajectory.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
</span><span id="EPRTrajectory.__init__-52"><a href="#EPRTrajectory.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">end_time</span>
</span><span id="EPRTrajectory.__init__-53"><a href="#EPRTrajectory.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">output_dir_path</span>
</span><span id="EPRTrajectory.__init__-54"><a href="#EPRTrajectory.__init__-54"><span class="linenos">54</span></a>
</span><span id="EPRTrajectory.__init__-55"><a href="#EPRTrajectory.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory.__init__-56"><a href="#EPRTrajectory.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory.__init__-57"><a href="#EPRTrajectory.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory.__init__-58"><a href="#EPRTrajectory.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EPRTrajectory.__init__-59"><a href="#EPRTrajectory.__init__-59"><span class="linenos">59</span></a>
</span><span id="EPRTrajectory.__init__-60"><a href="#EPRTrajectory.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span> <span class="o">=</span> <span class="n">filtered_data_means</span>
</span><span id="EPRTrajectory.__init__-61"><a href="#EPRTrajectory.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span> <span class="o">=</span> <span class="n">raw_trajectory</span>
</span><span id="EPRTrajectory.__init__-62"><a href="#EPRTrajectory.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">tessellation</span>
</span><span id="EPRTrajectory.__init__-63"><a href="#EPRTrajectory.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span> <span class="o">=</span> <span class="n">starting_positions</span>
</span><span id="EPRTrajectory.__init__-64"><a href="#EPRTrajectory.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param_estimate</span><span class="p">()</span>
</span><span id="EPRTrajectory.__init__-65"><a href="#EPRTrajectory.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span> <span class="o">=</span> <span class="n">GeoProcessor</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the EPRTrajectory with configuration and data. Estimate model parameters.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>config_manager (ConfigManager):</strong>  Configuration manager with settings.</li>
<li><strong>filtered_data_means (gpd.GeoDataFrame):</strong>  Filtered trajectory data with mean points for each label.</li>
<li><strong>raw_trajectory (gpd.GeoDataFrame):</strong>  Raw trajectory data.</li>
<li><strong>tessellation (gpd.GeoDataFrame):</strong>  Spatial tessellation for the area.</li>
<li><strong>starting_positions (list):</strong>  List of starting positions (grid IDs) for agents.</li>
<li><strong>start_time (pd.Timestamp | None):</strong>  Start time for trajectory generation.</li>
<li><strong>end_time (pd.Timestamp | None):</strong>  End time for trajectory generation.</li>
<li><strong>n_agents (int | None):</strong>  Number of agents to simulate.</li>
<li><strong>output_dir_path (str):</strong>  Directory path to save output files.</li>
</ul>
</div>


                            </div>
                            <div id="EPRTrajectory.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.logger"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.config_manager" class="classattr">
                                <div class="attr variable">
            <span class="name">config_manager</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.config_manager"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.name"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.n_agents" class="classattr">
                                <div class="attr variable">
            <span class="name">n_agents</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.n_agents"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.start_time" class="classattr">
                                <div class="attr variable">
            <span class="name">start_time</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.start_time"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.end_time" class="classattr">
                                <div class="attr variable">
            <span class="name">end_time</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.end_time"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.output_dir_path" class="classattr">
                                <div class="attr variable">
            <span class="name">output_dir_path</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.output_dir_path"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.beta" class="classattr">
                                <div class="attr variable">
            <span class="name">beta</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.beta"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.alpha"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.gamma" class="classattr">
                                <div class="attr variable">
            <span class="name">gamma</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.gamma"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.rho" class="classattr">
                                <div class="attr variable">
            <span class="name">rho</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.rho"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.filtered_data_means" class="classattr">
                                <div class="attr variable">
            <span class="name">filtered_data_means</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.filtered_data_means"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.raw_trajectory" class="classattr">
                                <div class="attr variable">
            <span class="name">raw_trajectory</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.raw_trajectory"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.tessellation" class="classattr">
                                <div class="attr variable">
            <span class="name">tessellation</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.tessellation"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.starting_positions" class="classattr">
                                <div class="attr variable">
            <span class="name">starting_positions</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.starting_positions"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.geo_processor" class="classattr">
                                <div class="attr variable">
            <span class="name">geo_processor</span>

        
    </div>
    <a class="headerlink" href="#EPRTrajectory.geo_processor"></a>
    
    

                            </div>
                            <div id="EPRTrajectory.longest_visited_row" class="classattr">
                                        <input id="EPRTrajectory.longest_visited_row-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">longest_visited_row</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">group</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.longest_visited_row-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.longest_visited_row"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.longest_visited_row-68"><a href="#EPRTrajectory.longest_visited_row-68"><span class="linenos">68</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EPRTrajectory.longest_visited_row-69"><a href="#EPRTrajectory.longest_visited_row-69"><span class="linenos">69</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">longest_visited_row</span><span class="p">(</span><span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
</span><span id="EPRTrajectory.longest_visited_row-70"><a href="#EPRTrajectory.longest_visited_row-70"><span class="linenos">70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.longest_visited_row-71"><a href="#EPRTrajectory.longest_visited_row-71"><span class="linenos">71</span></a><span class="sd">        Returns the row where the individual spent the longest time in an interval. If the group is empty, returns</span>
</span><span id="EPRTrajectory.longest_visited_row-72"><a href="#EPRTrajectory.longest_visited_row-72"><span class="linenos">72</span></a><span class="sd">        an empty Series. If multiple rows have the same longest duration, returns the first one.</span>
</span><span id="EPRTrajectory.longest_visited_row-73"><a href="#EPRTrajectory.longest_visited_row-73"><span class="linenos">73</span></a>
</span><span id="EPRTrajectory.longest_visited_row-74"><a href="#EPRTrajectory.longest_visited_row-74"><span class="linenos">74</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.longest_visited_row-75"><a href="#EPRTrajectory.longest_visited_row-75"><span class="linenos">75</span></a><span class="sd">            group (pd.DataFrame): Grouped DataFrame for an individual in a time interval.</span>
</span><span id="EPRTrajectory.longest_visited_row-76"><a href="#EPRTrajectory.longest_visited_row-76"><span class="linenos">76</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.longest_visited_row-77"><a href="#EPRTrajectory.longest_visited_row-77"><span class="linenos">77</span></a><span class="sd">            pd.Series: Row with the longest duration or an empty Series if the group is empty.</span>
</span><span id="EPRTrajectory.longest_visited_row-78"><a href="#EPRTrajectory.longest_visited_row-78"><span class="linenos">78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.longest_visited_row-79"><a href="#EPRTrajectory.longest_visited_row-79"><span class="linenos">79</span></a>        <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="EPRTrajectory.longest_visited_row-80"><a href="#EPRTrajectory.longest_visited_row-80"><span class="linenos">80</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>  <span class="c1"># Ensure an empty series is returned</span>
</span><span id="EPRTrajectory.longest_visited_row-81"><a href="#EPRTrajectory.longest_visited_row-81"><span class="linenos">81</span></a>
</span><span id="EPRTrajectory.longest_visited_row-82"><a href="#EPRTrajectory.longest_visited_row-82"><span class="linenos">82</span></a>        <span class="n">max_label</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># Find label with longest total duration</span>
</span><span id="EPRTrajectory.longest_visited_row-83"><a href="#EPRTrajectory.longest_visited_row-83"><span class="linenos">83</span></a>
</span><span id="EPRTrajectory.longest_visited_row-84"><a href="#EPRTrajectory.longest_visited_row-84"><span class="linenos">84</span></a>        <span class="c1"># Select first row where this label appears</span>
</span><span id="EPRTrajectory.longest_visited_row-85"><a href="#EPRTrajectory.longest_visited_row-85"><span class="linenos">85</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_label</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EPRTrajectory.longest_visited_row-86"><a href="#EPRTrajectory.longest_visited_row-86"><span class="linenos">86</span></a>
</span><span id="EPRTrajectory.longest_visited_row-87"><a href="#EPRTrajectory.longest_visited_row-87"><span class="linenos">87</span></a>        <span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Return full row</span>
</span></pre></div>


            <div class="docstring"><p>Returns the row where the individual spent the longest time in an interval. If the group is empty, returns
an empty Series. If multiple rows have the same longest duration, returns the first one.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>group (pd.DataFrame):</strong>  Grouped DataFrame for an individual in a time interval.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>pd.Series: Row with the longest duration or an empty Series if the group is empty.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.truncated_power_law_pdf" class="classattr">
                                        <input id="EPRTrajectory.truncated_power_law_pdf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">truncated_power_law_pdf</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">beta</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">tau</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.truncated_power_law_pdf-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.truncated_power_law_pdf"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.truncated_power_law_pdf-89"><a href="#EPRTrajectory.truncated_power_law_pdf-89"><span class="linenos"> 89</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-90"><a href="#EPRTrajectory.truncated_power_law_pdf-90"><span class="linenos"> 90</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-91"><a href="#EPRTrajectory.truncated_power_law_pdf-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-92"><a href="#EPRTrajectory.truncated_power_law_pdf-92"><span class="linenos"> 92</span></a><span class="sd">        Truncated power-law probability density function (PDF).</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-93"><a href="#EPRTrajectory.truncated_power_law_pdf-93"><span class="linenos"> 93</span></a>
</span><span id="EPRTrajectory.truncated_power_law_pdf-94"><a href="#EPRTrajectory.truncated_power_law_pdf-94"><span class="linenos"> 94</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-95"><a href="#EPRTrajectory.truncated_power_law_pdf-95"><span class="linenos"> 95</span></a><span class="sd">            x (float): Value to evaluate the PDF at.</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-96"><a href="#EPRTrajectory.truncated_power_law_pdf-96"><span class="linenos"> 96</span></a><span class="sd">            beta (float): Power-law exponent.</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-97"><a href="#EPRTrajectory.truncated_power_law_pdf-97"><span class="linenos"> 97</span></a><span class="sd">            tau (float): Exponential cutoff parameter.</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-98"><a href="#EPRTrajectory.truncated_power_law_pdf-98"><span class="linenos"> 98</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-99"><a href="#EPRTrajectory.truncated_power_law_pdf-99"><span class="linenos"> 99</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-100"><a href="#EPRTrajectory.truncated_power_law_pdf-100"><span class="linenos">100</span></a><span class="sd">            float: Value of the PDF at x.</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-101"><a href="#EPRTrajectory.truncated_power_law_pdf-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-102"><a href="#EPRTrajectory.truncated_power_law_pdf-102"><span class="linenos">102</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="EPRTrajectory.truncated_power_law_pdf-103"><a href="#EPRTrajectory.truncated_power_law_pdf-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">beta</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Truncated power-law probability density function (PDF).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x (float):</strong>  Value to evaluate the PDF at.</li>
<li><strong>beta (float):</strong>  Power-law exponent.</li>
<li><strong>tau (float):</strong>  Exponential cutoff parameter.</li>
<li><strong>xmin (int):</strong>  Minimum value for the power-law behavior.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Value of the PDF at x.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.log_likelihood" class="classattr">
                                        <input id="EPRTrajectory.log_likelihood-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log_likelihood</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">params</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>, </span><span class="param"><span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.log_likelihood-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.log_likelihood"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.log_likelihood-105"><a href="#EPRTrajectory.log_likelihood-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="EPRTrajectory.log_likelihood-106"><a href="#EPRTrajectory.log_likelihood-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.log_likelihood-107"><a href="#EPRTrajectory.log_likelihood-107"><span class="linenos">107</span></a><span class="sd">        Log-likelihood function for the truncated power-law distribution.</span>
</span><span id="EPRTrajectory.log_likelihood-108"><a href="#EPRTrajectory.log_likelihood-108"><span class="linenos">108</span></a>
</span><span id="EPRTrajectory.log_likelihood-109"><a href="#EPRTrajectory.log_likelihood-109"><span class="linenos">109</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.log_likelihood-110"><a href="#EPRTrajectory.log_likelihood-110"><span class="linenos">110</span></a><span class="sd">            params (list): List containing [beta, tau] parameters.</span>
</span><span id="EPRTrajectory.log_likelihood-111"><a href="#EPRTrajectory.log_likelihood-111"><span class="linenos">111</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="EPRTrajectory.log_likelihood-112"><a href="#EPRTrajectory.log_likelihood-112"><span class="linenos">112</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory.log_likelihood-113"><a href="#EPRTrajectory.log_likelihood-113"><span class="linenos">113</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.log_likelihood-114"><a href="#EPRTrajectory.log_likelihood-114"><span class="linenos">114</span></a><span class="sd">            float: Negative log-likelihood value.</span>
</span><span id="EPRTrajectory.log_likelihood-115"><a href="#EPRTrajectory.log_likelihood-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.log_likelihood-116"><a href="#EPRTrajectory.log_likelihood-116"><span class="linenos">116</span></a>        <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="EPRTrajectory.log_likelihood-117"><a href="#EPRTrajectory.log_likelihood-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="n">beta</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tau</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EPRTrajectory.log_likelihood-118"><a href="#EPRTrajectory.log_likelihood-118"><span class="linenos">118</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="EPRTrajectory.log_likelihood-119"><a href="#EPRTrajectory.log_likelihood-119"><span class="linenos">119</span></a>
</span><span id="EPRTrajectory.log_likelihood-120"><a href="#EPRTrajectory.log_likelihood-120"><span class="linenos">120</span></a>        <span class="n">ll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">)))</span>
</span><span id="EPRTrajectory.log_likelihood-121"><a href="#EPRTrajectory.log_likelihood-121"><span class="linenos">121</span></a>        <span class="n">normalization</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncated_power_law_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="EPRTrajectory.log_likelihood-122"><a href="#EPRTrajectory.log_likelihood-122"><span class="linenos">122</span></a>        <span class="n">ll</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">normalization</span><span class="p">)</span>
</span><span id="EPRTrajectory.log_likelihood-123"><a href="#EPRTrajectory.log_likelihood-123"><span class="linenos">123</span></a>
</span><span id="EPRTrajectory.log_likelihood-124"><a href="#EPRTrajectory.log_likelihood-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="o">-</span><span class="n">ll</span>
</span></pre></div>


            <div class="docstring"><p>Log-likelihood function for the truncated power-law distribution.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>params (list):</strong>  List containing [beta, tau] parameters.</li>
<li><strong>data (np.ndarray):</strong>  Array of observed data points.</li>
<li><strong>xmin (int):</strong>  Minimum value for the power-law behavior.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Negative log-likelihood value.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.estimate_beta_tau_mle" class="classattr">
                                        <input id="EPRTrajectory.estimate_beta_tau_mle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">estimate_beta_tau_mle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.estimate_beta_tau_mle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.estimate_beta_tau_mle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.estimate_beta_tau_mle-126"><a href="#EPRTrajectory.estimate_beta_tau_mle-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">estimate_beta_tau_mle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-127"><a href="#EPRTrajectory.estimate_beta_tau_mle-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-128"><a href="#EPRTrajectory.estimate_beta_tau_mle-128"><span class="linenos">128</span></a><span class="sd">        Estimate the parameters beta and tau of the truncated power-law distribution using</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-129"><a href="#EPRTrajectory.estimate_beta_tau_mle-129"><span class="linenos">129</span></a><span class="sd">        Maximum Likelihood Estimation (MLE).</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-130"><a href="#EPRTrajectory.estimate_beta_tau_mle-130"><span class="linenos">130</span></a>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-131"><a href="#EPRTrajectory.estimate_beta_tau_mle-131"><span class="linenos">131</span></a><span class="sd">        1. Initial guess for beta and tau.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-132"><a href="#EPRTrajectory.estimate_beta_tau_mle-132"><span class="linenos">132</span></a><span class="sd">        2. Bounds for beta and tau to ensure they are positive.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-133"><a href="#EPRTrajectory.estimate_beta_tau_mle-133"><span class="linenos">133</span></a><span class="sd">        3. Use scipy.optimize.minimize to find the parameters that minimize the negative log-likelihood.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-134"><a href="#EPRTrajectory.estimate_beta_tau_mle-134"><span class="linenos">134</span></a>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-135"><a href="#EPRTrajectory.estimate_beta_tau_mle-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-136"><a href="#EPRTrajectory.estimate_beta_tau_mle-136"><span class="linenos">136</span></a><span class="sd">            data (np.ndarray): Array of observed data points.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-137"><a href="#EPRTrajectory.estimate_beta_tau_mle-137"><span class="linenos">137</span></a><span class="sd">            xmin (int): Minimum value for the power-law behavior.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-138"><a href="#EPRTrajectory.estimate_beta_tau_mle-138"><span class="linenos">138</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-139"><a href="#EPRTrajectory.estimate_beta_tau_mle-139"><span class="linenos">139</span></a><span class="sd">            tuple[float | None, float | None]: Estimated (beta, tau) parameters or (None, None) if optimization fails.</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-140"><a href="#EPRTrajectory.estimate_beta_tau_mle-140"><span class="linenos">140</span></a><span class="sd">        The estimation process involves:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-141"><a href="#EPRTrajectory.estimate_beta_tau_mle-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-142"><a href="#EPRTrajectory.estimate_beta_tau_mle-142"><span class="linenos">142</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">]</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-143"><a href="#EPRTrajectory.estimate_beta_tau_mle-143"><span class="linenos">143</span></a>        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-144"><a href="#EPRTrajectory.estimate_beta_tau_mle-144"><span class="linenos">144</span></a>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-145"><a href="#EPRTrajectory.estimate_beta_tau_mle-145"><span class="linenos">145</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xmin</span><span class="p">),</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-146"><a href="#EPRTrajectory.estimate_beta_tau_mle-146"><span class="linenos">146</span></a>                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-147"><a href="#EPRTrajectory.estimate_beta_tau_mle-147"><span class="linenos">147</span></a>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-148"><a href="#EPRTrajectory.estimate_beta_tau_mle-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-149"><a href="#EPRTrajectory.estimate_beta_tau_mle-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-150"><a href="#EPRTrajectory.estimate_beta_tau_mle-150"><span class="linenos">150</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-151"><a href="#EPRTrajectory.estimate_beta_tau_mle-151"><span class="linenos">151</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization failed. Message: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.estimate_beta_tau_mle-152"><a href="#EPRTrajectory.estimate_beta_tau_mle-152"><span class="linenos">152</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Estimate the parameters beta and tau of the truncated power-law distribution using
Maximum Likelihood Estimation (MLE).</p>

<ol>
<li>Initial guess for beta and tau.</li>
<li>Bounds for beta and tau to ensure they are positive.</li>
<li>Use scipy.optimize.minimize to find the parameters that minimize the negative log-likelihood.</li>
</ol>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data (np.ndarray):</strong>  Array of observed data points.</li>
<li><strong>xmin (int):</strong>  Minimum value for the power-law behavior.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[float | None, float | None]: Estimated (beta, tau) parameters or (None, None) if optimization fails.</p>
</blockquote>

<p>The estimation process involves:</p>
</div>


                            </div>
                            <div id="EPRTrajectory.param_estimate" class="classattr">
                                        <input id="EPRTrajectory.param_estimate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">param_estimate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.param_estimate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.param_estimate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.param_estimate-154"><a href="#EPRTrajectory.param_estimate-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">param_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EPRTrajectory.param_estimate-155"><a href="#EPRTrajectory.param_estimate-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.param_estimate-156"><a href="#EPRTrajectory.param_estimate-156"><span class="linenos">156</span></a><span class="sd">        Estimate the EPR model parameters ($\gamma$ and $\rho$) from the raw trajectory data.</span>
</span><span id="EPRTrajectory.param_estimate-157"><a href="#EPRTrajectory.param_estimate-157"><span class="linenos">157</span></a>
</span><span id="EPRTrajectory.param_estimate-158"><a href="#EPRTrajectory.param_estimate-158"><span class="linenos">158</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory.param_estimate-159"><a href="#EPRTrajectory.param_estimate-159"><span class="linenos">159</span></a>
</span><span id="EPRTrajectory.param_estimate-160"><a href="#EPRTrajectory.param_estimate-160"><span class="linenos">160</span></a><span class="sd">        1. Resample the trajectory data to 1-hour intervals, selecting the label with the longest duration</span>
</span><span id="EPRTrajectory.param_estimate-161"><a href="#EPRTrajectory.param_estimate-161"><span class="linenos">161</span></a><span class="sd">        in each interval.</span>
</span><span id="EPRTrajectory.param_estimate-162"><a href="#EPRTrajectory.param_estimate-162"><span class="linenos">162</span></a><span class="sd">        2. Identify when a new place is visited and compute the cumulative number of distinct places visited, $S(t)$.</span>
</span><span id="EPRTrajectory.param_estimate-163"><a href="#EPRTrajectory.param_estimate-163"><span class="linenos">163</span></a><span class="sd">        3. Fit:</span>
</span><span id="EPRTrajectory.param_estimate-164"><a href="#EPRTrajectory.param_estimate-164"><span class="linenos">164</span></a><span class="sd">           - $n(t) \sim t^{\beta}$</span>
</span><span id="EPRTrajectory.param_estimate-165"><a href="#EPRTrajectory.param_estimate-165"><span class="linenos">165</span></a><span class="sd">           - $S(t) \sim t^{\alpha}$</span>
</span><span id="EPRTrajectory.param_estimate-166"><a href="#EPRTrajectory.param_estimate-166"><span class="linenos">166</span></a>
</span><span id="EPRTrajectory.param_estimate-167"><a href="#EPRTrajectory.param_estimate-167"><span class="linenos">167</span></a><span class="sd">           using linear regression on log-log transformed data.</span>
</span><span id="EPRTrajectory.param_estimate-168"><a href="#EPRTrajectory.param_estimate-168"><span class="linenos">168</span></a><span class="sd">        4. Compute $\gamma$ from the relationship:</span>
</span><span id="EPRTrajectory.param_estimate-169"><a href="#EPRTrajectory.param_estimate-169"><span class="linenos">169</span></a>
</span><span id="EPRTrajectory.param_estimate-170"><a href="#EPRTrajectory.param_estimate-170"><span class="linenos">170</span></a><span class="sd">           $$</span>
</span><span id="EPRTrajectory.param_estimate-171"><a href="#EPRTrajectory.param_estimate-171"><span class="linenos">171</span></a><span class="sd">           \alpha = \frac{\beta}{1 + \gamma}</span>
</span><span id="EPRTrajectory.param_estimate-172"><a href="#EPRTrajectory.param_estimate-172"><span class="linenos">172</span></a><span class="sd">           $$</span>
</span><span id="EPRTrajectory.param_estimate-173"><a href="#EPRTrajectory.param_estimate-173"><span class="linenos">173</span></a>
</span><span id="EPRTrajectory.param_estimate-174"><a href="#EPRTrajectory.param_estimate-174"><span class="linenos">174</span></a><span class="sd">        5. Compute $\rho$ from the prefactor relationship involving $K_{\text{est}}$, $C_{\text{est}}$, and $\gamma$.</span>
</span><span id="EPRTrajectory.param_estimate-175"><a href="#EPRTrajectory.param_estimate-175"><span class="linenos">175</span></a>
</span><span id="EPRTrajectory.param_estimate-176"><a href="#EPRTrajectory.param_estimate-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.param_estimate-177"><a href="#EPRTrajectory.param_estimate-177"><span class="linenos">177</span></a><span class="sd">            None: Updates the instance variables `self.gamma` and `self.rho` with estimated values.</span>
</span><span id="EPRTrajectory.param_estimate-178"><a href="#EPRTrajectory.param_estimate-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.param_estimate-179"><a href="#EPRTrajectory.param_estimate-179"><span class="linenos">179</span></a>
</span><span id="EPRTrajectory.param_estimate-180"><a href="#EPRTrajectory.param_estimate-180"><span class="linenos">180</span></a>        <span class="n">to_concat</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="EPRTrajectory.param_estimate-181"><a href="#EPRTrajectory.param_estimate-181"><span class="linenos">181</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_trajectory</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-182"><a href="#EPRTrajectory.param_estimate-182"><span class="linenos">182</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-183"><a href="#EPRTrajectory.param_estimate-183"><span class="linenos">183</span></a>        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="EPRTrajectory.param_estimate-184"><a href="#EPRTrajectory.param_estimate-184"><span class="linenos">184</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="o">~</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>  <span class="c1"># Remove duplicate timestamps within the same individual</span>
</span><span id="EPRTrajectory.param_estimate-185"><a href="#EPRTrajectory.param_estimate-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EPRTrajectory.param_estimate-186"><a href="#EPRTrajectory.param_estimate-186"><span class="linenos">186</span></a>                <span class="k">continue</span>
</span><span id="EPRTrajectory.param_estimate-187"><a href="#EPRTrajectory.param_estimate-187"><span class="linenos">187</span></a>            <span class="n">group</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Set time as the index for time-based operations</span>
</span><span id="EPRTrajectory.param_estimate-188"><a href="#EPRTrajectory.param_estimate-188"><span class="linenos">188</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-189"><a href="#EPRTrajectory.param_estimate-189"><span class="linenos">189</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">group</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-190"><a href="#EPRTrajectory.param_estimate-190"><span class="linenos">190</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;moved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-191"><a href="#EPRTrajectory.param_estimate-191"><span class="linenos">191</span></a>            <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;moved&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-192"><a href="#EPRTrajectory.param_estimate-192"><span class="linenos">192</span></a>            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-193"><a href="#EPRTrajectory.param_estimate-193"><span class="linenos">193</span></a>
</span><span id="EPRTrajectory.param_estimate-194"><a href="#EPRTrajectory.param_estimate-194"><span class="linenos">194</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-195"><a href="#EPRTrajectory.param_estimate-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EPRTrajectory.param_estimate-196"><a href="#EPRTrajectory.param_estimate-196"><span class="linenos">196</span></a>                <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longest_visited_row</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-197"><a href="#EPRTrajectory.param_estimate-197"><span class="linenos">197</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-198"><a href="#EPRTrajectory.param_estimate-198"><span class="linenos">198</span></a>            <span class="c1"># Fill missing data using forward-fill and backward-fill</span>
</span><span id="EPRTrajectory.param_estimate-199"><a href="#EPRTrajectory.param_estimate-199"><span class="linenos">199</span></a>            <span class="n">group_resampled</span> <span class="o">=</span> <span class="n">group_resampled</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="EPRTrajectory.param_estimate-200"><a href="#EPRTrajectory.param_estimate-200"><span class="linenos">200</span></a>
</span><span id="EPRTrajectory.param_estimate-201"><a href="#EPRTrajectory.param_estimate-201"><span class="linenos">201</span></a>            <span class="c1"># Store processed data for concatenation</span>
</span><span id="EPRTrajectory.param_estimate-202"><a href="#EPRTrajectory.param_estimate-202"><span class="linenos">202</span></a>            <span class="n">to_concat</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_resampled</span>
</span><span id="EPRTrajectory.param_estimate-203"><a href="#EPRTrajectory.param_estimate-203"><span class="linenos">203</span></a>        <span class="c1"># Combine all processed individual datasets back into a single DataFrame</span>
</span><span id="EPRTrajectory.param_estimate-204"><a href="#EPRTrajectory.param_estimate-204"><span class="linenos">204</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="EPRTrajectory.param_estimate-205"><a href="#EPRTrajectory.param_estimate-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="EPRTrajectory.param_estimate-206"><a href="#EPRTrajectory.param_estimate-206"><span class="linenos">206</span></a>            <span class="k">return</span>
</span><span id="EPRTrajectory.param_estimate-207"><a href="#EPRTrajectory.param_estimate-207"><span class="linenos">207</span></a>        <span class="c1"># Identify when a new place is visited for each individual</span>
</span><span id="EPRTrajectory.param_estimate-208"><a href="#EPRTrajectory.param_estimate-208"><span class="linenos">208</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">~</span><span class="n">x</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
</span><span id="EPRTrajectory.param_estimate-209"><a href="#EPRTrajectory.param_estimate-209"><span class="linenos">209</span></a>
</span><span id="EPRTrajectory.param_estimate-210"><a href="#EPRTrajectory.param_estimate-210"><span class="linenos">210</span></a>        <span class="c1"># Compute cumulative number of distinct places visited (S(t)) for each individual</span>
</span><span id="EPRTrajectory.param_estimate-211"><a href="#EPRTrajectory.param_estimate-211"><span class="linenos">211</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">is_new</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-212"><a href="#EPRTrajectory.param_estimate-212"><span class="linenos">212</span></a>
</span><span id="EPRTrajectory.param_estimate-213"><a href="#EPRTrajectory.param_estimate-213"><span class="linenos">213</span></a>        <span class="c1"># Compute the median number of observations per individual (to determine a common max time step) - cast to integer</span>
</span><span id="EPRTrajectory.param_estimate-214"><a href="#EPRTrajectory.param_estimate-214"><span class="linenos">214</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="EPRTrajectory.param_estimate-215"><a href="#EPRTrajectory.param_estimate-215"><span class="linenos">215</span></a>
</span><span id="EPRTrajectory.param_estimate-216"><a href="#EPRTrajectory.param_estimate-216"><span class="linenos">216</span></a>        <span class="c1"># Prepare averaged data for population-level analysis</span>
</span><span id="EPRTrajectory.param_estimate-217"><a href="#EPRTrajectory.param_estimate-217"><span class="linenos">217</span></a>        <span class="c1"># n_data: Sequence of step indices (1 to nrows)</span>
</span><span id="EPRTrajectory.param_estimate-218"><a href="#EPRTrajectory.param_estimate-218"><span class="linenos">218</span></a>        <span class="n">t_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-219"><a href="#EPRTrajectory.param_estimate-219"><span class="linenos">219</span></a>
</span><span id="EPRTrajectory.param_estimate-220"><a href="#EPRTrajectory.param_estimate-220"><span class="linenos">220</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
</span><span id="EPRTrajectory.param_estimate-221"><a href="#EPRTrajectory.param_estimate-221"><span class="linenos">221</span></a>        <span class="n">n_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_array</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="EPRTrajectory.param_estimate-222"><a href="#EPRTrajectory.param_estimate-222"><span class="linenos">222</span></a>
</span><span id="EPRTrajectory.param_estimate-223"><a href="#EPRTrajectory.param_estimate-223"><span class="linenos">223</span></a>        <span class="c1"># S_data: Mean S(n) across all individuals at each time step</span>
</span><span id="EPRTrajectory.param_estimate-224"><a href="#EPRTrajectory.param_estimate-224"><span class="linenos">224</span></a>        <span class="n">S_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;new_sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)])</span>
</span><span id="EPRTrajectory.param_estimate-225"><a href="#EPRTrajectory.param_estimate-225"><span class="linenos">225</span></a>
</span><span id="EPRTrajectory.param_estimate-226"><a href="#EPRTrajectory.param_estimate-226"><span class="linenos">226</span></a>        <span class="c1"># 1. Fit n(t) ~ t^beta - steps vs time</span>
</span><span id="EPRTrajectory.param_estimate-227"><a href="#EPRTrajectory.param_estimate-227"><span class="linenos">227</span></a>        <span class="n">log_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-228"><a href="#EPRTrajectory.param_estimate-228"><span class="linenos">228</span></a>        <span class="n">log_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-229"><a href="#EPRTrajectory.param_estimate-229"><span class="linenos">229</span></a>        <span class="n">slope_n</span><span class="p">,</span> <span class="n">intercept_n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_n</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-230"><a href="#EPRTrajectory.param_estimate-230"><span class="linenos">230</span></a>        <span class="n">beta_est</span> <span class="o">=</span> <span class="n">slope_n</span>
</span><span id="EPRTrajectory.param_estimate-231"><a href="#EPRTrajectory.param_estimate-231"><span class="linenos">231</span></a>        <span class="n">C_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_n</span><span class="p">)</span>  <span class="c1"># n(t) ~ C_est * t^beta_est</span>
</span><span id="EPRTrajectory.param_estimate-232"><a href="#EPRTrajectory.param_estimate-232"><span class="linenos">232</span></a>
</span><span id="EPRTrajectory.param_estimate-233"><a href="#EPRTrajectory.param_estimate-233"><span class="linenos">233</span></a>        <span class="c1"># 2. Fit S(t) ~ t^alpha</span>
</span><span id="EPRTrajectory.param_estimate-234"><a href="#EPRTrajectory.param_estimate-234"><span class="linenos">234</span></a>        <span class="n">log_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">S_array</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-235"><a href="#EPRTrajectory.param_estimate-235"><span class="linenos">235</span></a>        <span class="n">slope_s</span><span class="p">,</span> <span class="n">intercept_s</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">log_t</span><span class="p">,</span> <span class="n">log_S</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-236"><a href="#EPRTrajectory.param_estimate-236"><span class="linenos">236</span></a>        <span class="n">alpha_est</span> <span class="o">=</span> <span class="n">slope_s</span>
</span><span id="EPRTrajectory.param_estimate-237"><a href="#EPRTrajectory.param_estimate-237"><span class="linenos">237</span></a>        <span class="n">K_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">intercept_s</span><span class="p">)</span>  <span class="c1"># S(t) ~ K_est * t^alpha_est</span>
</span><span id="EPRTrajectory.param_estimate-238"><a href="#EPRTrajectory.param_estimate-238"><span class="linenos">238</span></a>
</span><span id="EPRTrajectory.param_estimate-239"><a href="#EPRTrajectory.param_estimate-239"><span class="linenos">239</span></a>        <span class="c1"># 3. Compute gamma from alpha = beta / (1 + gamma)</span>
</span><span id="EPRTrajectory.param_estimate-240"><a href="#EPRTrajectory.param_estimate-240"><span class="linenos">240</span></a>        <span class="n">gamma_est</span> <span class="o">=</span> <span class="n">beta_est</span> <span class="o">/</span> <span class="n">alpha_est</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="EPRTrajectory.param_estimate-241"><a href="#EPRTrajectory.param_estimate-241"><span class="linenos">241</span></a>
</span><span id="EPRTrajectory.param_estimate-242"><a href="#EPRTrajectory.param_estimate-242"><span class="linenos">242</span></a>        <span class="c1"># 4. Compute rho from the prefactor</span>
</span><span id="EPRTrajectory.param_estimate-243"><a href="#EPRTrajectory.param_estimate-243"><span class="linenos">243</span></a>        <span class="c1"># We have: K_est = (1 + gamma) * [rho * C_est]^(1/(1 + gamma))</span>
</span><span id="EPRTrajectory.param_estimate-244"><a href="#EPRTrajectory.param_estimate-244"><span class="linenos">244</span></a>        <span class="c1"># =&gt; ln(K_est) = ln(1 + gamma_est) + (1/(1 + gamma_est)) [ln(rho) + ln(C_est)]</span>
</span><span id="EPRTrajectory.param_estimate-245"><a href="#EPRTrajectory.param_estimate-245"><span class="linenos">245</span></a>        <span class="c1"># Solve for rho:</span>
</span><span id="EPRTrajectory.param_estimate-246"><a href="#EPRTrajectory.param_estimate-246"><span class="linenos">246</span></a>        <span class="c1">#    ln(rho) = (1 + gamma_est)* [ ln(K_est) - ln(1 + gamma_est) ] - ln(C_est)</span>
</span><span id="EPRTrajectory.param_estimate-247"><a href="#EPRTrajectory.param_estimate-247"><span class="linenos">247</span></a>        <span class="c1"># (Some algebra rearranging the terms.)</span>
</span><span id="EPRTrajectory.param_estimate-248"><a href="#EPRTrajectory.param_estimate-248"><span class="linenos">248</span></a>        <span class="c1"># It&#39;s often easier to do it step by step:</span>
</span><span id="EPRTrajectory.param_estimate-249"><a href="#EPRTrajectory.param_estimate-249"><span class="linenos">249</span></a>
</span><span id="EPRTrajectory.param_estimate-250"><a href="#EPRTrajectory.param_estimate-250"><span class="linenos">250</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K_est</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-251"><a href="#EPRTrajectory.param_estimate-251"><span class="linenos">251</span></a>        <span class="n">den</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gamma_est</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-252"><a href="#EPRTrajectory.param_estimate-252"><span class="linenos">252</span></a>        <span class="c1"># =&gt; num / den = ln(rho) + ln(C_est)</span>
</span><span id="EPRTrajectory.param_estimate-253"><a href="#EPRTrajectory.param_estimate-253"><span class="linenos">253</span></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">C_est</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-254"><a href="#EPRTrajectory.param_estimate-254"><span class="linenos">254</span></a>        <span class="n">rho_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-255"><a href="#EPRTrajectory.param_estimate-255"><span class="linenos">255</span></a>
</span><span id="EPRTrajectory.param_estimate-256"><a href="#EPRTrajectory.param_estimate-256"><span class="linenos">256</span></a>        <span class="c1"># self.beta = beta_est</span>
</span><span id="EPRTrajectory.param_estimate-257"><a href="#EPRTrajectory.param_estimate-257"><span class="linenos">257</span></a>        <span class="c1"># self.alpha = alpha_est</span>
</span><span id="EPRTrajectory.param_estimate-258"><a href="#EPRTrajectory.param_estimate-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_est</span>
</span><span id="EPRTrajectory.param_estimate-259"><a href="#EPRTrajectory.param_estimate-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho_est</span>
</span><span id="EPRTrajectory.param_estimate-260"><a href="#EPRTrajectory.param_estimate-260"><span class="linenos">260</span></a>
</span><span id="EPRTrajectory.param_estimate-261"><a href="#EPRTrajectory.param_estimate-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Estimated parameters:&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-262"><a href="#EPRTrajectory.param_estimate-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  beta (from n(t)):   </span><span class="si">{</span><span class="n">beta_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-263"><a href="#EPRTrajectory.param_estimate-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  alpha (from S(t)):  </span><span class="si">{</span><span class="n">alpha_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-264"><a href="#EPRTrajectory.param_estimate-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  gamma:              </span><span class="si">{</span><span class="n">gamma_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.param_estimate-265"><a href="#EPRTrajectory.param_estimate-265"><span class="linenos">265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  rho:                </span><span class="si">{</span><span class="n">rho_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Estimate the EPR model parameters ($\gamma$ and $\rho$) from the raw trajectory data.</p>

<p>Steps:</p>

<ol>
<li>Resample the trajectory data to 1-hour intervals, selecting the label with the longest duration
in each interval.</li>
<li>Identify when a new place is visited and compute the cumulative number of distinct places visited, $S(t)$.</li>
<li><p>Fit:</p>

<ul>
<li>$n(t) \sim t^{\beta}$</li>
<li>$S(t) \sim t^{\alpha}$</li>
</ul>

<p>using linear regression on log-log transformed data.</p></li>
<li><p>Compute $\gamma$ from the relationship:</p>

<p>$$
\alpha = \frac{\beta}{1 + \gamma}
$$</p></li>
<li><p>Compute $\rho$ from the prefactor relationship involving $K_{\text{est}}$, $C_{\text{est}}$, and $\gamma$.</p></li>
</ol>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None: Updates the instance variables <code>self.gamma</code> and <code>self.rho</code> with estimated values.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.process_generated_trajectory" class="classattr">
                                        <input id="EPRTrajectory.process_generated_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_generated_trajectory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">synt_traj</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.process_generated_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.process_generated_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.process_generated_trajectory-267"><a href="#EPRTrajectory.process_generated_trajectory-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_generated_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synt_traj</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="EPRTrajectory.process_generated_trajectory-268"><a href="#EPRTrajectory.process_generated_trajectory-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.process_generated_trajectory-269"><a href="#EPRTrajectory.process_generated_trajectory-269"><span class="linenos">269</span></a><span class="sd">        Process the generated trajectory to match the format of the original data. Assign tessellation IDs and resample</span>
</span><span id="EPRTrajectory.process_generated_trajectory-270"><a href="#EPRTrajectory.process_generated_trajectory-270"><span class="linenos">270</span></a><span class="sd">        to 1-hour intervals.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-271"><a href="#EPRTrajectory.process_generated_trajectory-271"><span class="linenos">271</span></a>
</span><span id="EPRTrajectory.process_generated_trajectory-272"><a href="#EPRTrajectory.process_generated_trajectory-272"><span class="linenos">272</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory.process_generated_trajectory-273"><a href="#EPRTrajectory.process_generated_trajectory-273"><span class="linenos">273</span></a>
</span><span id="EPRTrajectory.process_generated_trajectory-274"><a href="#EPRTrajectory.process_generated_trajectory-274"><span class="linenos">274</span></a><span class="sd">            1. Convert the generated trajectory to a GeoDataFrame and set the coordinate reference system (CRS).</span>
</span><span id="EPRTrajectory.process_generated_trajectory-275"><a href="#EPRTrajectory.process_generated_trajectory-275"><span class="linenos">275</span></a><span class="sd">            2. Perform a spatial join with the tessellation to assign tessellation IDs to each point.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-276"><a href="#EPRTrajectory.process_generated_trajectory-276"><span class="linenos">276</span></a><span class="sd">            3. Rename columns to match the original data format.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-277"><a href="#EPRTrajectory.process_generated_trajectory-277"><span class="linenos">277</span></a><span class="sd">            4. Resample the trajectory to 1-hour intervals, ensuring that each agent&#39;s trajectory is continuous.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-278"><a href="#EPRTrajectory.process_generated_trajectory-278"><span class="linenos">278</span></a><span class="sd">            5. Create a new GeoDataFrame with the resampled data, including latitude and longitude columns.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-279"><a href="#EPRTrajectory.process_generated_trajectory-279"><span class="linenos">279</span></a>
</span><span id="EPRTrajectory.process_generated_trajectory-280"><a href="#EPRTrajectory.process_generated_trajectory-280"><span class="linenos">280</span></a><span class="sd">        Args:</span>
</span><span id="EPRTrajectory.process_generated_trajectory-281"><a href="#EPRTrajectory.process_generated_trajectory-281"><span class="linenos">281</span></a><span class="sd">            synt_traj (gpd.GeoDataFrame): Generated trajectory from the EPR model.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-282"><a href="#EPRTrajectory.process_generated_trajectory-282"><span class="linenos">282</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.process_generated_trajectory-283"><a href="#EPRTrajectory.process_generated_trajectory-283"><span class="linenos">283</span></a><span class="sd">            gpd.GeoDataFrame: Processed trajectory with tessellation IDs and resampled to 1-hour intervals.</span>
</span><span id="EPRTrajectory.process_generated_trajectory-284"><a href="#EPRTrajectory.process_generated_trajectory-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.process_generated_trajectory-285"><a href="#EPRTrajectory.process_generated_trajectory-285"><span class="linenos">285</span></a>        <span class="n">trajectory_processor</span> <span class="o">=</span> <span class="n">TrajectoryProcessor</span><span class="p">()</span>
</span><span id="EPRTrajectory.process_generated_trajectory-286"><a href="#EPRTrajectory.process_generated_trajectory-286"><span class="linenos">286</span></a>
</span><span id="EPRTrajectory.process_generated_trajectory-287"><a href="#EPRTrajectory.process_generated_trajectory-287"><span class="linenos">287</span></a>        <span class="n">generated_traj</span> <span class="o">=</span> <span class="n">synt_traj</span><span class="o">.</span><span class="n">to_geodataframe</span><span class="p">()</span>
</span><span id="EPRTrajectory.process_generated_trajectory-288"><a href="#EPRTrajectory.process_generated_trajectory-288"><span class="linenos">288</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-289"><a href="#EPRTrajectory.process_generated_trajectory-289"><span class="linenos">289</span></a>        <span class="n">generated_traj_joined_with_tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="EPRTrajectory.process_generated_trajectory-290"><a href="#EPRTrajectory.process_generated_trajectory-290"><span class="linenos">290</span></a>                                                            <span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;intersects&#39;</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-291"><a href="#EPRTrajectory.process_generated_trajectory-291"><span class="linenos">291</span></a>        <span class="n">generated_traj</span><span class="p">[</span><span class="s1">&#39;tessellation_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generated_traj_joined_with_tessellation</span><span class="p">[</span><span class="s1">&#39;index_right&#39;</span><span class="p">]</span>
</span><span id="EPRTrajectory.process_generated_trajectory-292"><a href="#EPRTrajectory.process_generated_trajectory-292"><span class="linenos">292</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span><span class="p">:</span> <span class="s1">&#39;lon&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-293"><a href="#EPRTrajectory.process_generated_trajectory-293"><span class="linenos">293</span></a>        <span class="n">generated_traj</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-294"><a href="#EPRTrajectory.process_generated_trajectory-294"><span class="linenos">294</span></a>
</span><span id="EPRTrajectory.process_generated_trajectory-295"><a href="#EPRTrajectory.process_generated_trajectory-295"><span class="linenos">295</span></a>        <span class="n">resampled_generated_traj</span> <span class="o">=</span> <span class="n">trajectory_processor</span><span class="o">.</span><span class="n">resample_time</span><span class="p">(</span><span class="n">generated_traj</span><span class="p">,</span> <span class="s1">&#39;1h&#39;</span><span class="p">,</span> <span class="s1">&#39;tessellation_id&#39;</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-296"><a href="#EPRTrajectory.process_generated_trajectory-296"><span class="linenos">296</span></a>        <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s1">&#39;animal_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-297"><a href="#EPRTrajectory.process_generated_trajectory-297"><span class="linenos">297</span></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="p">,</span>
</span><span id="EPRTrajectory.process_generated_trajectory-298"><a href="#EPRTrajectory.process_generated_trajectory-298"><span class="linenos">298</span></a>                               <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">resampled_generated_traj</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
</span><span id="EPRTrajectory.process_generated_trajectory-299"><a href="#EPRTrajectory.process_generated_trajectory-299"><span class="linenos">299</span></a>                               <span class="n">crs</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</span><span id="EPRTrajectory.process_generated_trajectory-300"><a href="#EPRTrajectory.process_generated_trajectory-300"><span class="linenos">300</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
</span><span id="EPRTrajectory.process_generated_trajectory-301"><a href="#EPRTrajectory.process_generated_trajectory-301"><span class="linenos">301</span></a>        <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
</span><span id="EPRTrajectory.process_generated_trajectory-302"><a href="#EPRTrajectory.process_generated_trajectory-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">gdf</span>
</span></pre></div>


            <div class="docstring"><p>Process the generated trajectory to match the format of the original data. Assign tessellation IDs and resample
to 1-hour intervals.</p>

<h6 id="steps">Steps:</h6>

<blockquote>
  <ol>
  <li>Convert the generated trajectory to a GeoDataFrame and set the coordinate reference system (CRS).</li>
  <li>Perform a spatial join with the tessellation to assign tessellation IDs to each point.</li>
  <li>Rename columns to match the original data format.</li>
  <li>Resample the trajectory to 1-hour intervals, ensuring that each agent's trajectory is continuous.</li>
  <li>Create a new GeoDataFrame with the resampled data, including latitude and longitude columns.</li>
  </ol>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>synt_traj (gpd.GeoDataFrame):</strong>  Generated trajectory from the EPR model.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>gpd.GeoDataFrame: Processed trajectory with tessellation IDs and resampled to 1-hour intervals.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.find_best_fit" class="classattr">
                                        <input id="EPRTrajectory.find_best_fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_best_fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">distfit</span><span class="o">.</span><span class="n">distfit</span><span class="o">.</span><span class="n">distfit</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.find_best_fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.find_best_fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.find_best_fit-304"><a href="#EPRTrajectory.find_best_fit-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_best_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">distfit</span><span class="p">:</span>
</span><span id="EPRTrajectory.find_best_fit-305"><a href="#EPRTrajectory.find_best_fit-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.find_best_fit-306"><a href="#EPRTrajectory.find_best_fit-306"><span class="linenos">306</span></a><span class="sd">        Fit various statistical distributions to the waiting times derived from the trajectory data and identify the</span>
</span><span id="EPRTrajectory.find_best_fit-307"><a href="#EPRTrajectory.find_best_fit-307"><span class="linenos">307</span></a><span class="sd">        best-fitting distribution.</span>
</span><span id="EPRTrajectory.find_best_fit-308"><a href="#EPRTrajectory.find_best_fit-308"><span class="linenos">308</span></a>
</span><span id="EPRTrajectory.find_best_fit-309"><a href="#EPRTrajectory.find_best_fit-309"><span class="linenos">309</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory.find_best_fit-310"><a href="#EPRTrajectory.find_best_fit-310"><span class="linenos">310</span></a>
</span><span id="EPRTrajectory.find_best_fit-311"><a href="#EPRTrajectory.find_best_fit-311"><span class="linenos">311</span></a><span class="sd">            1. Compressing the trajectory to identify distinct locations and their associated waiting times.</span>
</span><span id="EPRTrajectory.find_best_fit-312"><a href="#EPRTrajectory.find_best_fit-312"><span class="linenos">312</span></a><span class="sd">            2. Calculating waiting times as the duration spent at each location.</span>
</span><span id="EPRTrajectory.find_best_fit-313"><a href="#EPRTrajectory.find_best_fit-313"><span class="linenos">313</span></a><span class="sd">            3. Using the `distfit` library to fit a range of distributions to the waiting time data.</span>
</span><span id="EPRTrajectory.find_best_fit-314"><a href="#EPRTrajectory.find_best_fit-314"><span class="linenos">314</span></a><span class="sd">            4. Evaluating the goodness-of-fit using the Wasserstein distance metric.</span>
</span><span id="EPRTrajectory.find_best_fit-315"><a href="#EPRTrajectory.find_best_fit-315"><span class="linenos">315</span></a><span class="sd">            5. Plotting the best-fitting distribution against the empirical data for visual assessment.</span>
</span><span id="EPRTrajectory.find_best_fit-316"><a href="#EPRTrajectory.find_best_fit-316"><span class="linenos">316</span></a><span class="sd">            6. Saving the plots to the specified output directory.</span>
</span><span id="EPRTrajectory.find_best_fit-317"><a href="#EPRTrajectory.find_best_fit-317"><span class="linenos">317</span></a>
</span><span id="EPRTrajectory.find_best_fit-318"><a href="#EPRTrajectory.find_best_fit-318"><span class="linenos">318</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.find_best_fit-319"><a href="#EPRTrajectory.find_best_fit-319"><span class="linenos">319</span></a><span class="sd">            distfit: Fitted distfit object containing the best-fitting distribution and parameters.</span>
</span><span id="EPRTrajectory.find_best_fit-320"><a href="#EPRTrajectory.find_best_fit-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.find_best_fit-321"><a href="#EPRTrajectory.find_best_fit-321"><span class="linenos">321</span></a>        <span class="n">trajectory_compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">trajectory_compression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filtered_data_means</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-322"><a href="#EPRTrajectory.find_best_fit-322"><span class="linenos">322</span></a>        <span class="n">waiting_times_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_processor</span><span class="o">.</span><span class="n">waiting_times</span><span class="p">(</span><span class="n">trajectory_compressed</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-323"><a href="#EPRTrajectory.find_best_fit-323"><span class="linenos">323</span></a>        <span class="n">dfit</span> <span class="o">=</span> <span class="n">distfit</span><span class="p">(</span>
</span><span id="EPRTrajectory.find_best_fit-324"><a href="#EPRTrajectory.find_best_fit-324"><span class="linenos">324</span></a>            <span class="n">distr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="s1">&#39;expon&#39;</span><span class="p">,</span> <span class="s1">&#39;pareto&#39;</span><span class="p">,</span> <span class="s1">&#39;dweibull&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;genextreme&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;lognorm&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
</span><span id="EPRTrajectory.find_best_fit-325"><a href="#EPRTrajectory.find_best_fit-325"><span class="linenos">325</span></a>                   <span class="s1">&#39;loggamma&#39;</span><span class="p">,</span> <span class="s1">&#39;truncexpon&#39;</span><span class="p">,</span> <span class="s1">&#39;truncnorm&#39;</span><span class="p">,</span> <span class="s1">&#39;truncpareto&#39;</span><span class="p">,</span> <span class="s1">&#39;powerlaw&#39;</span><span class="p">],</span> <span class="n">stats</span><span class="o">=</span><span class="s2">&quot;wasserstein&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-326"><a href="#EPRTrajectory.find_best_fit-326"><span class="linenos">326</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">waiting_times_df</span><span class="p">[</span><span class="s2">&quot;waiting_time&quot;</span><span class="p">])</span>
</span><span id="EPRTrajectory.find_best_fit-327"><a href="#EPRTrajectory.find_best_fit-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best fit: </span><span class="si">{</span><span class="n">dfit</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-328"><a href="#EPRTrajectory.find_best_fit-328"><span class="linenos">328</span></a>
</span><span id="EPRTrajectory.find_best_fit-329"><a href="#EPRTrajectory.find_best_fit-329"><span class="linenos">329</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="EPRTrajectory.find_best_fit-330"><a href="#EPRTrajectory.find_best_fit-330"><span class="linenos">330</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="EPRTrajectory.find_best_fit-331"><a href="#EPRTrajectory.find_best_fit-331"><span class="linenos">331</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit.png&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-332"><a href="#EPRTrajectory.find_best_fit-332"><span class="linenos">332</span></a>
</span><span id="EPRTrajectory.find_best_fit-333"><a href="#EPRTrajectory.find_best_fit-333"><span class="linenos">333</span></a>        <span class="n">dfit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="EPRTrajectory.find_best_fit-334"><a href="#EPRTrajectory.find_best_fit-334"><span class="linenos">334</span></a>            <span class="n">pdf_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#472D30&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">},</span>
</span><span id="EPRTrajectory.find_best_fit-335"><a href="#EPRTrajectory.find_best_fit-335"><span class="linenos">335</span></a>            <span class="n">bar_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory.find_best_fit-336"><a href="#EPRTrajectory.find_best_fit-336"><span class="linenos">336</span></a>            <span class="n">cii_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EPRTrajectory.find_best_fit-337"><a href="#EPRTrajectory.find_best_fit-337"><span class="linenos">337</span></a>            <span class="n">emp_properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#E26D5C&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">},</span>
</span><span id="EPRTrajectory.find_best_fit-338"><a href="#EPRTrajectory.find_best_fit-338"><span class="linenos">338</span></a>            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="EPRTrajectory.find_best_fit-339"><a href="#EPRTrajectory.find_best_fit-339"><span class="linenos">339</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
</span><span id="EPRTrajectory.find_best_fit-340"><a href="#EPRTrajectory.find_best_fit-340"><span class="linenos">340</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_path</span><span class="si">}</span><span class="s2">/best_fit_.png&quot;</span><span class="p">)</span>
</span><span id="EPRTrajectory.find_best_fit-341"><a href="#EPRTrajectory.find_best_fit-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="n">dfit</span>
</span></pre></div>


            <div class="docstring"><p>Fit various statistical distributions to the waiting times derived from the trajectory data and identify the
best-fitting distribution.</p>

<h6 id="steps">Steps:</h6>

<blockquote>
  <ol>
  <li>Compressing the trajectory to identify distinct locations and their associated waiting times.</li>
  <li>Calculating waiting times as the duration spent at each location.</li>
  <li>Using the <code>distfit</code> library to fit a range of distributions to the waiting time data.</li>
  <li>Evaluating the goodness-of-fit using the Wasserstein distance metric.</li>
  <li>Plotting the best-fitting distribution against the empirical data for visual assessment.</li>
  <li>Saving the plots to the specified output directory.</li>
  </ol>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>distfit: Fitted distfit object containing the best-fitting distribution and parameters.</p>
</blockquote>
</div>


                            </div>
                            <div id="EPRTrajectory.generate_trajectory" class="classattr">
                                        <input id="EPRTrajectory.generate_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>:</span></span>

                <label class="view-source-button" for="EPRTrajectory.generate_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EPRTrajectory.generate_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EPRTrajectory.generate_trajectory-343"><a href="#EPRTrajectory.generate_trajectory-343"><span class="linenos">343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="EPRTrajectory.generate_trajectory-344"><a href="#EPRTrajectory.generate_trajectory-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.generate_trajectory-345"><a href="#EPRTrajectory.generate_trajectory-345"><span class="linenos">345</span></a><span class="sd">        Generate synthetic trajectories using the EPR model with estimated parameters.</span>
</span><span id="EPRTrajectory.generate_trajectory-346"><a href="#EPRTrajectory.generate_trajectory-346"><span class="linenos">346</span></a>
</span><span id="EPRTrajectory.generate_trajectory-347"><a href="#EPRTrajectory.generate_trajectory-347"><span class="linenos">347</span></a><span class="sd">        Steps:</span>
</span><span id="EPRTrajectory.generate_trajectory-348"><a href="#EPRTrajectory.generate_trajectory-348"><span class="linenos">348</span></a>
</span><span id="EPRTrajectory.generate_trajectory-349"><a href="#EPRTrajectory.generate_trajectory-349"><span class="linenos">349</span></a><span class="sd">            1. Copying the starting positions for agents.</span>
</span><span id="EPRTrajectory.generate_trajectory-350"><a href="#EPRTrajectory.generate_trajectory-350"><span class="linenos">350</span></a><span class="sd">            2. Finding the best-fitting distribution for waiting times using the `find_best_fit` method.</span>
</span><span id="EPRTrajectory.generate_trajectory-351"><a href="#EPRTrajectory.generate_trajectory-351"><span class="linenos">351</span></a><span class="sd">            3. Initializing the DensityEPR model with the estimated parameters (rho and gamma).</span>
</span><span id="EPRTrajectory.generate_trajectory-352"><a href="#EPRTrajectory.generate_trajectory-352"><span class="linenos">352</span></a><span class="sd">            4. Generating synthetic trajectories for the specified number of agents over the defined time period and</span>
</span><span id="EPRTrajectory.generate_trajectory-353"><a href="#EPRTrajectory.generate_trajectory-353"><span class="linenos">353</span></a><span class="sd">            spatial tessellation.</span>
</span><span id="EPRTrajectory.generate_trajectory-354"><a href="#EPRTrajectory.generate_trajectory-354"><span class="linenos">354</span></a><span class="sd">            5. Processing the generated trajectory to match the format of the original data using</span>
</span><span id="EPRTrajectory.generate_trajectory-355"><a href="#EPRTrajectory.generate_trajectory-355"><span class="linenos">355</span></a><span class="sd">            the `process_generated_trajectory` method.</span>
</span><span id="EPRTrajectory.generate_trajectory-356"><a href="#EPRTrajectory.generate_trajectory-356"><span class="linenos">356</span></a><span class="sd">            6. Returning the processed synthetic trajectory as a GeoDataFrame.</span>
</span><span id="EPRTrajectory.generate_trajectory-357"><a href="#EPRTrajectory.generate_trajectory-357"><span class="linenos">357</span></a>
</span><span id="EPRTrajectory.generate_trajectory-358"><a href="#EPRTrajectory.generate_trajectory-358"><span class="linenos">358</span></a><span class="sd">        Returns:</span>
</span><span id="EPRTrajectory.generate_trajectory-359"><a href="#EPRTrajectory.generate_trajectory-359"><span class="linenos">359</span></a><span class="sd">            gpd.GeoDataFrame: Processed synthetic trajectory generated by the EPR model.</span>
</span><span id="EPRTrajectory.generate_trajectory-360"><a href="#EPRTrajectory.generate_trajectory-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EPRTrajectory.generate_trajectory-361"><a href="#EPRTrajectory.generate_trajectory-361"><span class="linenos">361</span></a>        <span class="n">starting_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="EPRTrajectory.generate_trajectory-362"><a href="#EPRTrajectory.generate_trajectory-362"><span class="linenos">362</span></a>        <span class="n">wt_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_best_fit</span><span class="p">()</span>
</span><span id="EPRTrajectory.generate_trajectory-363"><a href="#EPRTrajectory.generate_trajectory-363"><span class="linenos">363</span></a>
</span><span id="EPRTrajectory.generate_trajectory-364"><a href="#EPRTrajectory.generate_trajectory-364"><span class="linenos">364</span></a>        <span class="c1"># min_wait_time_minutes = 20</span>
</span><span id="EPRTrajectory.generate_trajectory-365"><a href="#EPRTrajectory.generate_trajectory-365"><span class="linenos">365</span></a>        <span class="c1"># compressed_traj_data = self.geo_processor.trajectory_compression(self.filtered_data_means)</span>
</span><span id="EPRTrajectory.generate_trajectory-366"><a href="#EPRTrajectory.generate_trajectory-366"><span class="linenos">366</span></a>        <span class="c1"># waiting_times_data = self.geo_processor.waiting_times(compressed_traj_data)[&quot;waiting_time&quot;]</span>
</span><span id="EPRTrajectory.generate_trajectory-367"><a href="#EPRTrajectory.generate_trajectory-367"><span class="linenos">367</span></a>        <span class="c1"># estimated_beta, estimated_tau = self.estimate_beta_tau_mle(waiting_times_data.dropna().values, min_wait_time_minutes)</span>
</span><span id="EPRTrajectory.generate_trajectory-368"><a href="#EPRTrajectory.generate_trajectory-368"><span class="linenos">368</span></a>        <span class="c1"># self.logger.info(&quot;Estimated parameters KK:&quot;)</span>
</span><span id="EPRTrajectory.generate_trajectory-369"><a href="#EPRTrajectory.generate_trajectory-369"><span class="linenos">369</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated beta: {self.beta}&quot;)</span>
</span><span id="EPRTrajectory.generate_trajectory-370"><a href="#EPRTrajectory.generate_trajectory-370"><span class="linenos">370</span></a>        <span class="c1"># self.logger.info(f&quot;Estimated tau: {self.tau}&quot;)</span>
</span><span id="EPRTrajectory.generate_trajectory-371"><a href="#EPRTrajectory.generate_trajectory-371"><span class="linenos">371</span></a>
</span><span id="EPRTrajectory.generate_trajectory-372"><a href="#EPRTrajectory.generate_trajectory-372"><span class="linenos">372</span></a>        <span class="n">epr</span> <span class="o">=</span> <span class="n">DensityEPR</span><span class="p">(</span><span class="n">wt_model</span><span class="o">=</span><span class="n">wt_model</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
</span><span id="EPRTrajectory.generate_trajectory-373"><a href="#EPRTrajectory.generate_trajectory-373"><span class="linenos">373</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="n">epr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
</span><span id="EPRTrajectory.generate_trajectory-374"><a href="#EPRTrajectory.generate_trajectory-374"><span class="linenos">374</span></a>                                 <span class="n">spatial_tessellation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_agents</span><span class="p">,</span>
</span><span id="EPRTrajectory.generate_trajectory-375"><a href="#EPRTrajectory.generate_trajectory-375"><span class="linenos">375</span></a>                                 <span class="n">starting_locations</span><span class="o">=</span><span class="n">starting_points</span><span class="p">,</span>
</span><span id="EPRTrajectory.generate_trajectory-376"><a href="#EPRTrajectory.generate_trajectory-376"><span class="linenos">376</span></a>                                 <span class="n">relevance_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epr_params</span><span class="o">.</span><span class="n">relevance_column</span><span class="p">,</span>
</span><span id="EPRTrajectory.generate_trajectory-377"><a href="#EPRTrajectory.generate_trajectory-377"><span class="linenos">377</span></a>                                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="EPRTrajectory.generate_trajectory-378"><a href="#EPRTrajectory.generate_trajectory-378"><span class="linenos">378</span></a>        <span class="n">synt_traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_generated_trajectory</span><span class="p">(</span><span class="n">synt_traj</span><span class="p">)</span>
</span><span id="EPRTrajectory.generate_trajectory-379"><a href="#EPRTrajectory.generate_trajectory-379"><span class="linenos">379</span></a>        <span class="k">return</span> <span class="n">synt_traj</span>
</span></pre></div>


            <div class="docstring"><p>Generate synthetic trajectories using the EPR model with estimated parameters.</p>

<h6 id="steps">Steps:</h6>

<blockquote>
  <ol>
  <li>Copying the starting positions for agents.</li>
  <li>Finding the best-fitting distribution for waiting times using the <code><a href="#EPRTrajectory.find_best_fit">find_best_fit</a></code> method.</li>
  <li>Initializing the DensityEPR model with the estimated parameters (rho and gamma).</li>
  <li>Generating synthetic trajectories for the specified number of agents over the defined time period and
  spatial tessellation.</li>
  <li>Processing the generated trajectory to match the format of the original data using
  the <code><a href="#EPRTrajectory.process_generated_trajectory">process_generated_trajectory</a></code> method.</li>
  <li>Returning the processed synthetic trajectory as a GeoDataFrame.</li>
  </ol>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>gpd.GeoDataFrame: Processed synthetic trajectory generated by the EPR model.</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>