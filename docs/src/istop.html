<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>src.istop API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../src.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;src</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DataAnalystInfostop">DataAnalystInfostop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DataAnalystInfostop.__init__">DataAnalystInfostop</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataAnalystInfostop.pdf_object">pdf_object</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataAnalystInfostop.output_path">output_path</a>
                        </li>
                        <li>
                                <a class="function" href="#DataAnalystInfostop.generate_raport">generate_raport</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DataFilter">DataFilter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DataFilter.__init__">DataFilter</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataFilter.pdf_object">pdf_object</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataFilter.allowed_minutes">allowed_minutes</a>
                        </li>
                        <li>
                                <a class="variable" href="#DataFilter.day_window">day_window</a>
                        </li>
                        <li>
                                <a class="function" href="#DataFilter.select_best_period">select_best_period</a>
                        </li>
                        <li>
                                <a class="function" href="#DataFilter.filter_data">filter_data</a>
                        </li>
                        <li>
                                <a class="function" href="#DataFilter.sort_data">sort_data</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LabelsCalc">LabelsCalc</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LabelsCalc.__init__">LabelsCalc</a>
                        </li>
                        <li>
                                <a class="variable" href="#LabelsCalc.pdf_object">pdf_object</a>
                        </li>
                        <li>
                                <a class="variable" href="#LabelsCalc.output_path">output_path</a>
                        </li>
                        <li>
                                <a class="function" href="#LabelsCalc.calculate_infostop">calculate_infostop</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#InfoStopData">InfoStopData</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#InfoStopData.__init__">InfoStopData</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfoStopData.clean_data">clean_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfoStopData.animal_name">animal_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfoStopData.output_dir">output_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfoStopData.output_dir_animal">output_dir_animal</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfoStopData.pdf">pdf</a>
                        </li>
                        <li>
                                <a class="function" href="#InfoStopData.calculate_all">calculate_all</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../src.html">src</a><wbr>.istop    </h1>

                        <div class="docstring"><p>Module for data analysis and labeling using the Infostop algorithm.</p>

<p>This module provides functionality for analyzing trajectory data
and identifying "stops" and "moves" using the Infostop algorithm.
It includes multiple classes and methods designed to handle the
following tasks:</p>

<ul>
<li>Filtering and processing trajectory data.</li>
<li>Applying the Infostop algorithm to detect stops based on location and time.</li>
<li>Computing and visualizing optimal parameters for the Infostop algorithm.</li>
<li>Generating reports and plots for analysis.</li>
</ul>
</div>

                        <input id="mod-istop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-istop-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Module for data analysis and labeling using the Infostop algorithm.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">This module provides functionality for analyzing trajectory data</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">and identifying &quot;stops&quot; and &quot;moves&quot; using the Infostop algorithm.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">It includes multiple classes and methods designed to handle the</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">following tasks:</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">- Filtering and processing trajectory data.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">- Applying the Infostop algorithm to detect stops based on location and time.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">- Computing and visualizing optimal parameters for the Infostop algorithm.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">- Generating reports and plots for analysis.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">infostop</span> <span class="kn">import</span> <span class="n">Infostop</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="n">silhouette_score</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="n">calinski_harabasz_score</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">davies_bouldin_score</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span> <span class="nn">fpdf</span> <span class="kn">import</span> <span class="n">FPDF</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">humobi.structures.trajectory</span> <span class="kn">import</span> <span class="n">TrajectoriesFrame</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span> <span class="nn">humobi.tools.user_statistics</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="n">fraction_of_empty_records</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>    <span class="n">count_records</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">count_records_per_time_frame</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="n">user_trajectories_duration</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="n">consecutive_record</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span> <span class="nn">constans</span> <span class="kn">import</span> <span class="n">const</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">import</span> <span class="nn">matplotlib</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Pandas doesn&#39;t allow columns to be created via a new attribute name&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="k">class</span> <span class="nc">DataAnalystInfostop</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    A class responsible for generating data analysis reports in PDF format.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    Parameters</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">    ----------</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">    pdf_object : FPDF</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        PDF instance to which the analysis results will be added.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        Initializes the DataAnalystInfostop with a given PDF instance.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        Parameters</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        ----------</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">            PDF instance where analysis results will be written.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="k">def</span> <span class="nf">generate_raport</span><span class="p">(</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>            <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        Generates a data analysis report, adding results and visualizations</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        to the PDF.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        Parameters</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        ----------</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">            Analysis identifier used in titles and filenames.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">        Notes</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        -----</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        Executes a data analysis pipeline, generating various statistical</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        metrics and plots, which are sequentially added to the PDF document.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_analyst_title</span><span class="p">(</span><span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_basic_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_total_records_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_trajctories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_average_temporal_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        Adds a single line of text to the PDF.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        Parameters</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        ----------</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        txt_to_add : str</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">            Text to be added to the PDF document.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_plot</span><span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>        <span class="n">plot_obj</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="n">x_position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        Adds a plot to the PDF at the current cursor position.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        Parameters</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        ----------</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        plot_obj : BytesIO</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">            Plot image to add to the PDF.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        image_width : int</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">            Width of the plot in the PDF.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        image_height : int</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">            Height of the plot in the PDF.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        x_position : int, optional</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">            X-coordinate position of the plot, by default 10.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="n">y_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">image</span><span class="p">(</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="n">plot_obj</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">x_position</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>            <span class="n">y</span><span class="o">=</span><span class="n">y_position</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">w</span><span class="o">=</span><span class="n">image_width</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="n">h</span><span class="o">=</span><span class="n">image_height</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">y_position</span> <span class="o">+</span> <span class="n">image_height</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="n">plot_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="k">def</span> <span class="nf">_plot_fraction_of_empty_records</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        Generates a plot showing the fraction of empty records by threshold.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        Parameters</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        ----------</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        frac : Series</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">            Series containing fraction of empty records.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">            Analysis identifier for the plot filename.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        Returns</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        -------</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        BytesIO</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">            In-memory image buffer of the generated plot.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">num_of_complete</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="n">threshold</span><span class="p">:</span> <span class="p">(</span><span class="n">frac</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="p">}</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_of_complete</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">num_of_complete</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Counts_frac vs. Threshold&quot;</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Threshold&quot;</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts_frac&quot;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                <span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                <span class="sa">f</span><span class="s2">&quot;Counts frac vs Threshold.png&quot;</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">_plot_distribution</span><span class="p">(</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">        Generates a distribution plot of the given data.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        Parameters</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        ----------</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        data : Series or array-like</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">            Data to plot.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        plot_name : str</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">            Filename for saving the plot.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        bins : int, optional</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">            Number of bins for the histogram, by default 10.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        Returns</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        -------</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        BytesIO</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">            In-memory image buffer of the generated distribution plot.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">))</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>    <span class="k">def</span> <span class="nf">_add_analyst_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Adds the title of the analysis section to the PDF.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        Parameters</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        ----------</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">            Analysis identifier used in the title.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Analysis: </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="k">def</span> <span class="nf">_add_basic_statistics</span><span class="p">(</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        Adds basic statistics to the PDF, including the number of animals</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        and fraction of empty records.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">        Parameters</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        ----------</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="n">number_of_animals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals: </span><span class="si">{</span><span class="n">number_of_animals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">frac</span> <span class="o">=</span> <span class="n">fraction_of_empty_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">frac_median</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="n">frac_mean</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_fraction_of_empty_records</span><span class="p">(</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="n">frac</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="n">data_analyst_no</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction of empty records (median): &quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frac_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction of empty records (mean): </span><span class="si">{</span><span class="n">frac_mean</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>    <span class="k">def</span> <span class="nf">_add_total_records_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">        Adds total record statistics to the PDF, including median</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        and mean values.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        Parameters</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">        ----------</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="n">count_records</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="n">count_median</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="n">count_mean</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of records (median): </span><span class="si">{</span><span class="n">count_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records (mean): </span><span class="si">{</span><span class="n">count_mean</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="sa">f</span><span class="s2">&quot;Total numbers of records.png&quot;</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="nf">_add_records_per_time_frame</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">        Adds statistics on records per specified time frame to the PDF.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        Parameters</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">        ----------</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">        resolution : str</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">            Time resolution for analysis (e.g., &#39;1D&#39;, &#39;1H&#39;).</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="n">count_per_time_frame</span> <span class="o">=</span> <span class="n">count_records_per_time_frame</span><span class="p">(</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="n">count_per_time_frame_median</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="n">count_per_time_frame_mean</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records per time frame </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="sa">f</span><span class="s2">&quot;(median): </span><span class="si">{</span><span class="n">count_per_time_frame_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records per time frame </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="sa">f</span><span class="s2">&quot;(mean): </span><span class="si">{</span><span class="n">count_per_time_frame_mean</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="n">records_per_animal</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>            <span class="sa">f</span><span class="s2">&quot;Average records per animal per </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">records_per_animal</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>            <span class="sa">f</span><span class="s2">&quot;Count per </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="k">def</span> <span class="nf">_add_trajctories_duration</span><span class="p">(</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        Adds trajectory duration statistics to the PDF.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        Parameters</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        ----------</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">        resolution : str</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">            Time resolution for trajectory duration (e.g., &#39;1H&#39;).</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="n">trajectories_duration_1H</span> <span class="o">=</span> <span class="n">user_trajectories_duration</span><span class="p">(</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">count_empty</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="sa">f</span><span class="s2">&quot;Trajectories duration (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> median): &quot;</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trajectories_duration_1H</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">trajectories_duration_1H</span><span class="p">,</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>            <span class="sa">f</span><span class="s2">&quot;Trajectories duration (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">) distribution.png&quot;</span><span class="p">,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="k">def</span> <span class="nf">_add_no_of_consecutive_records</span><span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        Adds statistics on consecutive records to the PDF.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">        Parameters</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        ----------</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        resolution : str</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">            Time resolution for consecutive records analysis (e.g., &#39;1H&#39;).</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="n">consecutive_1h</span> <span class="o">=</span> <span class="n">consecutive_record</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="n">consecutive_1h_median</span> <span class="o">=</span> <span class="n">consecutive_1h</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="sa">f</span><span class="s2">&quot;Median of consecutive records (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">):&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">consecutive_1h_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">consecutive_1h</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="sa">f</span><span class="s2">&quot;Distribution of consecutive records (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">).png&quot;</span><span class="p">,</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>    <span class="k">def</span> <span class="nf">_add_average_temporal_resolution</span><span class="p">(</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        Adds average temporal resolution statistics to the PDF.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        Parameters</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        ----------</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">            Input data for analysis, which includes datetime information</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">            required to calculate temporal resolution.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">            Analysis identifier used in plot filenames.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="n">temporal_df_median</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="n">temp_res_animal</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="n">in_minutes</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="p">[</span><span class="o">~</span><span class="n">temporal_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="n">in_minutes_filtred</span> <span class="o">=</span> <span class="n">in_minutes</span><span class="p">[</span><span class="n">in_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median temporal resolution: &quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_df_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                           <span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max temporal resolution: &quot;</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">in_minutes_filtred</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                           <span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">in_minutes_filtred</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="sa">f</span><span class="s2">&quot;The distribution of average temporal resolution.png&quot;</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="k">class</span> <span class="nc">DataFilter</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">    A class responsible for filtering, processing, and sorting</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">    animal trajectory data.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">    Attributes:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        pdf_object (FPDF): PDF object used for documenting</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">            the data processing steps.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        allowed_minutes (list): List of allowed temporal</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">            resolutions in minutes.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">        day_window (int): Time window in days for selecting</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">            the best periods of data.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        Initializes the DataFilter object with a PDF for logging</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        and default settings.</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        Args:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="sd">            pdf_object (FPDF): The PDF object for adding logging</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">                information.</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">        Attributes:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">            allowed_minutes (list): A list of allowed temporal</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">                resolutions (in minutes).</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">            day_window (int): The number of days considered for</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">                the time window.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_minutes</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ALLOWED_MINUTES</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day_window</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">DAYS_WINDOW</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">        Adds a single line of text to the PDF.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        Args:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">            txt_to_add (str): The text to be added to the PDF document.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="k">def</span> <span class="nf">_match_timedelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">        Matches a given timedelta to the closest allowed</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        temporal resolution.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        Args:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">            timedelta (pd.Timedelta): The timedelta to match.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        Returns:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">            tuple: A tuple containing the string representation</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">                of the closest temporal resolution (e.g., &#39;10min&#39;)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">                and its integer value in minutes.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="n">closest_minute</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">allowed_minutes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>            <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closest_minute</span><span class="si">}</span><span class="s2">min&quot;</span><span class="p">,</span> <span class="n">closest_minute</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error matching timedelta: &quot;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timedelta</span><span class="si">}</span><span class="s2">. Details: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                        <span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="k">def</span> <span class="nf">_select_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closest_minute</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        Calculates the number of records required for a rolling window</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        based on the closest temporal resolution.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        Args:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">            closest_minute (int): The closest temporal resolution in minutes.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        Returns:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            int: The number of records required for a rolling window.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="n">per_hour</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">closest_minute</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">per_day</span> <span class="o">=</span> <span class="n">per_hour</span> <span class="o">*</span> <span class="mi">24</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span> <span class="o">*</span> <span class="n">per_day</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="sa">f</span><span class="s2">&quot;Error calculating time window for resolution &quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closest_minute</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="k">def</span> <span class="nf">_extract_best_coverage</span><span class="p">(</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">data_coverage</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        Extracts data with the best coverage based on a rolling window.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        Args:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">            data (pd.DataFrame): The input data containing user trajectories.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">            data_coverage (pd.Series): The data coverage calculated over</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">                a rolling window.</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">        Returns:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">            pd.DataFrame: The extracted data with the best coverage.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="n">extracted</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>            <span class="k">for</span> <span class="n">an_id</span><span class="p">,</span> <span class="n">an_val</span> <span class="ow">in</span> <span class="n">data_coverage</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="k">if</span> <span class="n">an_val</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                    <span class="k">continue</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                <span class="n">max_date</span> <span class="o">=</span> <span class="n">an_val</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                <span class="n">till_EOD</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                        <span class="n">max_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                    <span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                    <span class="o">-</span> <span class="n">max_date</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                <span class="p">)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                <span class="n">max_date</span> <span class="o">+=</span> <span class="n">till_EOD</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                <span class="n">an_val</span> <span class="o">=</span> <span class="n">an_val</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                <span class="n">min_date</span> <span class="o">=</span> <span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                <span class="n">cur_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">an_id</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                <span class="n">selected</span> <span class="o">=</span> <span class="n">cur_df</span><span class="p">[</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                    <span class="p">(</span><span class="n">cur_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_date</span><span class="p">)</span> <span class="o">&amp;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                    <span class="p">(</span><span class="n">cur_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_date</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="n">selected</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">an_id</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">])</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="n">extracted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting best coverage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>    <span class="k">def</span> <span class="nf">_convert_to_unix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Converts a datetime column to UNIX timestamps.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        Args:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">            group (pd.DataFrame): The input DataFrame with a &#39;time&#39; column.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">        Returns:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">            pd.DataFrame: The DataFrame with the &#39;time&#39; column</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">                converted to UNIX timestamps.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>            <span class="n">group</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="k">return</span> <span class="n">group</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting datetime &quot;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                             <span class="sa">f</span><span class="s2">&quot;to UNIX timestamps: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                        <span class="p">)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>    <span class="k">def</span> <span class="nf">select_best_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">        Selects the best periods of data to maximize coverage.</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        Args:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">            data (TrajectoriesFrame): The input data containing user trajectories.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Returns:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">                the selected data.</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        Raises:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">            ValueError: If there is an error during data selection.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>            <span class="n">temporal_df_median</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">avg_temp_res_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_timedelta</span><span class="p">(</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="n">timedelta</span><span class="o">=</span> <span class="n">temporal_df_median</span> <span class="c1"># type: ignore</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="n">resampled</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                <span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="n">check_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_time_window</span><span class="p">(</span><span class="n">avg_temp_res_int</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>            <span class="n">resampled</span><span class="p">[</span><span class="n">resampled</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="n">data_coverage</span> <span class="o">=</span> <span class="n">resampled</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">check_time</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">check_time</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>            <span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="n">extracted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_best_coverage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_coverage</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Selecting best periods - &quot;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                               <span class="s2">&quot;maximizing data coverage&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                            <span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg temporal resolution: &quot;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_df_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                            <span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (str): </span><span class="si">{</span><span class="n">avg_temp_res_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (int): </span><span class="si">{</span><span class="n">avg_temp_res_int</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="sa">f</span><span class="s2">&quot;Selected time window for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="sa">f</span><span class="s2">&quot;days (timecheck): </span><span class="si">{</span><span class="n">check_time</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting best period: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        Filters the data based on various user statistics.</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        Args:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">            data (pd.DataFrame): The input data containing user trajectories.</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        Returns:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">                the filtered data.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        Raises:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">            ValueError: If there is an error during filtering.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="n">temp_res_animal_ex</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>            <span class="c1"># Fraction of missing records &lt; 0.6</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="n">frac_filter</span> <span class="o">=</span> <span class="n">fraction_of_empty_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_FRACTION_OF_MISSING_VALUES</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="n">level1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">frac_filter</span><span class="p">[</span><span class="n">frac_filter</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">FRACTION_OF_MISSING_VALUES</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="c1"># More than 20 days of data</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="n">traj_dur_filter</span> <span class="o">=</span> <span class="n">user_trajectories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_USER_TRAJECTORIES_DURATION</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="n">level2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">traj_dur_filter</span><span class="p">[</span><span class="n">traj_dur_filter</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">USER_TRAJECTORIES_DURATION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="n">level3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                <span class="n">temp_res_animal_ex</span><span class="p">[</span><span class="n">temp_res_animal_ex</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TEMPORAL_RESOLUTION_EXTRACTION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="c1"># User filtration with ULOC method</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="n">selection_lvl2</span> <span class="o">=</span> <span class="n">level1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="n">selection_lvl3</span> <span class="o">=</span> <span class="n">selection_lvl2</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">uloc</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">selection_lvl3</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Filtration with user statistics&quot;</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 1: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 2: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 3: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error filtering data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>    <span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        Sorts and prepares trajectory data for infostop processing.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        Args:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">            data (TrajectoriesFrame): The input trajectory data.</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        Returns:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">            pd.DataFrame: A sorted and prepared DataFrame with columns</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">                [&#39;user_id&#39;, &#39;time&#39;, &#39;latitude&#39;, &#39;longitude&#39;].</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        Raises:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">            ValueError: If there is an error during sorting or preparation.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dest_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">ELLIPSOIDAL_CRS</span><span class="p">,</span> <span class="n">cur_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">CARTESIAN_CRS</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">df1</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">]</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="p">]</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="n">data_prepared</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="s2">&quot;longitude&quot;</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="p">]</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_unix</span><span class="p">(</span><span class="n">data_prepared</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="k">return</span> <span class="n">data_prepared</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error sorting data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="k">class</span> <span class="nc">LabelsCalc</span><span class="p">:</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">    A class for processing and labeling movement data using</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">    the Infostop algorithm. Includes functionality for parameter optimization,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">    trajectory segmentation, and result visualization.</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">    Attributes</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">    ----------</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">    pdf_object : FPDF</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        A PDF object for documenting results and calculations.</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">    output_path : str</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">        The directory where plots and other outputs will be saved.</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        Initialize the LabelsCalc instance.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        Parameters</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        ----------</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">            PDF object for logging and documentation.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        output_path : str</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">            Path to save generated plots and outputs.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        Add a single line of text to the PDF.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        Parameters</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        ----------</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        txt_to_add : str</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">            Text to be added to the PDF document.</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_plot</span><span class="p">(</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="n">plot_obj</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">,</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="n">x_position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        Add a plot to the PDF.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        Parameters</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        ----------</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        plot_obj : BytesIO</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">            A BytesIO object containing the plot image.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        image_width : int</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">            Width of the plot in the PDF.</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        image_height : int</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">            Height of the plot in the PDF.</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        x_position : int, optional</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">            X-coordinate position of the plot, by default 10.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="n">y_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">image</span><span class="p">(</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                <span class="n">plot_obj</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">x_position</span><span class="p">,</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">y_position</span><span class="p">,</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="n">w</span><span class="o">=</span><span class="n">image_width</span><span class="p">,</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="n">h</span><span class="o">=</span><span class="n">image_height</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">y_position</span> <span class="o">+</span> <span class="n">image_height</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="n">plot_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add plot to PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="k">def</span> <span class="nf">_compute_intervals</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">max_time_between</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">        Compute stop and move intervals based on labels and timestamps.</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">        Parameters</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        ----------</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        labels : np.ndarray</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">            Array of labels assigned to data points (e.g., stops or moves).</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        times : np.ndarray</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">            Array of timestamps corresponding to the labels.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        max_time_between : int, optional</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">            Maximum allowable time (in seconds) between consecutive points,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">            by default 86400.</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">        Returns</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        -------</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">        list : A list of intervals with columns: label, start_time, end_time,</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">            latitude, longitude.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">times</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>  <span class="c1"># type: ignore</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="n">final_trajectory</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_start</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">loc</span> <span class="o">==</span> <span class="n">loc_prev</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_time_between</span><span class="p">:</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="n">final_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">])</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">loc_prev</span> <span class="o">=</span> <span class="n">loc</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="k">if</span> <span class="n">loc_prev</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="n">final_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">])</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">return</span> <span class="n">final_trajectory</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="k">def</span> <span class="nf">_process_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        Process a single combination of parameters and compute trajectories.</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        Parameters</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        ----------</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">        args : Tuple</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">            A tuple containing user_id, group, r1, r2, and min_staying_time.</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        Returns</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        -------</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        dict : Results containing user ID, trajectories, and parameter values.</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="n">min_staying_time</span><span class="o">=</span><span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_intervals</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                <span class="n">trajectory</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="p">)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="n">pts</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="n">lbls</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lbls</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lbls</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="n">silhouette</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                <span class="n">calinski</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="n">davies_bouldin</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="n">silhouette</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                <span class="n">calinski</span> <span class="o">=</span> <span class="n">calinski_harabasz_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="n">davies_bouldin</span> <span class="o">=</span> <span class="n">davies_bouldin_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="n">total_stops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                <span class="s2">&quot;Trajectory&quot;</span><span class="p">:</span> <span class="n">trajectory</span><span class="p">,</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="s2">&quot;Total_stops&quot;</span><span class="p">:</span> <span class="n">total_stops</span><span class="p">,</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                <span class="s2">&quot;R1&quot;</span><span class="p">:</span> <span class="n">r1</span><span class="p">,</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span> <span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="s1">&#39;SHTT&#39;</span><span class="p">:</span><span class="n">silhouette</span><span class="p">,</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="s1">&#39;CH&#39;</span><span class="p">:</span> <span class="n">calinski</span><span class="p">,</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="s1">&#39;DB&#39;</span><span class="p">:</span><span class="n">davies_bouldin</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="p">}</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing user </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="k">def</span> <span class="nf">_calc_params_matrix_parallel</span><span class="p">(</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">        Calculate the parameter sensitivity matrix using parallel processing.</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">        Parameters</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">        ----------</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">            Input trajectory data grouped by user ID.</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">        Returns</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">        -------</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">            A DataFrame with sensitivity analysis results.</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">rs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">rs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="n">min_staying_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7200</span><span class="p">),</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                <span class="n">num</span><span class="o">=</span><span class="mi">20</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>            <span class="p">)</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                <span class="k">for</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                    <span class="n">rs1</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                    <span class="n">rs2</span><span class="p">,</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                    <span class="n">min_staying_times</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                <span class="p">):</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">user_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span><span class="p">))</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                    <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                        <span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_process_combination</span><span class="p">,</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                            <span class="n">tasks</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                        <span class="p">),</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                    <span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                <span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating parameter matrix in &quot;</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                               <span class="sa">f</span><span class="s2">&quot;parallel: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>    <span class="k">def</span> <span class="nf">_calc_params_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">        Calculate the parameter sensitivity matrix.</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        Parameters</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        ----------</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">            Input trajectory data grouped by user ID.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        Returns</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        -------</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">            A DataFrame with sensitivity analysis results.</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="n">rs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="n">rs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="n">min_staying_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7200</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="n">dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">rs1</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                <span class="k">for</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">rs2</span><span class="p">:</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                    <span class="k">for</span> <span class="n">min_staying_time</span> <span class="ow">in</span> <span class="n">min_staying_times</span><span class="p">:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                        <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                            <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                            <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                            <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                            <span class="n">min_staying_time</span><span class="o">=</span><span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                            <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                            <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                        <span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_intervals</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                                <span class="n">trajectory</span><span class="p">,</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                                    <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                                <span class="p">],</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                            <span class="p">)</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                            <span class="n">total_stops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                                <span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                                <span class="s2">&quot;Trajectory&quot;</span><span class="p">:</span> <span class="n">trajectory</span><span class="p">,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                                <span class="s2">&quot;Total_stops&quot;</span><span class="p">:</span> <span class="n">total_stops</span><span class="p">,</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>                                <span class="s2">&quot;R1&quot;</span><span class="p">:</span> <span class="n">r1</span><span class="p">,</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>                                <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                                <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span> <span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                            <span class="p">}</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                            <span class="n">dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">)</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="k">def</span> <span class="nf">_plot_param</span><span class="p">(</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="n">stabilization_point_index</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">dy_dx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">        Create and return a plot visualizing parameter sensitivity.</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        Parameters</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">        ----------</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        param : str</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">            The parameter being analyzed.</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">        stabilization_point_index : float</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">            The selected stabilization point for the parameter.</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        x : np.ndarray</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">            X-axis values (parameter values).</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">        y : np.ndarray</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">            Y-axis values (total stops).</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        dy_dx : np.ndarray</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">            Change in total stops with respect to the parameter.</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">        Returns</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        -------</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">        BytesIO</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">            A BytesIO object containing the plot image.</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="n">stabilization_point_index</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Stable </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="p">)</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Total Stops&quot;</span><span class="p">)</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">dy_dx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="p">)</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median Total Stops by </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                <span class="sa">f</span><span class="s2">&quot;Median Total Stops by </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="k">def</span> <span class="nf">_choose_param_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">        Choose the optimal value for a given parameter based on</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        The method identifies a stabilization point for the parameter,</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">        where the total stops stabilize with minimal changes in the</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        corresponding value.</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">        Parameters</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">        ----------</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">            The data containing the results of parameter sensitivity.</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        param : str</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">            The parameter to optimize. Should be one of [&quot;R1&quot;, &quot;Tmin&quot;].</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">        Returns</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        -------</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        float</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">            The selected optimal parameter value based on</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">            the stabilization point.</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;R1&quot;</span><span class="p">:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">R1_MIN</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">R1_MAX</span><span class="p">)]</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Tmin&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TMIN_MIN</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Tmin&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TMIN_MAX</span><span class="p">)]</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="n">result_med</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="n">result_med_agg</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">result_med_agg</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">result_med_agg</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="n">dy_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="n">dy_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">dy_dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="n">dxdy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            <span class="p">{</span><span class="s2">&quot;de_value&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy_dx</span><span class="p">)}</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;de_value&quot;</span><span class="p">)</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="n">stabilization_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">dxdy</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">const</span><span class="o">.</span><span class="n">BEST_POINT_NO</span><span class="p">]]</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="n">filtred</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stabilization_x</span><span class="p">)]</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>        <span class="n">suma_total_stops</span> <span class="o">=</span> <span class="n">filtred</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">param</span><span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>        <span class="n">stabilization_point_index</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">suma_total_stops</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_param</span><span class="p">(</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="n">param</span><span class="p">,</span> <span class="n">stabilization_point_index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy_dx</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="p">)</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> value: </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="k">return</span> <span class="n">stabilization_point_index</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>    <span class="k">def</span> <span class="nf">_choose_param_value_with_clustering_params</span><span class="p">(</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        Choose the optimal value for a given parameter based on</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        The method identifies a stabilization point for the parameter,</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">        where the total stops stabilize with minimal changes in the</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">        corresponding value.</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        Parameters</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        ----------</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">            The data containing the results of parameter sensitivity.</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        param : str</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">            The parameter to optimize. Should be one of [&quot;R1&quot;, &quot;Tmin&quot;].</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">        Returns</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        -------</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        float</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">            The selected optimal parameter value based on</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">            the stabilization point.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">result_med</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="n">param_value</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">med_totalstops</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="n">med_sh</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="p">)[</span><span class="s2">&quot;SHTT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="n">med_ch</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="p">)[</span><span class="s2">&quot;CH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="n">med_db</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="p">)[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">med_sh</span><span class="p">)</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="c1"># f&quot;{param}&quot;: param_value,</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="s2">&quot;totalstops&quot;</span><span class="p">:</span> <span class="n">med_totalstops</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="s2">&quot;sh&quot;</span><span class="p">:</span> <span class="n">med_sh</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="s2">&quot;ch&quot;</span><span class="p">:</span> <span class="n">med_ch</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">med_db</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>        <span class="p">})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">_scores_values.csv&#39;</span><span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>        <span class="n">stabilization_point_index</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_param_with_clustering_measures</span><span class="p">(</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">param</span><span class="p">,</span> <span class="n">med_totalstops</span><span class="p">,</span> <span class="n">med_sh</span><span class="p">,</span> <span class="n">med_ch</span><span class="p">,</span><span class="n">med_db</span>   <span class="c1"># type: ignore</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="p">)</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> value: </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="k">return</span> <span class="n">stabilization_point_index</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>    <span class="k">def</span> <span class="nf">_plot_param_with_clustering_measures</span><span class="p">(</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="n">total_stops</span><span class="p">,</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="n">shtt</span><span class="p">,</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>        <span class="n">ch</span><span class="p">,</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>        <span class="n">db</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="c1"># Dodanie serii jako wykresw liniowych</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_stops</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total stops&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shtt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Silhouette&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calinski-Harabasz&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Davies Bouldin&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="c1"># Dodanie tytuu, etykiet osi i legendy</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Medians of scors for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Values&quot;</span><span class="p">)</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1"># Wywietlenie legendy</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>                <span class="sa">f</span><span class="s2">&quot;Medians of scors for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="k">def</span> <span class="nf">_choose_best_params</span><span class="p">(</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">sensitivity_matrix</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">        Choose the best parameter values for R1, R2, and Tmin based on</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">        The method sequentially selects the best values for R1, R2,</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">        and Tmin based on their stabilization point and the effect</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">        on the total stops.</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">        Parameters</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">        ----------</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">        sensitivity_matrix : pd.DataFrame</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">            The sensitivity matrix with parameters (R1, R2, Tmin)</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">            and their respective total stops.</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">        Returns</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">        -------</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">        Tuple[float, float, float]</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">            A tuple containing the selected values for R1, R2, and Tmin.</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>            <span class="n">r1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;R1&quot;</span><span class="p">)</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>            <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>  <span class="c1"># Start a new page for the next section of raport</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>            <span class="n">Tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;Tmin&quot;</span><span class="p">)</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>            <span class="k">return</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting best parameters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>    <span class="k">def</span> <span class="nf">_calc_labels</span><span class="p">(</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">r1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">        Calculates stop location labels for trajectory data using</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">        the Infostop model.</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">        Args:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">            data (iterable): Iterable containing user_id and associated</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">                trajectory data.</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">            r1 (float): Primary clustering radius for Infostop.</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a><span class="sd">            r2 (float): Secondary clustering radius for merging clusters.</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="sd">            Tmin (int): Minimum duration (in seconds) for a stop to</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a><span class="sd">                be considered valid.</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="sd">        Returns:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">            pd.DataFrame: DataFrame containing labeled stop locations</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">                with the following columns:</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">                - &#39;animal_id&#39;: The ID of the tracked individual.</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">                - &#39;labels&#39;: Cluster labels assigned to stop locations.</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">                - &#39;lat&#39;: Latitude of each recorded point.</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">                - &#39;lon&#39;: Longitude of each recorded point.</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">                - &#39;time&#39;: Timestamp of each recorded point.</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">        Raises:</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">            ValueError: If the input data format is invalid.</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>                <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>                <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>                <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                <span class="n">min_staying_time</span><span class="o">=</span><span class="n">Tmin</span><span class="p">,</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>                <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>            <span class="p">)</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>                <span class="p">[</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>            <span class="p">)</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                <span class="n">trajectory</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>            <span class="p">)</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>            <span class="n">trajectory</span><span class="p">[</span><span class="s2">&quot;animal_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                    <span class="n">trajectory</span><span class="p">,</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>                <span class="p">)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="p">)</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>    <span class="k">def</span> <span class="nf">calculate_infostop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">        Perform Infostop calculation, including sensitivity analysis</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">        and trajectory labeling.</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        Parameters</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">        ----------</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">            Input data containing user trajectories.</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">        Returns</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">        -------</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">            Final labeled trajectories.</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Infostop calculations&quot;</span><span class="p">)</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>            <span class="n">sensitivity_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_params_matrix_parallel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>            <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_best_params</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">)</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>            <span class="n">final_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">)</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>                <span class="sa">f</span><span class="s2">&quot;Final number of animals: &quot;</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">final_data</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>            <span class="p">)</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>            <span class="k">return</span> <span class="n">final_data</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Infostop calculation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="k">class</span> <span class="nc">InfoStopData</span><span class="p">:</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">    A class responsible for analyzing animal data and generating reports in</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">    PDF and CSV formats.</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">    Attributes:</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">        clean_data (TrajectoriesFrame): Raw input data related to animals.</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">        animal_name (str): The name of the analyzed animal.</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">        output_dir (str): Path to the main output directory.</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        output_dir_animal (str): Path to the output directory for the</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">            specific animal.</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        pdf (FPDF): FPDF object used for generating PDF reports.</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">        Initializes the InfoStopData object, creates an output directory,</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">        and sets up a PDF report.</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a><span class="sd">        Args:</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">            data (TrajectoriesFrame): The input data for analysis.</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">            data_name (str): The name of the analyzed animal.</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a><span class="sd">            output_dir (str): Path to the main output directory.</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">        Raises:</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">            FileExistsError: If the output directory for the animal</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a><span class="sd">                already exists.</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span> <span class="o">=</span> <span class="n">data_name</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">FPDF</span><span class="p">()</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>                <span class="sa">f</span><span class="s2">&quot;The directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="si">}</span><span class="s2"> already exists. &quot;</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>                <span class="sa">f</span><span class="s2">&quot;Please remove it or specify a different name.&quot;</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>            <span class="p">)</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>    <span class="k">def</span> <span class="nf">calculate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">        Performs a complete analysis of the data, generates reports</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">        in PDF format, and saves the results to a CSV file.</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">        Process:</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">            1. Generates an initial report.</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">            2. Selects the best period of data.</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">            3. Filters the data.</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">            4. Sorts the data.</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a><span class="sd">            5. Processes the data using the infostop module.</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">            6. Exports results to CSV and PDF files.</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">        Raises:</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">            FileNotFoundError: If a required file is missing during</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">                the process.</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">            ValueError: If the data contains invalid values.</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">            Exception: For any unexpected errors that occur during</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="sd">                the process.</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="n">raport</span> <span class="o">=</span> <span class="n">DataAnalystInfostop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>        <span class="nb">filter</span> <span class="o">=</span> <span class="n">DataFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">)</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>        <span class="n">labels_calculator</span> <span class="o">=</span> <span class="n">LabelsCalc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>            <span class="c1"># Step 1: Generate the initial report</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>            <span class="c1"># Step 2: Select the best period of data</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>            <span class="n">extracted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">select_best_period</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">)</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>            <span class="c1"># Step 3: Filter the data</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>            <span class="n">filtred_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">filter_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">)</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filtred_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                <span class="c1"># Step 4: Sort the data</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>                <span class="c1"># Step 5: Process data with the infostop module</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>                <span class="n">trajectory_processed_data</span> <span class="o">=</span> <span class="n">labels_calculator</span><span class="o">.</span><span class="n">calculate_infostop</span><span class="p">(</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>                    <span class="n">sorted_data</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>                <span class="p">)</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>                <span class="c1"># Save results to CSV</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                    <span class="sa">f</span><span class="s2">&quot;Trajectory_processed_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                <span class="p">)</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                <span class="n">trajectory_processed_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No animals after filtration&#39;</span><span class="p">)</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>            <span class="c1"># Save report to PDF</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>            <span class="p">)</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="k">raise</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>            <span class="k">raise</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>            <span class="k">raise</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>            <span class="c1"># Ensure the PDF is saved even if an error occurs</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>            <span class="p">)</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="DataAnalystInfostop">
                            <input id="DataAnalystInfostop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DataAnalystInfostop</span>:

                <label class="view-source-button" for="DataAnalystInfostop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataAnalystInfostop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataAnalystInfostop-58"><a href="#DataAnalystInfostop-58"><span class="linenos"> 58</span></a><span class="k">class</span> <span class="nc">DataAnalystInfostop</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-59"><a href="#DataAnalystInfostop-59"><span class="linenos"> 59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-60"><a href="#DataAnalystInfostop-60"><span class="linenos"> 60</span></a><span class="sd">    A class responsible for generating data analysis reports in PDF format.</span>
</span><span id="DataAnalystInfostop-61"><a href="#DataAnalystInfostop-61"><span class="linenos"> 61</span></a>
</span><span id="DataAnalystInfostop-62"><a href="#DataAnalystInfostop-62"><span class="linenos"> 62</span></a><span class="sd">    Parameters</span>
</span><span id="DataAnalystInfostop-63"><a href="#DataAnalystInfostop-63"><span class="linenos"> 63</span></a><span class="sd">    ----------</span>
</span><span id="DataAnalystInfostop-64"><a href="#DataAnalystInfostop-64"><span class="linenos"> 64</span></a><span class="sd">    pdf_object : FPDF</span>
</span><span id="DataAnalystInfostop-65"><a href="#DataAnalystInfostop-65"><span class="linenos"> 65</span></a><span class="sd">        PDF instance to which the analysis results will be added.</span>
</span><span id="DataAnalystInfostop-66"><a href="#DataAnalystInfostop-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-67"><a href="#DataAnalystInfostop-67"><span class="linenos"> 67</span></a>
</span><span id="DataAnalystInfostop-68"><a href="#DataAnalystInfostop-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-69"><a href="#DataAnalystInfostop-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-70"><a href="#DataAnalystInfostop-70"><span class="linenos"> 70</span></a><span class="sd">        Initializes the DataAnalystInfostop with a given PDF instance.</span>
</span><span id="DataAnalystInfostop-71"><a href="#DataAnalystInfostop-71"><span class="linenos"> 71</span></a>
</span><span id="DataAnalystInfostop-72"><a href="#DataAnalystInfostop-72"><span class="linenos"> 72</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-73"><a href="#DataAnalystInfostop-73"><span class="linenos"> 73</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-74"><a href="#DataAnalystInfostop-74"><span class="linenos"> 74</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="DataAnalystInfostop-75"><a href="#DataAnalystInfostop-75"><span class="linenos"> 75</span></a><span class="sd">            PDF instance where analysis results will be written.</span>
</span><span id="DataAnalystInfostop-76"><a href="#DataAnalystInfostop-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-77"><a href="#DataAnalystInfostop-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="DataAnalystInfostop-78"><a href="#DataAnalystInfostop-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="DataAnalystInfostop-79"><a href="#DataAnalystInfostop-79"><span class="linenos"> 79</span></a>
</span><span id="DataAnalystInfostop-80"><a href="#DataAnalystInfostop-80"><span class="linenos"> 80</span></a>
</span><span id="DataAnalystInfostop-81"><a href="#DataAnalystInfostop-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">generate_raport</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-82"><a href="#DataAnalystInfostop-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-83"><a href="#DataAnalystInfostop-83"><span class="linenos"> 83</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-84"><a href="#DataAnalystInfostop-84"><span class="linenos"> 84</span></a>            <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DataAnalystInfostop-85"><a href="#DataAnalystInfostop-85"><span class="linenos"> 85</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-86"><a href="#DataAnalystInfostop-86"><span class="linenos"> 86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-87"><a href="#DataAnalystInfostop-87"><span class="linenos"> 87</span></a><span class="sd">        Generates a data analysis report, adding results and visualizations</span>
</span><span id="DataAnalystInfostop-88"><a href="#DataAnalystInfostop-88"><span class="linenos"> 88</span></a><span class="sd">        to the PDF.</span>
</span><span id="DataAnalystInfostop-89"><a href="#DataAnalystInfostop-89"><span class="linenos"> 89</span></a>
</span><span id="DataAnalystInfostop-90"><a href="#DataAnalystInfostop-90"><span class="linenos"> 90</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-91"><a href="#DataAnalystInfostop-91"><span class="linenos"> 91</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-92"><a href="#DataAnalystInfostop-92"><span class="linenos"> 92</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-93"><a href="#DataAnalystInfostop-93"><span class="linenos"> 93</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-94"><a href="#DataAnalystInfostop-94"><span class="linenos"> 94</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-95"><a href="#DataAnalystInfostop-95"><span class="linenos"> 95</span></a><span class="sd">            Analysis identifier used in titles and filenames.</span>
</span><span id="DataAnalystInfostop-96"><a href="#DataAnalystInfostop-96"><span class="linenos"> 96</span></a>
</span><span id="DataAnalystInfostop-97"><a href="#DataAnalystInfostop-97"><span class="linenos"> 97</span></a><span class="sd">        Notes</span>
</span><span id="DataAnalystInfostop-98"><a href="#DataAnalystInfostop-98"><span class="linenos"> 98</span></a><span class="sd">        -----</span>
</span><span id="DataAnalystInfostop-99"><a href="#DataAnalystInfostop-99"><span class="linenos"> 99</span></a><span class="sd">        Executes a data analysis pipeline, generating various statistical</span>
</span><span id="DataAnalystInfostop-100"><a href="#DataAnalystInfostop-100"><span class="linenos">100</span></a><span class="sd">        metrics and plots, which are sequentially added to the PDF document.</span>
</span><span id="DataAnalystInfostop-101"><a href="#DataAnalystInfostop-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-102"><a href="#DataAnalystInfostop-102"><span class="linenos">102</span></a>
</span><span id="DataAnalystInfostop-103"><a href="#DataAnalystInfostop-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_analyst_title</span><span class="p">(</span><span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-104"><a href="#DataAnalystInfostop-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_basic_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-105"><a href="#DataAnalystInfostop-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_total_records_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-106"><a href="#DataAnalystInfostop-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-107"><a href="#DataAnalystInfostop-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-108"><a href="#DataAnalystInfostop-108"><span class="linenos">108</span></a>
</span><span id="DataAnalystInfostop-109"><a href="#DataAnalystInfostop-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-110"><a href="#DataAnalystInfostop-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_trajctories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-111"><a href="#DataAnalystInfostop-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-112"><a href="#DataAnalystInfostop-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-113"><a href="#DataAnalystInfostop-113"><span class="linenos">113</span></a>
</span><span id="DataAnalystInfostop-114"><a href="#DataAnalystInfostop-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-115"><a href="#DataAnalystInfostop-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_average_temporal_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-116"><a href="#DataAnalystInfostop-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-117"><a href="#DataAnalystInfostop-117"><span class="linenos">117</span></a>
</span><span id="DataAnalystInfostop-118"><a href="#DataAnalystInfostop-118"><span class="linenos">118</span></a>
</span><span id="DataAnalystInfostop-119"><a href="#DataAnalystInfostop-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-120"><a href="#DataAnalystInfostop-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-121"><a href="#DataAnalystInfostop-121"><span class="linenos">121</span></a><span class="sd">        Adds a single line of text to the PDF.</span>
</span><span id="DataAnalystInfostop-122"><a href="#DataAnalystInfostop-122"><span class="linenos">122</span></a>
</span><span id="DataAnalystInfostop-123"><a href="#DataAnalystInfostop-123"><span class="linenos">123</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-124"><a href="#DataAnalystInfostop-124"><span class="linenos">124</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-125"><a href="#DataAnalystInfostop-125"><span class="linenos">125</span></a><span class="sd">        txt_to_add : str</span>
</span><span id="DataAnalystInfostop-126"><a href="#DataAnalystInfostop-126"><span class="linenos">126</span></a><span class="sd">            Text to be added to the PDF document.</span>
</span><span id="DataAnalystInfostop-127"><a href="#DataAnalystInfostop-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-128"><a href="#DataAnalystInfostop-128"><span class="linenos">128</span></a>
</span><span id="DataAnalystInfostop-129"><a href="#DataAnalystInfostop-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-130"><a href="#DataAnalystInfostop-130"><span class="linenos">130</span></a>
</span><span id="DataAnalystInfostop-131"><a href="#DataAnalystInfostop-131"><span class="linenos">131</span></a>
</span><span id="DataAnalystInfostop-132"><a href="#DataAnalystInfostop-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_plot</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-133"><a href="#DataAnalystInfostop-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-134"><a href="#DataAnalystInfostop-134"><span class="linenos">134</span></a>        <span class="n">plot_obj</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-135"><a href="#DataAnalystInfostop-135"><span class="linenos">135</span></a>        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-136"><a href="#DataAnalystInfostop-136"><span class="linenos">136</span></a>        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-137"><a href="#DataAnalystInfostop-137"><span class="linenos">137</span></a>        <span class="n">x_position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-138"><a href="#DataAnalystInfostop-138"><span class="linenos">138</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-139"><a href="#DataAnalystInfostop-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-140"><a href="#DataAnalystInfostop-140"><span class="linenos">140</span></a><span class="sd">        Adds a plot to the PDF at the current cursor position.</span>
</span><span id="DataAnalystInfostop-141"><a href="#DataAnalystInfostop-141"><span class="linenos">141</span></a>
</span><span id="DataAnalystInfostop-142"><a href="#DataAnalystInfostop-142"><span class="linenos">142</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-143"><a href="#DataAnalystInfostop-143"><span class="linenos">143</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-144"><a href="#DataAnalystInfostop-144"><span class="linenos">144</span></a><span class="sd">        plot_obj : BytesIO</span>
</span><span id="DataAnalystInfostop-145"><a href="#DataAnalystInfostop-145"><span class="linenos">145</span></a><span class="sd">            Plot image to add to the PDF.</span>
</span><span id="DataAnalystInfostop-146"><a href="#DataAnalystInfostop-146"><span class="linenos">146</span></a><span class="sd">        image_width : int</span>
</span><span id="DataAnalystInfostop-147"><a href="#DataAnalystInfostop-147"><span class="linenos">147</span></a><span class="sd">            Width of the plot in the PDF.</span>
</span><span id="DataAnalystInfostop-148"><a href="#DataAnalystInfostop-148"><span class="linenos">148</span></a><span class="sd">        image_height : int</span>
</span><span id="DataAnalystInfostop-149"><a href="#DataAnalystInfostop-149"><span class="linenos">149</span></a><span class="sd">            Height of the plot in the PDF.</span>
</span><span id="DataAnalystInfostop-150"><a href="#DataAnalystInfostop-150"><span class="linenos">150</span></a><span class="sd">        x_position : int, optional</span>
</span><span id="DataAnalystInfostop-151"><a href="#DataAnalystInfostop-151"><span class="linenos">151</span></a><span class="sd">            X-coordinate position of the plot, by default 10.</span>
</span><span id="DataAnalystInfostop-152"><a href="#DataAnalystInfostop-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-153"><a href="#DataAnalystInfostop-153"><span class="linenos">153</span></a>
</span><span id="DataAnalystInfostop-154"><a href="#DataAnalystInfostop-154"><span class="linenos">154</span></a>        <span class="n">y_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-155"><a href="#DataAnalystInfostop-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">image</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-156"><a href="#DataAnalystInfostop-156"><span class="linenos">156</span></a>            <span class="n">plot_obj</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-157"><a href="#DataAnalystInfostop-157"><span class="linenos">157</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">x_position</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-158"><a href="#DataAnalystInfostop-158"><span class="linenos">158</span></a>            <span class="n">y</span><span class="o">=</span><span class="n">y_position</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-159"><a href="#DataAnalystInfostop-159"><span class="linenos">159</span></a>            <span class="n">w</span><span class="o">=</span><span class="n">image_width</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-160"><a href="#DataAnalystInfostop-160"><span class="linenos">160</span></a>            <span class="n">h</span><span class="o">=</span><span class="n">image_height</span>
</span><span id="DataAnalystInfostop-161"><a href="#DataAnalystInfostop-161"><span class="linenos">161</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-162"><a href="#DataAnalystInfostop-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">y_position</span> <span class="o">+</span> <span class="n">image_height</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-163"><a href="#DataAnalystInfostop-163"><span class="linenos">163</span></a>        <span class="n">plot_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-164"><a href="#DataAnalystInfostop-164"><span class="linenos">164</span></a>
</span><span id="DataAnalystInfostop-165"><a href="#DataAnalystInfostop-165"><span class="linenos">165</span></a>
</span><span id="DataAnalystInfostop-166"><a href="#DataAnalystInfostop-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">_plot_fraction_of_empty_records</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-167"><a href="#DataAnalystInfostop-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DataAnalystInfostop-168"><a href="#DataAnalystInfostop-168"><span class="linenos">168</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-169"><a href="#DataAnalystInfostop-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-170"><a href="#DataAnalystInfostop-170"><span class="linenos">170</span></a><span class="sd">        Generates a plot showing the fraction of empty records by threshold.</span>
</span><span id="DataAnalystInfostop-171"><a href="#DataAnalystInfostop-171"><span class="linenos">171</span></a>
</span><span id="DataAnalystInfostop-172"><a href="#DataAnalystInfostop-172"><span class="linenos">172</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-173"><a href="#DataAnalystInfostop-173"><span class="linenos">173</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-174"><a href="#DataAnalystInfostop-174"><span class="linenos">174</span></a><span class="sd">        frac : Series</span>
</span><span id="DataAnalystInfostop-175"><a href="#DataAnalystInfostop-175"><span class="linenos">175</span></a><span class="sd">            Series containing fraction of empty records.</span>
</span><span id="DataAnalystInfostop-176"><a href="#DataAnalystInfostop-176"><span class="linenos">176</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-177"><a href="#DataAnalystInfostop-177"><span class="linenos">177</span></a><span class="sd">            Analysis identifier for the plot filename.</span>
</span><span id="DataAnalystInfostop-178"><a href="#DataAnalystInfostop-178"><span class="linenos">178</span></a>
</span><span id="DataAnalystInfostop-179"><a href="#DataAnalystInfostop-179"><span class="linenos">179</span></a><span class="sd">        Returns</span>
</span><span id="DataAnalystInfostop-180"><a href="#DataAnalystInfostop-180"><span class="linenos">180</span></a><span class="sd">        -------</span>
</span><span id="DataAnalystInfostop-181"><a href="#DataAnalystInfostop-181"><span class="linenos">181</span></a><span class="sd">        BytesIO</span>
</span><span id="DataAnalystInfostop-182"><a href="#DataAnalystInfostop-182"><span class="linenos">182</span></a><span class="sd">            In-memory image buffer of the generated plot.</span>
</span><span id="DataAnalystInfostop-183"><a href="#DataAnalystInfostop-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-184"><a href="#DataAnalystInfostop-184"><span class="linenos">184</span></a>
</span><span id="DataAnalystInfostop-185"><a href="#DataAnalystInfostop-185"><span class="linenos">185</span></a>        <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)]</span>
</span><span id="DataAnalystInfostop-186"><a href="#DataAnalystInfostop-186"><span class="linenos">186</span></a>        <span class="n">num_of_complete</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DataAnalystInfostop-187"><a href="#DataAnalystInfostop-187"><span class="linenos">187</span></a>            <span class="n">threshold</span><span class="p">:</span> <span class="p">(</span><span class="n">frac</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span>
</span><span id="DataAnalystInfostop-188"><a href="#DataAnalystInfostop-188"><span class="linenos">188</span></a>        <span class="p">}</span>
</span><span id="DataAnalystInfostop-189"><a href="#DataAnalystInfostop-189"><span class="linenos">189</span></a>
</span><span id="DataAnalystInfostop-190"><a href="#DataAnalystInfostop-190"><span class="linenos">190</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-191"><a href="#DataAnalystInfostop-191"><span class="linenos">191</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="DataAnalystInfostop-192"><a href="#DataAnalystInfostop-192"><span class="linenos">192</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_of_complete</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">num_of_complete</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-193"><a href="#DataAnalystInfostop-193"><span class="linenos">193</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Counts_frac vs. Threshold&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-194"><a href="#DataAnalystInfostop-194"><span class="linenos">194</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Threshold&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-195"><a href="#DataAnalystInfostop-195"><span class="linenos">195</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Counts_frac&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-196"><a href="#DataAnalystInfostop-196"><span class="linenos">196</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-197"><a href="#DataAnalystInfostop-197"><span class="linenos">197</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-198"><a href="#DataAnalystInfostop-198"><span class="linenos">198</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-199"><a href="#DataAnalystInfostop-199"><span class="linenos">199</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-200"><a href="#DataAnalystInfostop-200"><span class="linenos">200</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-201"><a href="#DataAnalystInfostop-201"><span class="linenos">201</span></a>                <span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-202"><a href="#DataAnalystInfostop-202"><span class="linenos">202</span></a>                <span class="sa">f</span><span class="s2">&quot;Counts frac vs Threshold.png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-203"><a href="#DataAnalystInfostop-203"><span class="linenos">203</span></a>            <span class="p">)</span>
</span><span id="DataAnalystInfostop-204"><a href="#DataAnalystInfostop-204"><span class="linenos">204</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-205"><a href="#DataAnalystInfostop-205"><span class="linenos">205</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-206"><a href="#DataAnalystInfostop-206"><span class="linenos">206</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-207"><a href="#DataAnalystInfostop-207"><span class="linenos">207</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-208"><a href="#DataAnalystInfostop-208"><span class="linenos">208</span></a>
</span><span id="DataAnalystInfostop-209"><a href="#DataAnalystInfostop-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="DataAnalystInfostop-210"><a href="#DataAnalystInfostop-210"><span class="linenos">210</span></a>
</span><span id="DataAnalystInfostop-211"><a href="#DataAnalystInfostop-211"><span class="linenos">211</span></a>
</span><span id="DataAnalystInfostop-212"><a href="#DataAnalystInfostop-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-213"><a href="#DataAnalystInfostop-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="DataAnalystInfostop-214"><a href="#DataAnalystInfostop-214"><span class="linenos">214</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-215"><a href="#DataAnalystInfostop-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-216"><a href="#DataAnalystInfostop-216"><span class="linenos">216</span></a><span class="sd">        Generates a distribution plot of the given data.</span>
</span><span id="DataAnalystInfostop-217"><a href="#DataAnalystInfostop-217"><span class="linenos">217</span></a>
</span><span id="DataAnalystInfostop-218"><a href="#DataAnalystInfostop-218"><span class="linenos">218</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-219"><a href="#DataAnalystInfostop-219"><span class="linenos">219</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-220"><a href="#DataAnalystInfostop-220"><span class="linenos">220</span></a><span class="sd">        data : Series or array-like</span>
</span><span id="DataAnalystInfostop-221"><a href="#DataAnalystInfostop-221"><span class="linenos">221</span></a><span class="sd">            Data to plot.</span>
</span><span id="DataAnalystInfostop-222"><a href="#DataAnalystInfostop-222"><span class="linenos">222</span></a><span class="sd">        plot_name : str</span>
</span><span id="DataAnalystInfostop-223"><a href="#DataAnalystInfostop-223"><span class="linenos">223</span></a><span class="sd">            Filename for saving the plot.</span>
</span><span id="DataAnalystInfostop-224"><a href="#DataAnalystInfostop-224"><span class="linenos">224</span></a><span class="sd">        bins : int, optional</span>
</span><span id="DataAnalystInfostop-225"><a href="#DataAnalystInfostop-225"><span class="linenos">225</span></a><span class="sd">            Number of bins for the histogram, by default 10.</span>
</span><span id="DataAnalystInfostop-226"><a href="#DataAnalystInfostop-226"><span class="linenos">226</span></a>
</span><span id="DataAnalystInfostop-227"><a href="#DataAnalystInfostop-227"><span class="linenos">227</span></a><span class="sd">        Returns</span>
</span><span id="DataAnalystInfostop-228"><a href="#DataAnalystInfostop-228"><span class="linenos">228</span></a><span class="sd">        -------</span>
</span><span id="DataAnalystInfostop-229"><a href="#DataAnalystInfostop-229"><span class="linenos">229</span></a><span class="sd">        BytesIO</span>
</span><span id="DataAnalystInfostop-230"><a href="#DataAnalystInfostop-230"><span class="linenos">230</span></a><span class="sd">            In-memory image buffer of the generated distribution plot.</span>
</span><span id="DataAnalystInfostop-231"><a href="#DataAnalystInfostop-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-232"><a href="#DataAnalystInfostop-232"><span class="linenos">232</span></a>
</span><span id="DataAnalystInfostop-233"><a href="#DataAnalystInfostop-233"><span class="linenos">233</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-234"><a href="#DataAnalystInfostop-234"><span class="linenos">234</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataAnalystInfostop-235"><a href="#DataAnalystInfostop-235"><span class="linenos">235</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">))</span>
</span><span id="DataAnalystInfostop-236"><a href="#DataAnalystInfostop-236"><span class="linenos">236</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-237"><a href="#DataAnalystInfostop-237"><span class="linenos">237</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-238"><a href="#DataAnalystInfostop-238"><span class="linenos">238</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-239"><a href="#DataAnalystInfostop-239"><span class="linenos">239</span></a>
</span><span id="DataAnalystInfostop-240"><a href="#DataAnalystInfostop-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="DataAnalystInfostop-241"><a href="#DataAnalystInfostop-241"><span class="linenos">241</span></a>
</span><span id="DataAnalystInfostop-242"><a href="#DataAnalystInfostop-242"><span class="linenos">242</span></a>
</span><span id="DataAnalystInfostop-243"><a href="#DataAnalystInfostop-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">_add_analyst_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-244"><a href="#DataAnalystInfostop-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-245"><a href="#DataAnalystInfostop-245"><span class="linenos">245</span></a><span class="sd">        Adds the title of the analysis section to the PDF.</span>
</span><span id="DataAnalystInfostop-246"><a href="#DataAnalystInfostop-246"><span class="linenos">246</span></a>
</span><span id="DataAnalystInfostop-247"><a href="#DataAnalystInfostop-247"><span class="linenos">247</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-248"><a href="#DataAnalystInfostop-248"><span class="linenos">248</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-249"><a href="#DataAnalystInfostop-249"><span class="linenos">249</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-250"><a href="#DataAnalystInfostop-250"><span class="linenos">250</span></a><span class="sd">            Analysis identifier used in the title.</span>
</span><span id="DataAnalystInfostop-251"><a href="#DataAnalystInfostop-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-252"><a href="#DataAnalystInfostop-252"><span class="linenos">252</span></a>
</span><span id="DataAnalystInfostop-253"><a href="#DataAnalystInfostop-253"><span class="linenos">253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Analysis: </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-254"><a href="#DataAnalystInfostop-254"><span class="linenos">254</span></a>
</span><span id="DataAnalystInfostop-255"><a href="#DataAnalystInfostop-255"><span class="linenos">255</span></a>
</span><span id="DataAnalystInfostop-256"><a href="#DataAnalystInfostop-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">_add_basic_statistics</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-257"><a href="#DataAnalystInfostop-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DataAnalystInfostop-258"><a href="#DataAnalystInfostop-258"><span class="linenos">258</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-259"><a href="#DataAnalystInfostop-259"><span class="linenos">259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-260"><a href="#DataAnalystInfostop-260"><span class="linenos">260</span></a><span class="sd">        Adds basic statistics to the PDF, including the number of animals</span>
</span><span id="DataAnalystInfostop-261"><a href="#DataAnalystInfostop-261"><span class="linenos">261</span></a><span class="sd">        and fraction of empty records.</span>
</span><span id="DataAnalystInfostop-262"><a href="#DataAnalystInfostop-262"><span class="linenos">262</span></a>
</span><span id="DataAnalystInfostop-263"><a href="#DataAnalystInfostop-263"><span class="linenos">263</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-264"><a href="#DataAnalystInfostop-264"><span class="linenos">264</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-265"><a href="#DataAnalystInfostop-265"><span class="linenos">265</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-266"><a href="#DataAnalystInfostop-266"><span class="linenos">266</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-267"><a href="#DataAnalystInfostop-267"><span class="linenos">267</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-268"><a href="#DataAnalystInfostop-268"><span class="linenos">268</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="DataAnalystInfostop-269"><a href="#DataAnalystInfostop-269"><span class="linenos">269</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-270"><a href="#DataAnalystInfostop-270"><span class="linenos">270</span></a>
</span><span id="DataAnalystInfostop-271"><a href="#DataAnalystInfostop-271"><span class="linenos">271</span></a>        <span class="n">number_of_animals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span>
</span><span id="DataAnalystInfostop-272"><a href="#DataAnalystInfostop-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals: </span><span class="si">{</span><span class="n">number_of_animals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-273"><a href="#DataAnalystInfostop-273"><span class="linenos">273</span></a>
</span><span id="DataAnalystInfostop-274"><a href="#DataAnalystInfostop-274"><span class="linenos">274</span></a>        <span class="n">frac</span> <span class="o">=</span> <span class="n">fraction_of_empty_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-275"><a href="#DataAnalystInfostop-275"><span class="linenos">275</span></a>        <span class="n">frac_median</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-276"><a href="#DataAnalystInfostop-276"><span class="linenos">276</span></a>        <span class="n">frac_mean</span> <span class="o">=</span> <span class="n">frac</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-277"><a href="#DataAnalystInfostop-277"><span class="linenos">277</span></a>
</span><span id="DataAnalystInfostop-278"><a href="#DataAnalystInfostop-278"><span class="linenos">278</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_fraction_of_empty_records</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-279"><a href="#DataAnalystInfostop-279"><span class="linenos">279</span></a>            <span class="n">frac</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="n">data_analyst_no</span>
</span><span id="DataAnalystInfostop-280"><a href="#DataAnalystInfostop-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-281"><a href="#DataAnalystInfostop-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction of empty records (median): &quot;</span>
</span><span id="DataAnalystInfostop-282"><a href="#DataAnalystInfostop-282"><span class="linenos">282</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">frac_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-283"><a href="#DataAnalystInfostop-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fraction of empty records (mean): </span><span class="si">{</span><span class="n">frac_mean</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-284"><a href="#DataAnalystInfostop-284"><span class="linenos">284</span></a>
</span><span id="DataAnalystInfostop-285"><a href="#DataAnalystInfostop-285"><span class="linenos">285</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-286"><a href="#DataAnalystInfostop-286"><span class="linenos">286</span></a>
</span><span id="DataAnalystInfostop-287"><a href="#DataAnalystInfostop-287"><span class="linenos">287</span></a>
</span><span id="DataAnalystInfostop-288"><a href="#DataAnalystInfostop-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">_add_total_records_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-289"><a href="#DataAnalystInfostop-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-290"><a href="#DataAnalystInfostop-290"><span class="linenos">290</span></a><span class="sd">        Adds total record statistics to the PDF, including median</span>
</span><span id="DataAnalystInfostop-291"><a href="#DataAnalystInfostop-291"><span class="linenos">291</span></a><span class="sd">        and mean values.</span>
</span><span id="DataAnalystInfostop-292"><a href="#DataAnalystInfostop-292"><span class="linenos">292</span></a>
</span><span id="DataAnalystInfostop-293"><a href="#DataAnalystInfostop-293"><span class="linenos">293</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-294"><a href="#DataAnalystInfostop-294"><span class="linenos">294</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-295"><a href="#DataAnalystInfostop-295"><span class="linenos">295</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-296"><a href="#DataAnalystInfostop-296"><span class="linenos">296</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-297"><a href="#DataAnalystInfostop-297"><span class="linenos">297</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-298"><a href="#DataAnalystInfostop-298"><span class="linenos">298</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="DataAnalystInfostop-299"><a href="#DataAnalystInfostop-299"><span class="linenos">299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-300"><a href="#DataAnalystInfostop-300"><span class="linenos">300</span></a>
</span><span id="DataAnalystInfostop-301"><a href="#DataAnalystInfostop-301"><span class="linenos">301</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="n">count_records</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-302"><a href="#DataAnalystInfostop-302"><span class="linenos">302</span></a>        <span class="n">count_median</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-303"><a href="#DataAnalystInfostop-303"><span class="linenos">303</span></a>        <span class="n">count_mean</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-304"><a href="#DataAnalystInfostop-304"><span class="linenos">304</span></a>
</span><span id="DataAnalystInfostop-305"><a href="#DataAnalystInfostop-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of records (median): </span><span class="si">{</span><span class="n">count_median</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-306"><a href="#DataAnalystInfostop-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-307"><a href="#DataAnalystInfostop-307"><span class="linenos">307</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records (mean): </span><span class="si">{</span><span class="n">count_mean</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-308"><a href="#DataAnalystInfostop-308"><span class="linenos">308</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-309"><a href="#DataAnalystInfostop-309"><span class="linenos">309</span></a>
</span><span id="DataAnalystInfostop-310"><a href="#DataAnalystInfostop-310"><span class="linenos">310</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-311"><a href="#DataAnalystInfostop-311"><span class="linenos">311</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-312"><a href="#DataAnalystInfostop-312"><span class="linenos">312</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-313"><a href="#DataAnalystInfostop-313"><span class="linenos">313</span></a>            <span class="sa">f</span><span class="s2">&quot;Total numbers of records.png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-314"><a href="#DataAnalystInfostop-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-315"><a href="#DataAnalystInfostop-315"><span class="linenos">315</span></a>
</span><span id="DataAnalystInfostop-316"><a href="#DataAnalystInfostop-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-317"><a href="#DataAnalystInfostop-317"><span class="linenos">317</span></a>
</span><span id="DataAnalystInfostop-318"><a href="#DataAnalystInfostop-318"><span class="linenos">318</span></a>
</span><span id="DataAnalystInfostop-319"><a href="#DataAnalystInfostop-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">_add_records_per_time_frame</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-320"><a href="#DataAnalystInfostop-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="DataAnalystInfostop-321"><a href="#DataAnalystInfostop-321"><span class="linenos">321</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-322"><a href="#DataAnalystInfostop-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-323"><a href="#DataAnalystInfostop-323"><span class="linenos">323</span></a><span class="sd">        Adds statistics on records per specified time frame to the PDF.</span>
</span><span id="DataAnalystInfostop-324"><a href="#DataAnalystInfostop-324"><span class="linenos">324</span></a>
</span><span id="DataAnalystInfostop-325"><a href="#DataAnalystInfostop-325"><span class="linenos">325</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-326"><a href="#DataAnalystInfostop-326"><span class="linenos">326</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-327"><a href="#DataAnalystInfostop-327"><span class="linenos">327</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-328"><a href="#DataAnalystInfostop-328"><span class="linenos">328</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-329"><a href="#DataAnalystInfostop-329"><span class="linenos">329</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-330"><a href="#DataAnalystInfostop-330"><span class="linenos">330</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="DataAnalystInfostop-331"><a href="#DataAnalystInfostop-331"><span class="linenos">331</span></a><span class="sd">        resolution : str</span>
</span><span id="DataAnalystInfostop-332"><a href="#DataAnalystInfostop-332"><span class="linenos">332</span></a><span class="sd">            Time resolution for analysis (e.g., &#39;1D&#39;, &#39;1H&#39;).</span>
</span><span id="DataAnalystInfostop-333"><a href="#DataAnalystInfostop-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-334"><a href="#DataAnalystInfostop-334"><span class="linenos">334</span></a>
</span><span id="DataAnalystInfostop-335"><a href="#DataAnalystInfostop-335"><span class="linenos">335</span></a>        <span class="n">count_per_time_frame</span> <span class="o">=</span> <span class="n">count_records_per_time_frame</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-336"><a href="#DataAnalystInfostop-336"><span class="linenos">336</span></a>            <span class="n">data</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-337"><a href="#DataAnalystInfostop-337"><span class="linenos">337</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span>
</span><span id="DataAnalystInfostop-338"><a href="#DataAnalystInfostop-338"><span class="linenos">338</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-339"><a href="#DataAnalystInfostop-339"><span class="linenos">339</span></a>        <span class="n">count_per_time_frame_median</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-340"><a href="#DataAnalystInfostop-340"><span class="linenos">340</span></a>        <span class="n">count_per_time_frame_mean</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-341"><a href="#DataAnalystInfostop-341"><span class="linenos">341</span></a>
</span><span id="DataAnalystInfostop-342"><a href="#DataAnalystInfostop-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-343"><a href="#DataAnalystInfostop-343"><span class="linenos">343</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records per time frame </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="DataAnalystInfostop-344"><a href="#DataAnalystInfostop-344"><span class="linenos">344</span></a>            <span class="sa">f</span><span class="s2">&quot;(median): </span><span class="si">{</span><span class="n">count_per_time_frame_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-345"><a href="#DataAnalystInfostop-345"><span class="linenos">345</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-346"><a href="#DataAnalystInfostop-346"><span class="linenos">346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-347"><a href="#DataAnalystInfostop-347"><span class="linenos">347</span></a>            <span class="sa">f</span><span class="s2">&quot;Total number of records per time frame </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="DataAnalystInfostop-348"><a href="#DataAnalystInfostop-348"><span class="linenos">348</span></a>            <span class="sa">f</span><span class="s2">&quot;(mean): </span><span class="si">{</span><span class="n">count_per_time_frame_mean</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-349"><a href="#DataAnalystInfostop-349"><span class="linenos">349</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-350"><a href="#DataAnalystInfostop-350"><span class="linenos">350</span></a>
</span><span id="DataAnalystInfostop-351"><a href="#DataAnalystInfostop-351"><span class="linenos">351</span></a>        <span class="n">records_per_animal</span> <span class="o">=</span> <span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-352"><a href="#DataAnalystInfostop-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-353"><a href="#DataAnalystInfostop-353"><span class="linenos">353</span></a>            <span class="sa">f</span><span class="s2">&quot;Average records per animal per </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-354"><a href="#DataAnalystInfostop-354"><span class="linenos">354</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">records_per_animal</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-355"><a href="#DataAnalystInfostop-355"><span class="linenos">355</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-356"><a href="#DataAnalystInfostop-356"><span class="linenos">356</span></a>
</span><span id="DataAnalystInfostop-357"><a href="#DataAnalystInfostop-357"><span class="linenos">357</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-358"><a href="#DataAnalystInfostop-358"><span class="linenos">358</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">count_per_time_frame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span id="DataAnalystInfostop-359"><a href="#DataAnalystInfostop-359"><span class="linenos">359</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-360"><a href="#DataAnalystInfostop-360"><span class="linenos">360</span></a>            <span class="sa">f</span><span class="s2">&quot;Count per </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-361"><a href="#DataAnalystInfostop-361"><span class="linenos">361</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-362"><a href="#DataAnalystInfostop-362"><span class="linenos">362</span></a>
</span><span id="DataAnalystInfostop-363"><a href="#DataAnalystInfostop-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-364"><a href="#DataAnalystInfostop-364"><span class="linenos">364</span></a>
</span><span id="DataAnalystInfostop-365"><a href="#DataAnalystInfostop-365"><span class="linenos">365</span></a>
</span><span id="DataAnalystInfostop-366"><a href="#DataAnalystInfostop-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">_add_trajctories_duration</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-367"><a href="#DataAnalystInfostop-367"><span class="linenos">367</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="DataAnalystInfostop-368"><a href="#DataAnalystInfostop-368"><span class="linenos">368</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-369"><a href="#DataAnalystInfostop-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-370"><a href="#DataAnalystInfostop-370"><span class="linenos">370</span></a><span class="sd">        Adds trajectory duration statistics to the PDF.</span>
</span><span id="DataAnalystInfostop-371"><a href="#DataAnalystInfostop-371"><span class="linenos">371</span></a>
</span><span id="DataAnalystInfostop-372"><a href="#DataAnalystInfostop-372"><span class="linenos">372</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-373"><a href="#DataAnalystInfostop-373"><span class="linenos">373</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-374"><a href="#DataAnalystInfostop-374"><span class="linenos">374</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-375"><a href="#DataAnalystInfostop-375"><span class="linenos">375</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-376"><a href="#DataAnalystInfostop-376"><span class="linenos">376</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-377"><a href="#DataAnalystInfostop-377"><span class="linenos">377</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="DataAnalystInfostop-378"><a href="#DataAnalystInfostop-378"><span class="linenos">378</span></a><span class="sd">        resolution : str</span>
</span><span id="DataAnalystInfostop-379"><a href="#DataAnalystInfostop-379"><span class="linenos">379</span></a><span class="sd">            Time resolution for trajectory duration (e.g., &#39;1H&#39;).</span>
</span><span id="DataAnalystInfostop-380"><a href="#DataAnalystInfostop-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-381"><a href="#DataAnalystInfostop-381"><span class="linenos">381</span></a>
</span><span id="DataAnalystInfostop-382"><a href="#DataAnalystInfostop-382"><span class="linenos">382</span></a>        <span class="n">trajectories_duration_1H</span> <span class="o">=</span> <span class="n">user_trajectories_duration</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-383"><a href="#DataAnalystInfostop-383"><span class="linenos">383</span></a>            <span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">count_empty</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DataAnalystInfostop-384"><a href="#DataAnalystInfostop-384"><span class="linenos">384</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-385"><a href="#DataAnalystInfostop-385"><span class="linenos">385</span></a>
</span><span id="DataAnalystInfostop-386"><a href="#DataAnalystInfostop-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-387"><a href="#DataAnalystInfostop-387"><span class="linenos">387</span></a>            <span class="sa">f</span><span class="s2">&quot;Trajectories duration (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> median): &quot;</span>
</span><span id="DataAnalystInfostop-388"><a href="#DataAnalystInfostop-388"><span class="linenos">388</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trajectories_duration_1H</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-389"><a href="#DataAnalystInfostop-389"><span class="linenos">389</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-390"><a href="#DataAnalystInfostop-390"><span class="linenos">390</span></a>
</span><span id="DataAnalystInfostop-391"><a href="#DataAnalystInfostop-391"><span class="linenos">391</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-392"><a href="#DataAnalystInfostop-392"><span class="linenos">392</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">trajectories_duration_1H</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-393"><a href="#DataAnalystInfostop-393"><span class="linenos">393</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-394"><a href="#DataAnalystInfostop-394"><span class="linenos">394</span></a>            <span class="sa">f</span><span class="s2">&quot;Trajectories duration (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">) distribution.png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-395"><a href="#DataAnalystInfostop-395"><span class="linenos">395</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-396"><a href="#DataAnalystInfostop-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-397"><a href="#DataAnalystInfostop-397"><span class="linenos">397</span></a>
</span><span id="DataAnalystInfostop-398"><a href="#DataAnalystInfostop-398"><span class="linenos">398</span></a>
</span><span id="DataAnalystInfostop-399"><a href="#DataAnalystInfostop-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">_add_no_of_consecutive_records</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-400"><a href="#DataAnalystInfostop-400"><span class="linenos">400</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="n">resolution</span>
</span><span id="DataAnalystInfostop-401"><a href="#DataAnalystInfostop-401"><span class="linenos">401</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-402"><a href="#DataAnalystInfostop-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-403"><a href="#DataAnalystInfostop-403"><span class="linenos">403</span></a><span class="sd">        Adds statistics on consecutive records to the PDF.</span>
</span><span id="DataAnalystInfostop-404"><a href="#DataAnalystInfostop-404"><span class="linenos">404</span></a>
</span><span id="DataAnalystInfostop-405"><a href="#DataAnalystInfostop-405"><span class="linenos">405</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-406"><a href="#DataAnalystInfostop-406"><span class="linenos">406</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-407"><a href="#DataAnalystInfostop-407"><span class="linenos">407</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-408"><a href="#DataAnalystInfostop-408"><span class="linenos">408</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop-409"><a href="#DataAnalystInfostop-409"><span class="linenos">409</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-410"><a href="#DataAnalystInfostop-410"><span class="linenos">410</span></a><span class="sd">            Analysis identifier.</span>
</span><span id="DataAnalystInfostop-411"><a href="#DataAnalystInfostop-411"><span class="linenos">411</span></a><span class="sd">        resolution : str</span>
</span><span id="DataAnalystInfostop-412"><a href="#DataAnalystInfostop-412"><span class="linenos">412</span></a><span class="sd">            Time resolution for consecutive records analysis (e.g., &#39;1H&#39;).</span>
</span><span id="DataAnalystInfostop-413"><a href="#DataAnalystInfostop-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-414"><a href="#DataAnalystInfostop-414"><span class="linenos">414</span></a>
</span><span id="DataAnalystInfostop-415"><a href="#DataAnalystInfostop-415"><span class="linenos">415</span></a>        <span class="n">consecutive_1h</span> <span class="o">=</span> <span class="n">consecutive_record</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-416"><a href="#DataAnalystInfostop-416"><span class="linenos">416</span></a>        <span class="n">consecutive_1h_median</span> <span class="o">=</span> <span class="n">consecutive_1h</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-417"><a href="#DataAnalystInfostop-417"><span class="linenos">417</span></a>
</span><span id="DataAnalystInfostop-418"><a href="#DataAnalystInfostop-418"><span class="linenos">418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-419"><a href="#DataAnalystInfostop-419"><span class="linenos">419</span></a>            <span class="sa">f</span><span class="s2">&quot;Median of consecutive records (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">):&quot;</span>
</span><span id="DataAnalystInfostop-420"><a href="#DataAnalystInfostop-420"><span class="linenos">420</span></a>            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">consecutive_1h_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-421"><a href="#DataAnalystInfostop-421"><span class="linenos">421</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-422"><a href="#DataAnalystInfostop-422"><span class="linenos">422</span></a>
</span><span id="DataAnalystInfostop-423"><a href="#DataAnalystInfostop-423"><span class="linenos">423</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-424"><a href="#DataAnalystInfostop-424"><span class="linenos">424</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">consecutive_1h</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-425"><a href="#DataAnalystInfostop-425"><span class="linenos">425</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-426"><a href="#DataAnalystInfostop-426"><span class="linenos">426</span></a>            <span class="sa">f</span><span class="s2">&quot;Distribution of consecutive records (</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">).png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-427"><a href="#DataAnalystInfostop-427"><span class="linenos">427</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-428"><a href="#DataAnalystInfostop-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-429"><a href="#DataAnalystInfostop-429"><span class="linenos">429</span></a>
</span><span id="DataAnalystInfostop-430"><a href="#DataAnalystInfostop-430"><span class="linenos">430</span></a>
</span><span id="DataAnalystInfostop-431"><a href="#DataAnalystInfostop-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">_add_average_temporal_resolution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-432"><a href="#DataAnalystInfostop-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span>
</span><span id="DataAnalystInfostop-433"><a href="#DataAnalystInfostop-433"><span class="linenos">433</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-434"><a href="#DataAnalystInfostop-434"><span class="linenos">434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-435"><a href="#DataAnalystInfostop-435"><span class="linenos">435</span></a><span class="sd">        Adds average temporal resolution statistics to the PDF.</span>
</span><span id="DataAnalystInfostop-436"><a href="#DataAnalystInfostop-436"><span class="linenos">436</span></a>
</span><span id="DataAnalystInfostop-437"><a href="#DataAnalystInfostop-437"><span class="linenos">437</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop-438"><a href="#DataAnalystInfostop-438"><span class="linenos">438</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop-439"><a href="#DataAnalystInfostop-439"><span class="linenos">439</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop-440"><a href="#DataAnalystInfostop-440"><span class="linenos">440</span></a><span class="sd">            Input data for analysis, which includes datetime information</span>
</span><span id="DataAnalystInfostop-441"><a href="#DataAnalystInfostop-441"><span class="linenos">441</span></a><span class="sd">            required to calculate temporal resolution.</span>
</span><span id="DataAnalystInfostop-442"><a href="#DataAnalystInfostop-442"><span class="linenos">442</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop-443"><a href="#DataAnalystInfostop-443"><span class="linenos">443</span></a><span class="sd">            Analysis identifier used in plot filenames.</span>
</span><span id="DataAnalystInfostop-444"><a href="#DataAnalystInfostop-444"><span class="linenos">444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop-445"><a href="#DataAnalystInfostop-445"><span class="linenos">445</span></a>
</span><span id="DataAnalystInfostop-446"><a href="#DataAnalystInfostop-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-447"><a href="#DataAnalystInfostop-447"><span class="linenos">447</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataAnalystInfostop-448"><a href="#DataAnalystInfostop-448"><span class="linenos">448</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-449"><a href="#DataAnalystInfostop-449"><span class="linenos">449</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataAnalystInfostop-450"><a href="#DataAnalystInfostop-450"><span class="linenos">450</span></a>                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="DataAnalystInfostop-451"><a href="#DataAnalystInfostop-451"><span class="linenos">451</span></a>            <span class="p">)</span>
</span><span id="DataAnalystInfostop-452"><a href="#DataAnalystInfostop-452"><span class="linenos">452</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataAnalystInfostop-453"><a href="#DataAnalystInfostop-453"><span class="linenos">453</span></a>            <span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-454"><a href="#DataAnalystInfostop-454"><span class="linenos">454</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-455"><a href="#DataAnalystInfostop-455"><span class="linenos">455</span></a>
</span><span id="DataAnalystInfostop-456"><a href="#DataAnalystInfostop-456"><span class="linenos">456</span></a>        <span class="n">temporal_df_median</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-457"><a href="#DataAnalystInfostop-457"><span class="linenos">457</span></a>        <span class="n">temp_res_animal</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataAnalystInfostop-458"><a href="#DataAnalystInfostop-458"><span class="linenos">458</span></a>        <span class="n">in_minutes</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="p">[</span><span class="o">~</span><span class="n">temporal_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
</span><span id="DataAnalystInfostop-459"><a href="#DataAnalystInfostop-459"><span class="linenos">459</span></a>        <span class="n">in_minutes_filtred</span> <span class="o">=</span> <span class="n">in_minutes</span><span class="p">[</span><span class="n">in_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="DataAnalystInfostop-460"><a href="#DataAnalystInfostop-460"><span class="linenos">460</span></a>
</span><span id="DataAnalystInfostop-461"><a href="#DataAnalystInfostop-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median temporal resolution: &quot;</span>
</span><span id="DataAnalystInfostop-462"><a href="#DataAnalystInfostop-462"><span class="linenos">462</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_df_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-463"><a href="#DataAnalystInfostop-463"><span class="linenos">463</span></a>                           <span class="p">)</span>
</span><span id="DataAnalystInfostop-464"><a href="#DataAnalystInfostop-464"><span class="linenos">464</span></a>
</span><span id="DataAnalystInfostop-465"><a href="#DataAnalystInfostop-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max temporal resolution: &quot;</span>
</span><span id="DataAnalystInfostop-466"><a href="#DataAnalystInfostop-466"><span class="linenos">466</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">in_minutes_filtred</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataAnalystInfostop-467"><a href="#DataAnalystInfostop-467"><span class="linenos">467</span></a>                           <span class="p">)</span>
</span><span id="DataAnalystInfostop-468"><a href="#DataAnalystInfostop-468"><span class="linenos">468</span></a>
</span><span id="DataAnalystInfostop-469"><a href="#DataAnalystInfostop-469"><span class="linenos">469</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_distribution</span><span class="p">(</span>
</span><span id="DataAnalystInfostop-470"><a href="#DataAnalystInfostop-470"><span class="linenos">470</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">in_minutes_filtred</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-471"><a href="#DataAnalystInfostop-471"><span class="linenos">471</span></a>            <span class="n">plot_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Data Analysis </span><span class="si">{</span><span class="n">data_analyst_no</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="DataAnalystInfostop-472"><a href="#DataAnalystInfostop-472"><span class="linenos">472</span></a>            <span class="sa">f</span><span class="s2">&quot;The distribution of average temporal resolution.png&quot;</span><span class="p">,</span>
</span><span id="DataAnalystInfostop-473"><a href="#DataAnalystInfostop-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="DataAnalystInfostop-474"><a href="#DataAnalystInfostop-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class responsible for generating data analysis reports in PDF format.</p>

<h2 id="parameters">Parameters</h2>

<p>pdf_object : FPDF
    PDF instance to which the analysis results will be added.</p>
</div>


                            <div id="DataAnalystInfostop.__init__" class="classattr">
                                        <input id="DataAnalystInfostop.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DataAnalystInfostop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pdf_object</span><span class="p">:</span> <span class="n">fpdf</span><span class="o">.</span><span class="n">fpdf</span><span class="o">.</span><span class="n">FPDF</span>, </span><span class="param"><span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="DataAnalystInfostop.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataAnalystInfostop.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataAnalystInfostop.__init__-68"><a href="#DataAnalystInfostop.__init__-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop.__init__-69"><a href="#DataAnalystInfostop.__init__-69"><span class="linenos">69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop.__init__-70"><a href="#DataAnalystInfostop.__init__-70"><span class="linenos">70</span></a><span class="sd">        Initializes the DataAnalystInfostop with a given PDF instance.</span>
</span><span id="DataAnalystInfostop.__init__-71"><a href="#DataAnalystInfostop.__init__-71"><span class="linenos">71</span></a>
</span><span id="DataAnalystInfostop.__init__-72"><a href="#DataAnalystInfostop.__init__-72"><span class="linenos">72</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop.__init__-73"><a href="#DataAnalystInfostop.__init__-73"><span class="linenos">73</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop.__init__-74"><a href="#DataAnalystInfostop.__init__-74"><span class="linenos">74</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="DataAnalystInfostop.__init__-75"><a href="#DataAnalystInfostop.__init__-75"><span class="linenos">75</span></a><span class="sd">            PDF instance where analysis results will be written.</span>
</span><span id="DataAnalystInfostop.__init__-76"><a href="#DataAnalystInfostop.__init__-76"><span class="linenos">76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop.__init__-77"><a href="#DataAnalystInfostop.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="DataAnalystInfostop.__init__-78"><a href="#DataAnalystInfostop.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the DataAnalystInfostop with a given PDF instance.</p>

<h2 id="parameters">Parameters</h2>

<p>pdf_object : FPDF
    PDF instance where analysis results will be written.</p>
</div>


                            </div>
                            <div id="DataAnalystInfostop.pdf_object" class="classattr">
                                <div class="attr variable">
            <span class="name">pdf_object</span>

        
    </div>
    <a class="headerlink" href="#DataAnalystInfostop.pdf_object"></a>
    
    

                            </div>
                            <div id="DataAnalystInfostop.output_path" class="classattr">
                                <div class="attr variable">
            <span class="name">output_path</span>

        
    </div>
    <a class="headerlink" href="#DataAnalystInfostop.output_path"></a>
    
    

                            </div>
                            <div id="DataAnalystInfostop.generate_raport" class="classattr">
                                        <input id="DataAnalystInfostop.generate_raport-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_raport</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span>,</span><span class="param">	<span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DataAnalystInfostop.generate_raport-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataAnalystInfostop.generate_raport"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataAnalystInfostop.generate_raport-81"><a href="#DataAnalystInfostop.generate_raport-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">generate_raport</span><span class="p">(</span>
</span><span id="DataAnalystInfostop.generate_raport-82"><a href="#DataAnalystInfostop.generate_raport-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DataAnalystInfostop.generate_raport-83"><a href="#DataAnalystInfostop.generate_raport-83"><span class="linenos"> 83</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span>
</span><span id="DataAnalystInfostop.generate_raport-84"><a href="#DataAnalystInfostop.generate_raport-84"><span class="linenos"> 84</span></a>            <span class="n">data_analyst_no</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DataAnalystInfostop.generate_raport-85"><a href="#DataAnalystInfostop.generate_raport-85"><span class="linenos"> 85</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataAnalystInfostop.generate_raport-86"><a href="#DataAnalystInfostop.generate_raport-86"><span class="linenos"> 86</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop.generate_raport-87"><a href="#DataAnalystInfostop.generate_raport-87"><span class="linenos"> 87</span></a><span class="sd">        Generates a data analysis report, adding results and visualizations</span>
</span><span id="DataAnalystInfostop.generate_raport-88"><a href="#DataAnalystInfostop.generate_raport-88"><span class="linenos"> 88</span></a><span class="sd">        to the PDF.</span>
</span><span id="DataAnalystInfostop.generate_raport-89"><a href="#DataAnalystInfostop.generate_raport-89"><span class="linenos"> 89</span></a>
</span><span id="DataAnalystInfostop.generate_raport-90"><a href="#DataAnalystInfostop.generate_raport-90"><span class="linenos"> 90</span></a><span class="sd">        Parameters</span>
</span><span id="DataAnalystInfostop.generate_raport-91"><a href="#DataAnalystInfostop.generate_raport-91"><span class="linenos"> 91</span></a><span class="sd">        ----------</span>
</span><span id="DataAnalystInfostop.generate_raport-92"><a href="#DataAnalystInfostop.generate_raport-92"><span class="linenos"> 92</span></a><span class="sd">        data : TrajectoriesFrame</span>
</span><span id="DataAnalystInfostop.generate_raport-93"><a href="#DataAnalystInfostop.generate_raport-93"><span class="linenos"> 93</span></a><span class="sd">            Input data for analysis.</span>
</span><span id="DataAnalystInfostop.generate_raport-94"><a href="#DataAnalystInfostop.generate_raport-94"><span class="linenos"> 94</span></a><span class="sd">        data_analyst_no : int</span>
</span><span id="DataAnalystInfostop.generate_raport-95"><a href="#DataAnalystInfostop.generate_raport-95"><span class="linenos"> 95</span></a><span class="sd">            Analysis identifier used in titles and filenames.</span>
</span><span id="DataAnalystInfostop.generate_raport-96"><a href="#DataAnalystInfostop.generate_raport-96"><span class="linenos"> 96</span></a>
</span><span id="DataAnalystInfostop.generate_raport-97"><a href="#DataAnalystInfostop.generate_raport-97"><span class="linenos"> 97</span></a><span class="sd">        Notes</span>
</span><span id="DataAnalystInfostop.generate_raport-98"><a href="#DataAnalystInfostop.generate_raport-98"><span class="linenos"> 98</span></a><span class="sd">        -----</span>
</span><span id="DataAnalystInfostop.generate_raport-99"><a href="#DataAnalystInfostop.generate_raport-99"><span class="linenos"> 99</span></a><span class="sd">        Executes a data analysis pipeline, generating various statistical</span>
</span><span id="DataAnalystInfostop.generate_raport-100"><a href="#DataAnalystInfostop.generate_raport-100"><span class="linenos">100</span></a><span class="sd">        metrics and plots, which are sequentially added to the PDF document.</span>
</span><span id="DataAnalystInfostop.generate_raport-101"><a href="#DataAnalystInfostop.generate_raport-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataAnalystInfostop.generate_raport-102"><a href="#DataAnalystInfostop.generate_raport-102"><span class="linenos">102</span></a>
</span><span id="DataAnalystInfostop.generate_raport-103"><a href="#DataAnalystInfostop.generate_raport-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_analyst_title</span><span class="p">(</span><span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-104"><a href="#DataAnalystInfostop.generate_raport-104"><span class="linenos">104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_basic_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-105"><a href="#DataAnalystInfostop.generate_raport-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_total_records_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-106"><a href="#DataAnalystInfostop.generate_raport-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-107"><a href="#DataAnalystInfostop.generate_raport-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataAnalystInfostop.generate_raport-108"><a href="#DataAnalystInfostop.generate_raport-108"><span class="linenos">108</span></a>
</span><span id="DataAnalystInfostop.generate_raport-109"><a href="#DataAnalystInfostop.generate_raport-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_records_per_time_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-110"><a href="#DataAnalystInfostop.generate_raport-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_trajctories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-111"><a href="#DataAnalystInfostop.generate_raport-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1H&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-112"><a href="#DataAnalystInfostop.generate_raport-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataAnalystInfostop.generate_raport-113"><a href="#DataAnalystInfostop.generate_raport-113"><span class="linenos">113</span></a>
</span><span id="DataAnalystInfostop.generate_raport-114"><a href="#DataAnalystInfostop.generate_raport-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_no_of_consecutive_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">,</span> <span class="s2">&quot;1D&quot;</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-115"><a href="#DataAnalystInfostop.generate_raport-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_average_temporal_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="p">)</span>
</span><span id="DataAnalystInfostop.generate_raport-116"><a href="#DataAnalystInfostop.generate_raport-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Generates a data analysis report, adding results and visualizations
to the PDF.</p>

<h2 id="parameters">Parameters</h2>

<p>data : TrajectoriesFrame
    Input data for analysis.
data_analyst_no : int
    Analysis identifier used in titles and filenames.</p>

<h2 id="notes">Notes</h2>

<p>Executes a data analysis pipeline, generating various statistical
metrics and plots, which are sequentially added to the PDF document.</p>
</div>


                            </div>
                </section>
                <section id="DataFilter">
                            <input id="DataFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DataFilter</span>:

                <label class="view-source-button" for="DataFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataFilter-478"><a href="#DataFilter-478"><span class="linenos">478</span></a><span class="k">class</span> <span class="nc">DataFilter</span><span class="p">:</span>
</span><span id="DataFilter-479"><a href="#DataFilter-479"><span class="linenos">479</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-480"><a href="#DataFilter-480"><span class="linenos">480</span></a><span class="sd">    A class responsible for filtering, processing, and sorting</span>
</span><span id="DataFilter-481"><a href="#DataFilter-481"><span class="linenos">481</span></a><span class="sd">    animal trajectory data.</span>
</span><span id="DataFilter-482"><a href="#DataFilter-482"><span class="linenos">482</span></a>
</span><span id="DataFilter-483"><a href="#DataFilter-483"><span class="linenos">483</span></a><span class="sd">    Attributes:</span>
</span><span id="DataFilter-484"><a href="#DataFilter-484"><span class="linenos">484</span></a><span class="sd">        pdf_object (FPDF): PDF object used for documenting</span>
</span><span id="DataFilter-485"><a href="#DataFilter-485"><span class="linenos">485</span></a><span class="sd">            the data processing steps.</span>
</span><span id="DataFilter-486"><a href="#DataFilter-486"><span class="linenos">486</span></a><span class="sd">        allowed_minutes (list): List of allowed temporal</span>
</span><span id="DataFilter-487"><a href="#DataFilter-487"><span class="linenos">487</span></a><span class="sd">            resolutions in minutes.</span>
</span><span id="DataFilter-488"><a href="#DataFilter-488"><span class="linenos">488</span></a><span class="sd">        day_window (int): Time window in days for selecting</span>
</span><span id="DataFilter-489"><a href="#DataFilter-489"><span class="linenos">489</span></a><span class="sd">            the best periods of data.</span>
</span><span id="DataFilter-490"><a href="#DataFilter-490"><span class="linenos">490</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DataFilter-491"><a href="#DataFilter-491"><span class="linenos">491</span></a>
</span><span id="DataFilter-492"><a href="#DataFilter-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataFilter-493"><a href="#DataFilter-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-494"><a href="#DataFilter-494"><span class="linenos">494</span></a><span class="sd">        Initializes the DataFilter object with a PDF for logging</span>
</span><span id="DataFilter-495"><a href="#DataFilter-495"><span class="linenos">495</span></a><span class="sd">        and default settings.</span>
</span><span id="DataFilter-496"><a href="#DataFilter-496"><span class="linenos">496</span></a>
</span><span id="DataFilter-497"><a href="#DataFilter-497"><span class="linenos">497</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-498"><a href="#DataFilter-498"><span class="linenos">498</span></a><span class="sd">            pdf_object (FPDF): The PDF object for adding logging</span>
</span><span id="DataFilter-499"><a href="#DataFilter-499"><span class="linenos">499</span></a><span class="sd">                information.</span>
</span><span id="DataFilter-500"><a href="#DataFilter-500"><span class="linenos">500</span></a>
</span><span id="DataFilter-501"><a href="#DataFilter-501"><span class="linenos">501</span></a><span class="sd">        Attributes:</span>
</span><span id="DataFilter-502"><a href="#DataFilter-502"><span class="linenos">502</span></a><span class="sd">            allowed_minutes (list): A list of allowed temporal</span>
</span><span id="DataFilter-503"><a href="#DataFilter-503"><span class="linenos">503</span></a><span class="sd">                resolutions (in minutes).</span>
</span><span id="DataFilter-504"><a href="#DataFilter-504"><span class="linenos">504</span></a><span class="sd">            day_window (int): The number of days considered for</span>
</span><span id="DataFilter-505"><a href="#DataFilter-505"><span class="linenos">505</span></a><span class="sd">                the time window.</span>
</span><span id="DataFilter-506"><a href="#DataFilter-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-507"><a href="#DataFilter-507"><span class="linenos">507</span></a>
</span><span id="DataFilter-508"><a href="#DataFilter-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="DataFilter-509"><a href="#DataFilter-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_minutes</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ALLOWED_MINUTES</span>
</span><span id="DataFilter-510"><a href="#DataFilter-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day_window</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">DAYS_WINDOW</span>
</span><span id="DataFilter-511"><a href="#DataFilter-511"><span class="linenos">511</span></a>
</span><span id="DataFilter-512"><a href="#DataFilter-512"><span class="linenos">512</span></a>
</span><span id="DataFilter-513"><a href="#DataFilter-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataFilter-514"><a href="#DataFilter-514"><span class="linenos">514</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-515"><a href="#DataFilter-515"><span class="linenos">515</span></a><span class="sd">        Adds a single line of text to the PDF.</span>
</span><span id="DataFilter-516"><a href="#DataFilter-516"><span class="linenos">516</span></a>
</span><span id="DataFilter-517"><a href="#DataFilter-517"><span class="linenos">517</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-518"><a href="#DataFilter-518"><span class="linenos">518</span></a><span class="sd">            txt_to_add (str): The text to be added to the PDF document.</span>
</span><span id="DataFilter-519"><a href="#DataFilter-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-520"><a href="#DataFilter-520"><span class="linenos">520</span></a>
</span><span id="DataFilter-521"><a href="#DataFilter-521"><span class="linenos">521</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="DataFilter-522"><a href="#DataFilter-522"><span class="linenos">522</span></a>
</span><span id="DataFilter-523"><a href="#DataFilter-523"><span class="linenos">523</span></a>
</span><span id="DataFilter-524"><a href="#DataFilter-524"><span class="linenos">524</span></a>    <span class="k">def</span> <span class="nf">_match_timedelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="DataFilter-525"><a href="#DataFilter-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-526"><a href="#DataFilter-526"><span class="linenos">526</span></a><span class="sd">        Matches a given timedelta to the closest allowed</span>
</span><span id="DataFilter-527"><a href="#DataFilter-527"><span class="linenos">527</span></a><span class="sd">        temporal resolution.</span>
</span><span id="DataFilter-528"><a href="#DataFilter-528"><span class="linenos">528</span></a>
</span><span id="DataFilter-529"><a href="#DataFilter-529"><span class="linenos">529</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-530"><a href="#DataFilter-530"><span class="linenos">530</span></a><span class="sd">            timedelta (pd.Timedelta): The timedelta to match.</span>
</span><span id="DataFilter-531"><a href="#DataFilter-531"><span class="linenos">531</span></a>
</span><span id="DataFilter-532"><a href="#DataFilter-532"><span class="linenos">532</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-533"><a href="#DataFilter-533"><span class="linenos">533</span></a><span class="sd">            tuple: A tuple containing the string representation</span>
</span><span id="DataFilter-534"><a href="#DataFilter-534"><span class="linenos">534</span></a><span class="sd">                of the closest temporal resolution (e.g., &#39;10min&#39;)</span>
</span><span id="DataFilter-535"><a href="#DataFilter-535"><span class="linenos">535</span></a><span class="sd">                and its integer value in minutes.</span>
</span><span id="DataFilter-536"><a href="#DataFilter-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-537"><a href="#DataFilter-537"><span class="linenos">537</span></a>
</span><span id="DataFilter-538"><a href="#DataFilter-538"><span class="linenos">538</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-539"><a href="#DataFilter-539"><span class="linenos">539</span></a>            <span class="n">closest_minute</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="DataFilter-540"><a href="#DataFilter-540"><span class="linenos">540</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">allowed_minutes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="DataFilter-541"><a href="#DataFilter-541"><span class="linenos">541</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span>
</span><span id="DataFilter-542"><a href="#DataFilter-542"><span class="linenos">542</span></a>                <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-543"><a href="#DataFilter-543"><span class="linenos">543</span></a>            <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-544"><a href="#DataFilter-544"><span class="linenos">544</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closest_minute</span><span class="si">}</span><span class="s2">min&quot;</span><span class="p">,</span> <span class="n">closest_minute</span>
</span><span id="DataFilter-545"><a href="#DataFilter-545"><span class="linenos">545</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-546"><a href="#DataFilter-546"><span class="linenos">546</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error matching timedelta: &quot;</span>
</span><span id="DataFilter-547"><a href="#DataFilter-547"><span class="linenos">547</span></a>                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timedelta</span><span class="si">}</span><span class="s2">. Details: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter-548"><a href="#DataFilter-548"><span class="linenos">548</span></a>                        <span class="p">)</span>
</span><span id="DataFilter-549"><a href="#DataFilter-549"><span class="linenos">549</span></a>
</span><span id="DataFilter-550"><a href="#DataFilter-550"><span class="linenos">550</span></a>
</span><span id="DataFilter-551"><a href="#DataFilter-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">_select_time_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closest_minute</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DataFilter-552"><a href="#DataFilter-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-553"><a href="#DataFilter-553"><span class="linenos">553</span></a><span class="sd">        Calculates the number of records required for a rolling window</span>
</span><span id="DataFilter-554"><a href="#DataFilter-554"><span class="linenos">554</span></a><span class="sd">        based on the closest temporal resolution.</span>
</span><span id="DataFilter-555"><a href="#DataFilter-555"><span class="linenos">555</span></a>
</span><span id="DataFilter-556"><a href="#DataFilter-556"><span class="linenos">556</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-557"><a href="#DataFilter-557"><span class="linenos">557</span></a><span class="sd">            closest_minute (int): The closest temporal resolution in minutes.</span>
</span><span id="DataFilter-558"><a href="#DataFilter-558"><span class="linenos">558</span></a>
</span><span id="DataFilter-559"><a href="#DataFilter-559"><span class="linenos">559</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-560"><a href="#DataFilter-560"><span class="linenos">560</span></a><span class="sd">            int: The number of records required for a rolling window.</span>
</span><span id="DataFilter-561"><a href="#DataFilter-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-562"><a href="#DataFilter-562"><span class="linenos">562</span></a>
</span><span id="DataFilter-563"><a href="#DataFilter-563"><span class="linenos">563</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-564"><a href="#DataFilter-564"><span class="linenos">564</span></a>            <span class="n">per_hour</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">closest_minute</span>
</span><span id="DataFilter-565"><a href="#DataFilter-565"><span class="linenos">565</span></a>            <span class="n">per_day</span> <span class="o">=</span> <span class="n">per_hour</span> <span class="o">*</span> <span class="mi">24</span>
</span><span id="DataFilter-566"><a href="#DataFilter-566"><span class="linenos">566</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span> <span class="o">*</span> <span class="n">per_day</span><span class="p">)</span>
</span><span id="DataFilter-567"><a href="#DataFilter-567"><span class="linenos">567</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-568"><a href="#DataFilter-568"><span class="linenos">568</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DataFilter-569"><a href="#DataFilter-569"><span class="linenos">569</span></a>                <span class="sa">f</span><span class="s2">&quot;Error calculating time window for resolution &quot;</span>
</span><span id="DataFilter-570"><a href="#DataFilter-570"><span class="linenos">570</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closest_minute</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter-571"><a href="#DataFilter-571"><span class="linenos">571</span></a>            <span class="p">)</span>
</span><span id="DataFilter-572"><a href="#DataFilter-572"><span class="linenos">572</span></a>
</span><span id="DataFilter-573"><a href="#DataFilter-573"><span class="linenos">573</span></a>
</span><span id="DataFilter-574"><a href="#DataFilter-574"><span class="linenos">574</span></a>    <span class="k">def</span> <span class="nf">_extract_best_coverage</span><span class="p">(</span>
</span><span id="DataFilter-575"><a href="#DataFilter-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">data_coverage</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
</span><span id="DataFilter-576"><a href="#DataFilter-576"><span class="linenos">576</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="DataFilter-577"><a href="#DataFilter-577"><span class="linenos">577</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-578"><a href="#DataFilter-578"><span class="linenos">578</span></a><span class="sd">        Extracts data with the best coverage based on a rolling window.</span>
</span><span id="DataFilter-579"><a href="#DataFilter-579"><span class="linenos">579</span></a>
</span><span id="DataFilter-580"><a href="#DataFilter-580"><span class="linenos">580</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-581"><a href="#DataFilter-581"><span class="linenos">581</span></a><span class="sd">            data (pd.DataFrame): The input data containing user trajectories.</span>
</span><span id="DataFilter-582"><a href="#DataFilter-582"><span class="linenos">582</span></a><span class="sd">            data_coverage (pd.Series): The data coverage calculated over</span>
</span><span id="DataFilter-583"><a href="#DataFilter-583"><span class="linenos">583</span></a><span class="sd">                a rolling window.</span>
</span><span id="DataFilter-584"><a href="#DataFilter-584"><span class="linenos">584</span></a>
</span><span id="DataFilter-585"><a href="#DataFilter-585"><span class="linenos">585</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-586"><a href="#DataFilter-586"><span class="linenos">586</span></a><span class="sd">            pd.DataFrame: The extracted data with the best coverage.</span>
</span><span id="DataFilter-587"><a href="#DataFilter-587"><span class="linenos">587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-588"><a href="#DataFilter-588"><span class="linenos">588</span></a>
</span><span id="DataFilter-589"><a href="#DataFilter-589"><span class="linenos">589</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-590"><a href="#DataFilter-590"><span class="linenos">590</span></a>            <span class="n">extracted</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataFilter-591"><a href="#DataFilter-591"><span class="linenos">591</span></a>            <span class="k">for</span> <span class="n">an_id</span><span class="p">,</span> <span class="n">an_val</span> <span class="ow">in</span> <span class="n">data_coverage</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="DataFilter-592"><a href="#DataFilter-592"><span class="linenos">592</span></a>                <span class="k">if</span> <span class="n">an_val</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
</span><span id="DataFilter-593"><a href="#DataFilter-593"><span class="linenos">593</span></a>                    <span class="k">continue</span>
</span><span id="DataFilter-594"><a href="#DataFilter-594"><span class="linenos">594</span></a>                <span class="n">max_date</span> <span class="o">=</span> <span class="n">an_val</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-595"><a href="#DataFilter-595"><span class="linenos">595</span></a>                <span class="n">till_EOD</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter-596"><a href="#DataFilter-596"><span class="linenos">596</span></a>                    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
</span><span id="DataFilter-597"><a href="#DataFilter-597"><span class="linenos">597</span></a>                        <span class="n">max_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-598"><a href="#DataFilter-598"><span class="linenos">598</span></a>                    <span class="p">)</span>
</span><span id="DataFilter-599"><a href="#DataFilter-599"><span class="linenos">599</span></a>                    <span class="o">-</span> <span class="n">max_date</span>
</span><span id="DataFilter-600"><a href="#DataFilter-600"><span class="linenos">600</span></a>                <span class="p">)</span>
</span><span id="DataFilter-601"><a href="#DataFilter-601"><span class="linenos">601</span></a>                <span class="n">max_date</span> <span class="o">+=</span> <span class="n">till_EOD</span>
</span><span id="DataFilter-602"><a href="#DataFilter-602"><span class="linenos">602</span></a>                <span class="n">an_val</span> <span class="o">=</span> <span class="n">an_val</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter-603"><a href="#DataFilter-603"><span class="linenos">603</span></a>                <span class="n">min_date</span> <span class="o">=</span> <span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span><span class="p">)</span>
</span><span id="DataFilter-604"><a href="#DataFilter-604"><span class="linenos">604</span></a>                <span class="n">cur_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">an_id</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter-605"><a href="#DataFilter-605"><span class="linenos">605</span></a>                <span class="n">selected</span> <span class="o">=</span> <span class="n">cur_df</span><span class="p">[</span>
</span><span id="DataFilter-606"><a href="#DataFilter-606"><span class="linenos">606</span></a>                    <span class="p">(</span><span class="n">cur_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_date</span><span class="p">)</span> <span class="o">&amp;</span>
</span><span id="DataFilter-607"><a href="#DataFilter-607"><span class="linenos">607</span></a>                    <span class="p">(</span><span class="n">cur_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_date</span><span class="p">)</span>
</span><span id="DataFilter-608"><a href="#DataFilter-608"><span class="linenos">608</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="DataFilter-609"><a href="#DataFilter-609"><span class="linenos">609</span></a>                <span class="n">selected</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">an_id</span>
</span><span id="DataFilter-610"><a href="#DataFilter-610"><span class="linenos">610</span></a>                <span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">])</span>
</span><span id="DataFilter-611"><a href="#DataFilter-611"><span class="linenos">611</span></a>                <span class="n">extracted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>
</span><span id="DataFilter-612"><a href="#DataFilter-612"><span class="linenos">612</span></a>
</span><span id="DataFilter-613"><a href="#DataFilter-613"><span class="linenos">613</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
</span><span id="DataFilter-614"><a href="#DataFilter-614"><span class="linenos">614</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-615"><a href="#DataFilter-615"><span class="linenos">615</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting best coverage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-616"><a href="#DataFilter-616"><span class="linenos">616</span></a>
</span><span id="DataFilter-617"><a href="#DataFilter-617"><span class="linenos">617</span></a>
</span><span id="DataFilter-618"><a href="#DataFilter-618"><span class="linenos">618</span></a>    <span class="k">def</span> <span class="nf">_convert_to_unix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="DataFilter-619"><a href="#DataFilter-619"><span class="linenos">619</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-620"><a href="#DataFilter-620"><span class="linenos">620</span></a><span class="sd">        Converts a datetime column to UNIX timestamps.</span>
</span><span id="DataFilter-621"><a href="#DataFilter-621"><span class="linenos">621</span></a>
</span><span id="DataFilter-622"><a href="#DataFilter-622"><span class="linenos">622</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-623"><a href="#DataFilter-623"><span class="linenos">623</span></a><span class="sd">            group (pd.DataFrame): The input DataFrame with a &#39;time&#39; column.</span>
</span><span id="DataFilter-624"><a href="#DataFilter-624"><span class="linenos">624</span></a>
</span><span id="DataFilter-625"><a href="#DataFilter-625"><span class="linenos">625</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-626"><a href="#DataFilter-626"><span class="linenos">626</span></a><span class="sd">            pd.DataFrame: The DataFrame with the &#39;time&#39; column</span>
</span><span id="DataFilter-627"><a href="#DataFilter-627"><span class="linenos">627</span></a><span class="sd">                converted to UNIX timestamps.</span>
</span><span id="DataFilter-628"><a href="#DataFilter-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-629"><a href="#DataFilter-629"><span class="linenos">629</span></a>
</span><span id="DataFilter-630"><a href="#DataFilter-630"><span class="linenos">630</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-631"><a href="#DataFilter-631"><span class="linenos">631</span></a>            <span class="n">group</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="DataFilter-632"><a href="#DataFilter-632"><span class="linenos">632</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
</span><span id="DataFilter-633"><a href="#DataFilter-633"><span class="linenos">633</span></a>            <span class="p">)</span>
</span><span id="DataFilter-634"><a href="#DataFilter-634"><span class="linenos">634</span></a>            <span class="k">return</span> <span class="n">group</span>
</span><span id="DataFilter-635"><a href="#DataFilter-635"><span class="linenos">635</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-636"><a href="#DataFilter-636"><span class="linenos">636</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error converting datetime &quot;</span>
</span><span id="DataFilter-637"><a href="#DataFilter-637"><span class="linenos">637</span></a>                             <span class="sa">f</span><span class="s2">&quot;to UNIX timestamps: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter-638"><a href="#DataFilter-638"><span class="linenos">638</span></a>                        <span class="p">)</span>
</span><span id="DataFilter-639"><a href="#DataFilter-639"><span class="linenos">639</span></a>
</span><span id="DataFilter-640"><a href="#DataFilter-640"><span class="linenos">640</span></a>
</span><span id="DataFilter-641"><a href="#DataFilter-641"><span class="linenos">641</span></a>    <span class="k">def</span> <span class="nf">select_best_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="DataFilter-642"><a href="#DataFilter-642"><span class="linenos">642</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-643"><a href="#DataFilter-643"><span class="linenos">643</span></a><span class="sd">        Selects the best periods of data to maximize coverage.</span>
</span><span id="DataFilter-644"><a href="#DataFilter-644"><span class="linenos">644</span></a>
</span><span id="DataFilter-645"><a href="#DataFilter-645"><span class="linenos">645</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-646"><a href="#DataFilter-646"><span class="linenos">646</span></a><span class="sd">            data (TrajectoriesFrame): The input data containing user trajectories.</span>
</span><span id="DataFilter-647"><a href="#DataFilter-647"><span class="linenos">647</span></a>
</span><span id="DataFilter-648"><a href="#DataFilter-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-649"><a href="#DataFilter-649"><span class="linenos">649</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="DataFilter-650"><a href="#DataFilter-650"><span class="linenos">650</span></a><span class="sd">                the selected data.</span>
</span><span id="DataFilter-651"><a href="#DataFilter-651"><span class="linenos">651</span></a>
</span><span id="DataFilter-652"><a href="#DataFilter-652"><span class="linenos">652</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter-653"><a href="#DataFilter-653"><span class="linenos">653</span></a><span class="sd">            ValueError: If there is an error during data selection.</span>
</span><span id="DataFilter-654"><a href="#DataFilter-654"><span class="linenos">654</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-655"><a href="#DataFilter-655"><span class="linenos">655</span></a>
</span><span id="DataFilter-656"><a href="#DataFilter-656"><span class="linenos">656</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-657"><a href="#DataFilter-657"><span class="linenos">657</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DataFilter-658"><a href="#DataFilter-658"><span class="linenos">658</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter-659"><a href="#DataFilter-659"><span class="linenos">659</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter-660"><a href="#DataFilter-660"><span class="linenos">660</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter-661"><a href="#DataFilter-661"><span class="linenos">661</span></a>                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="DataFilter-662"><a href="#DataFilter-662"><span class="linenos">662</span></a>                <span class="p">)</span>
</span><span id="DataFilter-663"><a href="#DataFilter-663"><span class="linenos">663</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataFilter-664"><a href="#DataFilter-664"><span class="linenos">664</span></a>                <span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter-665"><a href="#DataFilter-665"><span class="linenos">665</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="DataFilter-666"><a href="#DataFilter-666"><span class="linenos">666</span></a>
</span><span id="DataFilter-667"><a href="#DataFilter-667"><span class="linenos">667</span></a>            <span class="n">temporal_df_median</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataFilter-668"><a href="#DataFilter-668"><span class="linenos">668</span></a>            <span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">avg_temp_res_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_timedelta</span><span class="p">(</span>
</span><span id="DataFilter-669"><a href="#DataFilter-669"><span class="linenos">669</span></a>                <span class="n">timedelta</span><span class="o">=</span> <span class="n">temporal_df_median</span> <span class="c1"># type: ignore</span>
</span><span id="DataFilter-670"><a href="#DataFilter-670"><span class="linenos">670</span></a>            <span class="p">)</span>
</span><span id="DataFilter-671"><a href="#DataFilter-671"><span class="linenos">671</span></a>            <span class="n">resampled</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter-672"><a href="#DataFilter-672"><span class="linenos">672</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter-673"><a href="#DataFilter-673"><span class="linenos">673</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter-674"><a href="#DataFilter-674"><span class="linenos">674</span></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span id="DataFilter-675"><a href="#DataFilter-675"><span class="linenos">675</span></a>                <span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="DataFilter-676"><a href="#DataFilter-676"><span class="linenos">676</span></a>            <span class="p">)</span>
</span><span id="DataFilter-677"><a href="#DataFilter-677"><span class="linenos">677</span></a>
</span><span id="DataFilter-678"><a href="#DataFilter-678"><span class="linenos">678</span></a>            <span class="n">check_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_time_window</span><span class="p">(</span><span class="n">avg_temp_res_int</span><span class="p">)</span>
</span><span id="DataFilter-679"><a href="#DataFilter-679"><span class="linenos">679</span></a>            <span class="n">resampled</span><span class="p">[</span><span class="n">resampled</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="DataFilter-680"><a href="#DataFilter-680"><span class="linenos">680</span></a>            <span class="n">data_coverage</span> <span class="o">=</span> <span class="n">resampled</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="DataFilter-681"><a href="#DataFilter-681"><span class="linenos">681</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">check_time</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">check_time</span>
</span><span id="DataFilter-682"><a href="#DataFilter-682"><span class="linenos">682</span></a>            <span class="p">)</span>
</span><span id="DataFilter-683"><a href="#DataFilter-683"><span class="linenos">683</span></a>            <span class="n">extracted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_best_coverage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_coverage</span><span class="p">)</span>
</span><span id="DataFilter-684"><a href="#DataFilter-684"><span class="linenos">684</span></a>
</span><span id="DataFilter-685"><a href="#DataFilter-685"><span class="linenos">685</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Selecting best periods - &quot;</span>
</span><span id="DataFilter-686"><a href="#DataFilter-686"><span class="linenos">686</span></a>                               <span class="s2">&quot;maximizing data coverage&quot;</span>
</span><span id="DataFilter-687"><a href="#DataFilter-687"><span class="linenos">687</span></a>                            <span class="p">)</span>
</span><span id="DataFilter-688"><a href="#DataFilter-688"><span class="linenos">688</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg temporal resolution: &quot;</span>
</span><span id="DataFilter-689"><a href="#DataFilter-689"><span class="linenos">689</span></a>                               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_df_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter-690"><a href="#DataFilter-690"><span class="linenos">690</span></a>                            <span class="p">)</span>
</span><span id="DataFilter-691"><a href="#DataFilter-691"><span class="linenos">691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (str): </span><span class="si">{</span><span class="n">avg_temp_res_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-692"><a href="#DataFilter-692"><span class="linenos">692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (int): </span><span class="si">{</span><span class="n">avg_temp_res_int</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-693"><a href="#DataFilter-693"><span class="linenos">693</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataFilter-694"><a href="#DataFilter-694"><span class="linenos">694</span></a>                <span class="sa">f</span><span class="s2">&quot;Selected time window for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="DataFilter-695"><a href="#DataFilter-695"><span class="linenos">695</span></a>                <span class="sa">f</span><span class="s2">&quot;days (timecheck): </span><span class="si">{</span><span class="n">check_time</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter-696"><a href="#DataFilter-696"><span class="linenos">696</span></a>            <span class="p">)</span>
</span><span id="DataFilter-697"><a href="#DataFilter-697"><span class="linenos">697</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataFilter-698"><a href="#DataFilter-698"><span class="linenos">698</span></a>
</span><span id="DataFilter-699"><a href="#DataFilter-699"><span class="linenos">699</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
</span><span id="DataFilter-700"><a href="#DataFilter-700"><span class="linenos">700</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-701"><a href="#DataFilter-701"><span class="linenos">701</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting best period: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-702"><a href="#DataFilter-702"><span class="linenos">702</span></a>
</span><span id="DataFilter-703"><a href="#DataFilter-703"><span class="linenos">703</span></a>
</span><span id="DataFilter-704"><a href="#DataFilter-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="DataFilter-705"><a href="#DataFilter-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-706"><a href="#DataFilter-706"><span class="linenos">706</span></a><span class="sd">        Filters the data based on various user statistics.</span>
</span><span id="DataFilter-707"><a href="#DataFilter-707"><span class="linenos">707</span></a>
</span><span id="DataFilter-708"><a href="#DataFilter-708"><span class="linenos">708</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-709"><a href="#DataFilter-709"><span class="linenos">709</span></a><span class="sd">            data (pd.DataFrame): The input data containing user trajectories.</span>
</span><span id="DataFilter-710"><a href="#DataFilter-710"><span class="linenos">710</span></a>
</span><span id="DataFilter-711"><a href="#DataFilter-711"><span class="linenos">711</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-712"><a href="#DataFilter-712"><span class="linenos">712</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="DataFilter-713"><a href="#DataFilter-713"><span class="linenos">713</span></a><span class="sd">                the filtered data.</span>
</span><span id="DataFilter-714"><a href="#DataFilter-714"><span class="linenos">714</span></a>
</span><span id="DataFilter-715"><a href="#DataFilter-715"><span class="linenos">715</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter-716"><a href="#DataFilter-716"><span class="linenos">716</span></a><span class="sd">            ValueError: If there is an error during filtering.</span>
</span><span id="DataFilter-717"><a href="#DataFilter-717"><span class="linenos">717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-718"><a href="#DataFilter-718"><span class="linenos">718</span></a>
</span><span id="DataFilter-719"><a href="#DataFilter-719"><span class="linenos">719</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-720"><a href="#DataFilter-720"><span class="linenos">720</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter-721"><a href="#DataFilter-721"><span class="linenos">721</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter-722"><a href="#DataFilter-722"><span class="linenos">722</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter-723"><a href="#DataFilter-723"><span class="linenos">723</span></a>                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="DataFilter-724"><a href="#DataFilter-724"><span class="linenos">724</span></a>            <span class="p">)</span>
</span><span id="DataFilter-725"><a href="#DataFilter-725"><span class="linenos">725</span></a>            <span class="n">temp_res_animal_ex</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataFilter-726"><a href="#DataFilter-726"><span class="linenos">726</span></a>
</span><span id="DataFilter-727"><a href="#DataFilter-727"><span class="linenos">727</span></a>            <span class="c1"># Fraction of missing records &lt; 0.6</span>
</span><span id="DataFilter-728"><a href="#DataFilter-728"><span class="linenos">728</span></a>            <span class="n">frac_filter</span> <span class="o">=</span> <span class="n">fraction_of_empty_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_FRACTION_OF_MISSING_VALUES</span><span class="p">)</span>
</span><span id="DataFilter-729"><a href="#DataFilter-729"><span class="linenos">729</span></a>            <span class="n">level1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">frac_filter</span><span class="p">[</span><span class="n">frac_filter</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">FRACTION_OF_MISSING_VALUES</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="DataFilter-730"><a href="#DataFilter-730"><span class="linenos">730</span></a>
</span><span id="DataFilter-731"><a href="#DataFilter-731"><span class="linenos">731</span></a>            <span class="c1"># More than 20 days of data</span>
</span><span id="DataFilter-732"><a href="#DataFilter-732"><span class="linenos">732</span></a>            <span class="n">traj_dur_filter</span> <span class="o">=</span> <span class="n">user_trajectories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_USER_TRAJECTORIES_DURATION</span><span class="p">)</span>
</span><span id="DataFilter-733"><a href="#DataFilter-733"><span class="linenos">733</span></a>            <span class="n">level2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">traj_dur_filter</span><span class="p">[</span><span class="n">traj_dur_filter</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">USER_TRAJECTORIES_DURATION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="DataFilter-734"><a href="#DataFilter-734"><span class="linenos">734</span></a>
</span><span id="DataFilter-735"><a href="#DataFilter-735"><span class="linenos">735</span></a>            <span class="n">level3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="DataFilter-736"><a href="#DataFilter-736"><span class="linenos">736</span></a>                <span class="n">temp_res_animal_ex</span><span class="p">[</span><span class="n">temp_res_animal_ex</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TEMPORAL_RESOLUTION_EXTRACTION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</span><span id="DataFilter-737"><a href="#DataFilter-737"><span class="linenos">737</span></a>            <span class="p">)</span>
</span><span id="DataFilter-738"><a href="#DataFilter-738"><span class="linenos">738</span></a>
</span><span id="DataFilter-739"><a href="#DataFilter-739"><span class="linenos">739</span></a>            <span class="c1"># User filtration with ULOC method</span>
</span><span id="DataFilter-740"><a href="#DataFilter-740"><span class="linenos">740</span></a>            <span class="n">selection_lvl2</span> <span class="o">=</span> <span class="n">level1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span>
</span><span id="DataFilter-741"><a href="#DataFilter-741"><span class="linenos">741</span></a>            <span class="n">selection_lvl3</span> <span class="o">=</span> <span class="n">selection_lvl2</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span>
</span><span id="DataFilter-742"><a href="#DataFilter-742"><span class="linenos">742</span></a>            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">uloc</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">selection_lvl3</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-743"><a href="#DataFilter-743"><span class="linenos">743</span></a>
</span><span id="DataFilter-744"><a href="#DataFilter-744"><span class="linenos">744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Filtration with user statistics&quot;</span><span class="p">)</span>
</span><span id="DataFilter-745"><a href="#DataFilter-745"><span class="linenos">745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 1: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-746"><a href="#DataFilter-746"><span class="linenos">746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 2: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-747"><a href="#DataFilter-747"><span class="linenos">747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 3: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-748"><a href="#DataFilter-748"><span class="linenos">748</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataFilter-749"><a href="#DataFilter-749"><span class="linenos">749</span></a>
</span><span id="DataFilter-750"><a href="#DataFilter-750"><span class="linenos">750</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>
</span><span id="DataFilter-751"><a href="#DataFilter-751"><span class="linenos">751</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-752"><a href="#DataFilter-752"><span class="linenos">752</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error filtering data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter-753"><a href="#DataFilter-753"><span class="linenos">753</span></a>
</span><span id="DataFilter-754"><a href="#DataFilter-754"><span class="linenos">754</span></a>
</span><span id="DataFilter-755"><a href="#DataFilter-755"><span class="linenos">755</span></a>    <span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="DataFilter-756"><a href="#DataFilter-756"><span class="linenos">756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter-757"><a href="#DataFilter-757"><span class="linenos">757</span></a><span class="sd">        Sorts and prepares trajectory data for infostop processing.</span>
</span><span id="DataFilter-758"><a href="#DataFilter-758"><span class="linenos">758</span></a>
</span><span id="DataFilter-759"><a href="#DataFilter-759"><span class="linenos">759</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter-760"><a href="#DataFilter-760"><span class="linenos">760</span></a><span class="sd">            data (TrajectoriesFrame): The input trajectory data.</span>
</span><span id="DataFilter-761"><a href="#DataFilter-761"><span class="linenos">761</span></a>
</span><span id="DataFilter-762"><a href="#DataFilter-762"><span class="linenos">762</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter-763"><a href="#DataFilter-763"><span class="linenos">763</span></a><span class="sd">            pd.DataFrame: A sorted and prepared DataFrame with columns</span>
</span><span id="DataFilter-764"><a href="#DataFilter-764"><span class="linenos">764</span></a><span class="sd">                [&#39;user_id&#39;, &#39;time&#39;, &#39;latitude&#39;, &#39;longitude&#39;].</span>
</span><span id="DataFilter-765"><a href="#DataFilter-765"><span class="linenos">765</span></a>
</span><span id="DataFilter-766"><a href="#DataFilter-766"><span class="linenos">766</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter-767"><a href="#DataFilter-767"><span class="linenos">767</span></a><span class="sd">            ValueError: If there is an error during sorting or preparation.</span>
</span><span id="DataFilter-768"><a href="#DataFilter-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter-769"><a href="#DataFilter-769"><span class="linenos">769</span></a>
</span><span id="DataFilter-770"><a href="#DataFilter-770"><span class="linenos">770</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter-771"><a href="#DataFilter-771"><span class="linenos">771</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="DataFilter-772"><a href="#DataFilter-772"><span class="linenos">772</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dest_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">ELLIPSOIDAL_CRS</span><span class="p">,</span> <span class="n">cur_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">CARTESIAN_CRS</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-773"><a href="#DataFilter-773"><span class="linenos">773</span></a>            <span class="n">df1</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter-774"><a href="#DataFilter-774"><span class="linenos">774</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
</span><span id="DataFilter-775"><a href="#DataFilter-775"><span class="linenos">775</span></a>                <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">]</span>
</span><span id="DataFilter-776"><a href="#DataFilter-776"><span class="linenos">776</span></a>            <span class="p">]</span>
</span><span id="DataFilter-777"><a href="#DataFilter-777"><span class="linenos">777</span></a>            <span class="n">data_prepared</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataFilter-778"><a href="#DataFilter-778"><span class="linenos">778</span></a>                <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
</span><span id="DataFilter-779"><a href="#DataFilter-779"><span class="linenos">779</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="DataFilter-780"><a href="#DataFilter-780"><span class="linenos">780</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="DataFilter-781"><a href="#DataFilter-781"><span class="linenos">781</span></a>                <span class="s2">&quot;longitude&quot;</span>
</span><span id="DataFilter-782"><a href="#DataFilter-782"><span class="linenos">782</span></a>            <span class="p">]</span>
</span><span id="DataFilter-783"><a href="#DataFilter-783"><span class="linenos">783</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_unix</span><span class="p">(</span><span class="n">data_prepared</span><span class="p">)</span>
</span><span id="DataFilter-784"><a href="#DataFilter-784"><span class="linenos">784</span></a>            <span class="k">return</span> <span class="n">data_prepared</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter-785"><a href="#DataFilter-785"><span class="linenos">785</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter-786"><a href="#DataFilter-786"><span class="linenos">786</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error sorting data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class responsible for filtering, processing, and sorting
animal trajectory data.</p>

<p>Attributes:
    pdf_object (FPDF): PDF object used for documenting
        the data processing steps.
    allowed_minutes (list): List of allowed temporal
        resolutions in minutes.
    day_window (int): Time window in days for selecting
        the best periods of data.</p>
</div>


                            <div id="DataFilter.__init__" class="classattr">
                                        <input id="DataFilter.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DataFilter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pdf_object</span><span class="p">:</span> <span class="n">fpdf</span><span class="o">.</span><span class="n">fpdf</span><span class="o">.</span><span class="n">FPDF</span></span>)</span>

                <label class="view-source-button" for="DataFilter.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataFilter.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataFilter.__init__-492"><a href="#DataFilter.__init__-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataFilter.__init__-493"><a href="#DataFilter.__init__-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter.__init__-494"><a href="#DataFilter.__init__-494"><span class="linenos">494</span></a><span class="sd">        Initializes the DataFilter object with a PDF for logging</span>
</span><span id="DataFilter.__init__-495"><a href="#DataFilter.__init__-495"><span class="linenos">495</span></a><span class="sd">        and default settings.</span>
</span><span id="DataFilter.__init__-496"><a href="#DataFilter.__init__-496"><span class="linenos">496</span></a>
</span><span id="DataFilter.__init__-497"><a href="#DataFilter.__init__-497"><span class="linenos">497</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter.__init__-498"><a href="#DataFilter.__init__-498"><span class="linenos">498</span></a><span class="sd">            pdf_object (FPDF): The PDF object for adding logging</span>
</span><span id="DataFilter.__init__-499"><a href="#DataFilter.__init__-499"><span class="linenos">499</span></a><span class="sd">                information.</span>
</span><span id="DataFilter.__init__-500"><a href="#DataFilter.__init__-500"><span class="linenos">500</span></a>
</span><span id="DataFilter.__init__-501"><a href="#DataFilter.__init__-501"><span class="linenos">501</span></a><span class="sd">        Attributes:</span>
</span><span id="DataFilter.__init__-502"><a href="#DataFilter.__init__-502"><span class="linenos">502</span></a><span class="sd">            allowed_minutes (list): A list of allowed temporal</span>
</span><span id="DataFilter.__init__-503"><a href="#DataFilter.__init__-503"><span class="linenos">503</span></a><span class="sd">                resolutions (in minutes).</span>
</span><span id="DataFilter.__init__-504"><a href="#DataFilter.__init__-504"><span class="linenos">504</span></a><span class="sd">            day_window (int): The number of days considered for</span>
</span><span id="DataFilter.__init__-505"><a href="#DataFilter.__init__-505"><span class="linenos">505</span></a><span class="sd">                the time window.</span>
</span><span id="DataFilter.__init__-506"><a href="#DataFilter.__init__-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter.__init__-507"><a href="#DataFilter.__init__-507"><span class="linenos">507</span></a>
</span><span id="DataFilter.__init__-508"><a href="#DataFilter.__init__-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="DataFilter.__init__-509"><a href="#DataFilter.__init__-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_minutes</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ALLOWED_MINUTES</span>
</span><span id="DataFilter.__init__-510"><a href="#DataFilter.__init__-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day_window</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">DAYS_WINDOW</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the DataFilter object with a PDF for logging
and default settings.</p>

<p>Args:
    pdf_object (FPDF): The PDF object for adding logging
        information.</p>

<p>Attributes:
    allowed_minutes (list): A list of allowed temporal
        resolutions (in minutes).
    day_window (int): The number of days considered for
        the time window.</p>
</div>


                            </div>
                            <div id="DataFilter.pdf_object" class="classattr">
                                <div class="attr variable">
            <span class="name">pdf_object</span>

        
    </div>
    <a class="headerlink" href="#DataFilter.pdf_object"></a>
    
    

                            </div>
                            <div id="DataFilter.allowed_minutes" class="classattr">
                                <div class="attr variable">
            <span class="name">allowed_minutes</span>

        
    </div>
    <a class="headerlink" href="#DataFilter.allowed_minutes"></a>
    
    

                            </div>
                            <div id="DataFilter.day_window" class="classattr">
                                <div class="attr variable">
            <span class="name">day_window</span>

        
    </div>
    <a class="headerlink" href="#DataFilter.day_window"></a>
    
    

                            </div>
                            <div id="DataFilter.select_best_period" class="classattr">
                                        <input id="DataFilter.select_best_period-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_best_period</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span></span><span class="return-annotation">) -> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span>:</span></span>

                <label class="view-source-button" for="DataFilter.select_best_period-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataFilter.select_best_period"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataFilter.select_best_period-641"><a href="#DataFilter.select_best_period-641"><span class="linenos">641</span></a>    <span class="k">def</span> <span class="nf">select_best_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="DataFilter.select_best_period-642"><a href="#DataFilter.select_best_period-642"><span class="linenos">642</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter.select_best_period-643"><a href="#DataFilter.select_best_period-643"><span class="linenos">643</span></a><span class="sd">        Selects the best periods of data to maximize coverage.</span>
</span><span id="DataFilter.select_best_period-644"><a href="#DataFilter.select_best_period-644"><span class="linenos">644</span></a>
</span><span id="DataFilter.select_best_period-645"><a href="#DataFilter.select_best_period-645"><span class="linenos">645</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter.select_best_period-646"><a href="#DataFilter.select_best_period-646"><span class="linenos">646</span></a><span class="sd">            data (TrajectoriesFrame): The input data containing user trajectories.</span>
</span><span id="DataFilter.select_best_period-647"><a href="#DataFilter.select_best_period-647"><span class="linenos">647</span></a>
</span><span id="DataFilter.select_best_period-648"><a href="#DataFilter.select_best_period-648"><span class="linenos">648</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter.select_best_period-649"><a href="#DataFilter.select_best_period-649"><span class="linenos">649</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="DataFilter.select_best_period-650"><a href="#DataFilter.select_best_period-650"><span class="linenos">650</span></a><span class="sd">                the selected data.</span>
</span><span id="DataFilter.select_best_period-651"><a href="#DataFilter.select_best_period-651"><span class="linenos">651</span></a>
</span><span id="DataFilter.select_best_period-652"><a href="#DataFilter.select_best_period-652"><span class="linenos">652</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter.select_best_period-653"><a href="#DataFilter.select_best_period-653"><span class="linenos">653</span></a><span class="sd">            ValueError: If there is an error during data selection.</span>
</span><span id="DataFilter.select_best_period-654"><a href="#DataFilter.select_best_period-654"><span class="linenos">654</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter.select_best_period-655"><a href="#DataFilter.select_best_period-655"><span class="linenos">655</span></a>
</span><span id="DataFilter.select_best_period-656"><a href="#DataFilter.select_best_period-656"><span class="linenos">656</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter.select_best_period-657"><a href="#DataFilter.select_best_period-657"><span class="linenos">657</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_users</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DataFilter.select_best_period-658"><a href="#DataFilter.select_best_period-658"><span class="linenos">658</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter.select_best_period-659"><a href="#DataFilter.select_best_period-659"><span class="linenos">659</span></a>                    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-660"><a href="#DataFilter.select_best_period-660"><span class="linenos">660</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-661"><a href="#DataFilter.select_best_period-661"><span class="linenos">661</span></a>                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="DataFilter.select_best_period-662"><a href="#DataFilter.select_best_period-662"><span class="linenos">662</span></a>                <span class="p">)</span>
</span><span id="DataFilter.select_best_period-663"><a href="#DataFilter.select_best_period-663"><span class="linenos">663</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataFilter.select_best_period-664"><a href="#DataFilter.select_best_period-664"><span class="linenos">664</span></a>                <span class="n">data_reset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter.select_best_period-665"><a href="#DataFilter.select_best_period-665"><span class="linenos">665</span></a>                <span class="n">temporal_df</span> <span class="o">=</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_reset</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
</span><span id="DataFilter.select_best_period-666"><a href="#DataFilter.select_best_period-666"><span class="linenos">666</span></a>
</span><span id="DataFilter.select_best_period-667"><a href="#DataFilter.select_best_period-667"><span class="linenos">667</span></a>            <span class="n">temporal_df_median</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataFilter.select_best_period-668"><a href="#DataFilter.select_best_period-668"><span class="linenos">668</span></a>            <span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">avg_temp_res_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_timedelta</span><span class="p">(</span>
</span><span id="DataFilter.select_best_period-669"><a href="#DataFilter.select_best_period-669"><span class="linenos">669</span></a>                <span class="n">timedelta</span><span class="o">=</span> <span class="n">temporal_df_median</span> <span class="c1"># type: ignore</span>
</span><span id="DataFilter.select_best_period-670"><a href="#DataFilter.select_best_period-670"><span class="linenos">670</span></a>            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-671"><a href="#DataFilter.select_best_period-671"><span class="linenos">671</span></a>            <span class="n">resampled</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter.select_best_period-672"><a href="#DataFilter.select_best_period-672"><span class="linenos">672</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-673"><a href="#DataFilter.select_best_period-673"><span class="linenos">673</span></a>                <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">avg_temp_res_str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-674"><a href="#DataFilter.select_best_period-674"><span class="linenos">674</span></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span id="DataFilter.select_best_period-675"><a href="#DataFilter.select_best_period-675"><span class="linenos">675</span></a>                <span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="DataFilter.select_best_period-676"><a href="#DataFilter.select_best_period-676"><span class="linenos">676</span></a>            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-677"><a href="#DataFilter.select_best_period-677"><span class="linenos">677</span></a>
</span><span id="DataFilter.select_best_period-678"><a href="#DataFilter.select_best_period-678"><span class="linenos">678</span></a>            <span class="n">check_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_time_window</span><span class="p">(</span><span class="n">avg_temp_res_int</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-679"><a href="#DataFilter.select_best_period-679"><span class="linenos">679</span></a>            <span class="n">resampled</span><span class="p">[</span><span class="n">resampled</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="DataFilter.select_best_period-680"><a href="#DataFilter.select_best_period-680"><span class="linenos">680</span></a>            <span class="n">data_coverage</span> <span class="o">=</span> <span class="n">resampled</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="DataFilter.select_best_period-681"><a href="#DataFilter.select_best_period-681"><span class="linenos">681</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">check_time</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">check_time</span>
</span><span id="DataFilter.select_best_period-682"><a href="#DataFilter.select_best_period-682"><span class="linenos">682</span></a>            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-683"><a href="#DataFilter.select_best_period-683"><span class="linenos">683</span></a>            <span class="n">extracted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_best_coverage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_coverage</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-684"><a href="#DataFilter.select_best_period-684"><span class="linenos">684</span></a>
</span><span id="DataFilter.select_best_period-685"><a href="#DataFilter.select_best_period-685"><span class="linenos">685</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Selecting best periods - &quot;</span>
</span><span id="DataFilter.select_best_period-686"><a href="#DataFilter.select_best_period-686"><span class="linenos">686</span></a>                               <span class="s2">&quot;maximizing data coverage&quot;</span>
</span><span id="DataFilter.select_best_period-687"><a href="#DataFilter.select_best_period-687"><span class="linenos">687</span></a>                            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-688"><a href="#DataFilter.select_best_period-688"><span class="linenos">688</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avg temporal resolution: &quot;</span>
</span><span id="DataFilter.select_best_period-689"><a href="#DataFilter.select_best_period-689"><span class="linenos">689</span></a>                               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temporal_df_median</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter.select_best_period-690"><a href="#DataFilter.select_best_period-690"><span class="linenos">690</span></a>                            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-691"><a href="#DataFilter.select_best_period-691"><span class="linenos">691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (str): </span><span class="si">{</span><span class="n">avg_temp_res_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-692"><a href="#DataFilter.select_best_period-692"><span class="linenos">692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resample value (int): </span><span class="si">{</span><span class="n">avg_temp_res_int</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-693"><a href="#DataFilter.select_best_period-693"><span class="linenos">693</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="DataFilter.select_best_period-694"><a href="#DataFilter.select_best_period-694"><span class="linenos">694</span></a>                <span class="sa">f</span><span class="s2">&quot;Selected time window for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">day_window</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="DataFilter.select_best_period-695"><a href="#DataFilter.select_best_period-695"><span class="linenos">695</span></a>                <span class="sa">f</span><span class="s2">&quot;days (timecheck): </span><span class="si">{</span><span class="n">check_time</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataFilter.select_best_period-696"><a href="#DataFilter.select_best_period-696"><span class="linenos">696</span></a>            <span class="p">)</span>
</span><span id="DataFilter.select_best_period-697"><a href="#DataFilter.select_best_period-697"><span class="linenos">697</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataFilter.select_best_period-698"><a href="#DataFilter.select_best_period-698"><span class="linenos">698</span></a>
</span><span id="DataFilter.select_best_period-699"><a href="#DataFilter.select_best_period-699"><span class="linenos">699</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
</span><span id="DataFilter.select_best_period-700"><a href="#DataFilter.select_best_period-700"><span class="linenos">700</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter.select_best_period-701"><a href="#DataFilter.select_best_period-701"><span class="linenos">701</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting best period: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Selects the best periods of data to maximize coverage.</p>

<p>Args:
    data (TrajectoriesFrame): The input data containing user trajectories.</p>

<p>Returns:
    TrajectoriesFrame: A TrajectoriesFrame object containing
        the selected data.</p>

<p>Raises:
    ValueError: If there is an error during data selection.</p>
</div>


                            </div>
                            <div id="DataFilter.filter_data" class="classattr">
                                        <input id="DataFilter.filter_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">) -> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span>:</span></span>

                <label class="view-source-button" for="DataFilter.filter_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataFilter.filter_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataFilter.filter_data-704"><a href="#DataFilter.filter_data-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">filter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrajectoriesFrame</span><span class="p">:</span>
</span><span id="DataFilter.filter_data-705"><a href="#DataFilter.filter_data-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter.filter_data-706"><a href="#DataFilter.filter_data-706"><span class="linenos">706</span></a><span class="sd">        Filters the data based on various user statistics.</span>
</span><span id="DataFilter.filter_data-707"><a href="#DataFilter.filter_data-707"><span class="linenos">707</span></a>
</span><span id="DataFilter.filter_data-708"><a href="#DataFilter.filter_data-708"><span class="linenos">708</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter.filter_data-709"><a href="#DataFilter.filter_data-709"><span class="linenos">709</span></a><span class="sd">            data (pd.DataFrame): The input data containing user trajectories.</span>
</span><span id="DataFilter.filter_data-710"><a href="#DataFilter.filter_data-710"><span class="linenos">710</span></a>
</span><span id="DataFilter.filter_data-711"><a href="#DataFilter.filter_data-711"><span class="linenos">711</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter.filter_data-712"><a href="#DataFilter.filter_data-712"><span class="linenos">712</span></a><span class="sd">            TrajectoriesFrame: A TrajectoriesFrame object containing</span>
</span><span id="DataFilter.filter_data-713"><a href="#DataFilter.filter_data-713"><span class="linenos">713</span></a><span class="sd">                the filtered data.</span>
</span><span id="DataFilter.filter_data-714"><a href="#DataFilter.filter_data-714"><span class="linenos">714</span></a>
</span><span id="DataFilter.filter_data-715"><a href="#DataFilter.filter_data-715"><span class="linenos">715</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter.filter_data-716"><a href="#DataFilter.filter_data-716"><span class="linenos">716</span></a><span class="sd">            ValueError: If there is an error during filtering.</span>
</span><span id="DataFilter.filter_data-717"><a href="#DataFilter.filter_data-717"><span class="linenos">717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter.filter_data-718"><a href="#DataFilter.filter_data-718"><span class="linenos">718</span></a>
</span><span id="DataFilter.filter_data-719"><a href="#DataFilter.filter_data-719"><span class="linenos">719</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter.filter_data-720"><a href="#DataFilter.filter_data-720"><span class="linenos">720</span></a>            <span class="n">temporal_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataFilter.filter_data-721"><a href="#DataFilter.filter_data-721"><span class="linenos">721</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-722"><a href="#DataFilter.filter_data-722"><span class="linenos">722</span></a>                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-723"><a href="#DataFilter.filter_data-723"><span class="linenos">723</span></a>                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
</span><span id="DataFilter.filter_data-724"><a href="#DataFilter.filter_data-724"><span class="linenos">724</span></a>            <span class="p">)</span>
</span><span id="DataFilter.filter_data-725"><a href="#DataFilter.filter_data-725"><span class="linenos">725</span></a>            <span class="n">temp_res_animal_ex</span> <span class="o">=</span> <span class="n">temporal_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="DataFilter.filter_data-726"><a href="#DataFilter.filter_data-726"><span class="linenos">726</span></a>
</span><span id="DataFilter.filter_data-727"><a href="#DataFilter.filter_data-727"><span class="linenos">727</span></a>            <span class="c1"># Fraction of missing records &lt; 0.6</span>
</span><span id="DataFilter.filter_data-728"><a href="#DataFilter.filter_data-728"><span class="linenos">728</span></a>            <span class="n">frac_filter</span> <span class="o">=</span> <span class="n">fraction_of_empty_records</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_FRACTION_OF_MISSING_VALUES</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-729"><a href="#DataFilter.filter_data-729"><span class="linenos">729</span></a>            <span class="n">level1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">frac_filter</span><span class="p">[</span><span class="n">frac_filter</span> <span class="o">&lt;</span> <span class="n">const</span><span class="o">.</span><span class="n">FRACTION_OF_MISSING_VALUES</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-730"><a href="#DataFilter.filter_data-730"><span class="linenos">730</span></a>
</span><span id="DataFilter.filter_data-731"><a href="#DataFilter.filter_data-731"><span class="linenos">731</span></a>            <span class="c1"># More than 20 days of data</span>
</span><span id="DataFilter.filter_data-732"><a href="#DataFilter.filter_data-732"><span class="linenos">732</span></a>            <span class="n">traj_dur_filter</span> <span class="o">=</span> <span class="n">user_trajectories_duration</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">RESOLUTION_OF_USER_TRAJECTORIES_DURATION</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-733"><a href="#DataFilter.filter_data-733"><span class="linenos">733</span></a>            <span class="n">level2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">traj_dur_filter</span><span class="p">[</span><span class="n">traj_dur_filter</span> <span class="o">&gt;</span> <span class="n">const</span><span class="o">.</span><span class="n">USER_TRAJECTORIES_DURATION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-734"><a href="#DataFilter.filter_data-734"><span class="linenos">734</span></a>
</span><span id="DataFilter.filter_data-735"><a href="#DataFilter.filter_data-735"><span class="linenos">735</span></a>            <span class="n">level3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="DataFilter.filter_data-736"><a href="#DataFilter.filter_data-736"><span class="linenos">736</span></a>                <span class="n">temp_res_animal_ex</span><span class="p">[</span><span class="n">temp_res_animal_ex</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TEMPORAL_RESOLUTION_EXTRACTION</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</span><span id="DataFilter.filter_data-737"><a href="#DataFilter.filter_data-737"><span class="linenos">737</span></a>            <span class="p">)</span>
</span><span id="DataFilter.filter_data-738"><a href="#DataFilter.filter_data-738"><span class="linenos">738</span></a>
</span><span id="DataFilter.filter_data-739"><a href="#DataFilter.filter_data-739"><span class="linenos">739</span></a>            <span class="c1"># User filtration with ULOC method</span>
</span><span id="DataFilter.filter_data-740"><a href="#DataFilter.filter_data-740"><span class="linenos">740</span></a>            <span class="n">selection_lvl2</span> <span class="o">=</span> <span class="n">level1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-741"><a href="#DataFilter.filter_data-741"><span class="linenos">741</span></a>            <span class="n">selection_lvl3</span> <span class="o">=</span> <span class="n">selection_lvl2</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-742"><a href="#DataFilter.filter_data-742"><span class="linenos">742</span></a>            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">uloc</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">selection_lvl3</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter.filter_data-743"><a href="#DataFilter.filter_data-743"><span class="linenos">743</span></a>
</span><span id="DataFilter.filter_data-744"><a href="#DataFilter.filter_data-744"><span class="linenos">744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Filtration with user statistics&quot;</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-745"><a href="#DataFilter.filter_data-745"><span class="linenos">745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 1: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-746"><a href="#DataFilter.filter_data-746"><span class="linenos">746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 2: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-747"><a href="#DataFilter.filter_data-747"><span class="linenos">747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of animals on level 3: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-748"><a href="#DataFilter.filter_data-748"><span class="linenos">748</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="DataFilter.filter_data-749"><a href="#DataFilter.filter_data-749"><span class="linenos">749</span></a>
</span><span id="DataFilter.filter_data-750"><a href="#DataFilter.filter_data-750"><span class="linenos">750</span></a>            <span class="k">return</span> <span class="n">TrajectoriesFrame</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>
</span><span id="DataFilter.filter_data-751"><a href="#DataFilter.filter_data-751"><span class="linenos">751</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter.filter_data-752"><a href="#DataFilter.filter_data-752"><span class="linenos">752</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error filtering data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Filters the data based on various user statistics.</p>

<p>Args:
    data (pd.DataFrame): The input data containing user trajectories.</p>

<p>Returns:
    TrajectoriesFrame: A TrajectoriesFrame object containing
        the filtered data.</p>

<p>Raises:
    ValueError: If there is an error during filtering.</p>
</div>


                            </div>
                            <div id="DataFilter.sort_data" class="classattr">
                                        <input id="DataFilter.sort_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sort_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="DataFilter.sort_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataFilter.sort_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataFilter.sort_data-755"><a href="#DataFilter.sort_data-755"><span class="linenos">755</span></a>    <span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="DataFilter.sort_data-756"><a href="#DataFilter.sort_data-756"><span class="linenos">756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DataFilter.sort_data-757"><a href="#DataFilter.sort_data-757"><span class="linenos">757</span></a><span class="sd">        Sorts and prepares trajectory data for infostop processing.</span>
</span><span id="DataFilter.sort_data-758"><a href="#DataFilter.sort_data-758"><span class="linenos">758</span></a>
</span><span id="DataFilter.sort_data-759"><a href="#DataFilter.sort_data-759"><span class="linenos">759</span></a><span class="sd">        Args:</span>
</span><span id="DataFilter.sort_data-760"><a href="#DataFilter.sort_data-760"><span class="linenos">760</span></a><span class="sd">            data (TrajectoriesFrame): The input trajectory data.</span>
</span><span id="DataFilter.sort_data-761"><a href="#DataFilter.sort_data-761"><span class="linenos">761</span></a>
</span><span id="DataFilter.sort_data-762"><a href="#DataFilter.sort_data-762"><span class="linenos">762</span></a><span class="sd">        Returns:</span>
</span><span id="DataFilter.sort_data-763"><a href="#DataFilter.sort_data-763"><span class="linenos">763</span></a><span class="sd">            pd.DataFrame: A sorted and prepared DataFrame with columns</span>
</span><span id="DataFilter.sort_data-764"><a href="#DataFilter.sort_data-764"><span class="linenos">764</span></a><span class="sd">                [&#39;user_id&#39;, &#39;time&#39;, &#39;latitude&#39;, &#39;longitude&#39;].</span>
</span><span id="DataFilter.sort_data-765"><a href="#DataFilter.sort_data-765"><span class="linenos">765</span></a>
</span><span id="DataFilter.sort_data-766"><a href="#DataFilter.sort_data-766"><span class="linenos">766</span></a><span class="sd">        Raises:</span>
</span><span id="DataFilter.sort_data-767"><a href="#DataFilter.sort_data-767"><span class="linenos">767</span></a><span class="sd">            ValueError: If there is an error during sorting or preparation.</span>
</span><span id="DataFilter.sort_data-768"><a href="#DataFilter.sort_data-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataFilter.sort_data-769"><a href="#DataFilter.sort_data-769"><span class="linenos">769</span></a>
</span><span id="DataFilter.sort_data-770"><a href="#DataFilter.sort_data-770"><span class="linenos">770</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataFilter.sort_data-771"><a href="#DataFilter.sort_data-771"><span class="linenos">771</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="DataFilter.sort_data-772"><a href="#DataFilter.sort_data-772"><span class="linenos">772</span></a>            <span class="n">data_sorted</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dest_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">ELLIPSOIDAL_CRS</span><span class="p">,</span> <span class="n">cur_crs</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">CARTESIAN_CRS</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter.sort_data-773"><a href="#DataFilter.sort_data-773"><span class="linenos">773</span></a>            <span class="n">df1</span> <span class="o">=</span> <span class="n">data_sorted</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="DataFilter.sort_data-774"><a href="#DataFilter.sort_data-774"><span class="linenos">774</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
</span><span id="DataFilter.sort_data-775"><a href="#DataFilter.sort_data-775"><span class="linenos">775</span></a>                <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">]</span>
</span><span id="DataFilter.sort_data-776"><a href="#DataFilter.sort_data-776"><span class="linenos">776</span></a>            <span class="p">]</span>
</span><span id="DataFilter.sort_data-777"><a href="#DataFilter.sort_data-777"><span class="linenos">777</span></a>            <span class="n">data_prepared</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DataFilter.sort_data-778"><a href="#DataFilter.sort_data-778"><span class="linenos">778</span></a>                <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
</span><span id="DataFilter.sort_data-779"><a href="#DataFilter.sort_data-779"><span class="linenos">779</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="DataFilter.sort_data-780"><a href="#DataFilter.sort_data-780"><span class="linenos">780</span></a>                <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
</span><span id="DataFilter.sort_data-781"><a href="#DataFilter.sort_data-781"><span class="linenos">781</span></a>                <span class="s2">&quot;longitude&quot;</span>
</span><span id="DataFilter.sort_data-782"><a href="#DataFilter.sort_data-782"><span class="linenos">782</span></a>            <span class="p">]</span>
</span><span id="DataFilter.sort_data-783"><a href="#DataFilter.sort_data-783"><span class="linenos">783</span></a>            <span class="n">data_prepared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_unix</span><span class="p">(</span><span class="n">data_prepared</span><span class="p">)</span>
</span><span id="DataFilter.sort_data-784"><a href="#DataFilter.sort_data-784"><span class="linenos">784</span></a>            <span class="k">return</span> <span class="n">data_prepared</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="DataFilter.sort_data-785"><a href="#DataFilter.sort_data-785"><span class="linenos">785</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataFilter.sort_data-786"><a href="#DataFilter.sort_data-786"><span class="linenos">786</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error sorting data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sorts and prepares trajectory data for infostop processing.</p>

<p>Args:
    data (TrajectoriesFrame): The input trajectory data.</p>

<p>Returns:
    pd.DataFrame: A sorted and prepared DataFrame with columns
        ['user_id', 'time', 'latitude', 'longitude'].</p>

<p>Raises:
    ValueError: If there is an error during sorting or preparation.</p>
</div>


                            </div>
                </section>
                <section id="LabelsCalc">
                            <input id="LabelsCalc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LabelsCalc</span>:

                <label class="view-source-button" for="LabelsCalc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LabelsCalc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LabelsCalc-790"><a href="#LabelsCalc-790"><span class="linenos"> 790</span></a><span class="k">class</span> <span class="nc">LabelsCalc</span><span class="p">:</span>
</span><span id="LabelsCalc-791"><a href="#LabelsCalc-791"><span class="linenos"> 791</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-792"><a href="#LabelsCalc-792"><span class="linenos"> 792</span></a><span class="sd">    A class for processing and labeling movement data using</span>
</span><span id="LabelsCalc-793"><a href="#LabelsCalc-793"><span class="linenos"> 793</span></a><span class="sd">    the Infostop algorithm. Includes functionality for parameter optimization,</span>
</span><span id="LabelsCalc-794"><a href="#LabelsCalc-794"><span class="linenos"> 794</span></a><span class="sd">    trajectory segmentation, and result visualization.</span>
</span><span id="LabelsCalc-795"><a href="#LabelsCalc-795"><span class="linenos"> 795</span></a>
</span><span id="LabelsCalc-796"><a href="#LabelsCalc-796"><span class="linenos"> 796</span></a><span class="sd">    Attributes</span>
</span><span id="LabelsCalc-797"><a href="#LabelsCalc-797"><span class="linenos"> 797</span></a><span class="sd">    ----------</span>
</span><span id="LabelsCalc-798"><a href="#LabelsCalc-798"><span class="linenos"> 798</span></a><span class="sd">    pdf_object : FPDF</span>
</span><span id="LabelsCalc-799"><a href="#LabelsCalc-799"><span class="linenos"> 799</span></a><span class="sd">        A PDF object for documenting results and calculations.</span>
</span><span id="LabelsCalc-800"><a href="#LabelsCalc-800"><span class="linenos"> 800</span></a><span class="sd">    output_path : str</span>
</span><span id="LabelsCalc-801"><a href="#LabelsCalc-801"><span class="linenos"> 801</span></a><span class="sd">        The directory where plots and other outputs will be saved.</span>
</span><span id="LabelsCalc-802"><a href="#LabelsCalc-802"><span class="linenos"> 802</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-803"><a href="#LabelsCalc-803"><span class="linenos"> 803</span></a>
</span><span id="LabelsCalc-804"><a href="#LabelsCalc-804"><span class="linenos"> 804</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LabelsCalc-805"><a href="#LabelsCalc-805"><span class="linenos"> 805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-806"><a href="#LabelsCalc-806"><span class="linenos"> 806</span></a><span class="sd">        Initialize the LabelsCalc instance.</span>
</span><span id="LabelsCalc-807"><a href="#LabelsCalc-807"><span class="linenos"> 807</span></a>
</span><span id="LabelsCalc-808"><a href="#LabelsCalc-808"><span class="linenos"> 808</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-809"><a href="#LabelsCalc-809"><span class="linenos"> 809</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-810"><a href="#LabelsCalc-810"><span class="linenos"> 810</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="LabelsCalc-811"><a href="#LabelsCalc-811"><span class="linenos"> 811</span></a><span class="sd">            PDF object for logging and documentation.</span>
</span><span id="LabelsCalc-812"><a href="#LabelsCalc-812"><span class="linenos"> 812</span></a><span class="sd">        output_path : str</span>
</span><span id="LabelsCalc-813"><a href="#LabelsCalc-813"><span class="linenos"> 813</span></a><span class="sd">            Path to save generated plots and outputs.</span>
</span><span id="LabelsCalc-814"><a href="#LabelsCalc-814"><span class="linenos"> 814</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-815"><a href="#LabelsCalc-815"><span class="linenos"> 815</span></a>
</span><span id="LabelsCalc-816"><a href="#LabelsCalc-816"><span class="linenos"> 816</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="LabelsCalc-817"><a href="#LabelsCalc-817"><span class="linenos"> 817</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="LabelsCalc-818"><a href="#LabelsCalc-818"><span class="linenos"> 818</span></a>
</span><span id="LabelsCalc-819"><a href="#LabelsCalc-819"><span class="linenos"> 819</span></a>
</span><span id="LabelsCalc-820"><a href="#LabelsCalc-820"><span class="linenos"> 820</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_to_add</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LabelsCalc-821"><a href="#LabelsCalc-821"><span class="linenos"> 821</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-822"><a href="#LabelsCalc-822"><span class="linenos"> 822</span></a><span class="sd">        Add a single line of text to the PDF.</span>
</span><span id="LabelsCalc-823"><a href="#LabelsCalc-823"><span class="linenos"> 823</span></a>
</span><span id="LabelsCalc-824"><a href="#LabelsCalc-824"><span class="linenos"> 824</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-825"><a href="#LabelsCalc-825"><span class="linenos"> 825</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-826"><a href="#LabelsCalc-826"><span class="linenos"> 826</span></a><span class="sd">        txt_to_add : str</span>
</span><span id="LabelsCalc-827"><a href="#LabelsCalc-827"><span class="linenos"> 827</span></a><span class="sd">            Text to be added to the PDF document.</span>
</span><span id="LabelsCalc-828"><a href="#LabelsCalc-828"><span class="linenos"> 828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-829"><a href="#LabelsCalc-829"><span class="linenos"> 829</span></a>
</span><span id="LabelsCalc-830"><a href="#LabelsCalc-830"><span class="linenos"> 830</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">txt_to_add</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-831"><a href="#LabelsCalc-831"><span class="linenos"> 831</span></a>
</span><span id="LabelsCalc-832"><a href="#LabelsCalc-832"><span class="linenos"> 832</span></a>
</span><span id="LabelsCalc-833"><a href="#LabelsCalc-833"><span class="linenos"> 833</span></a>    <span class="k">def</span> <span class="nf">_add_pdf_plot</span><span class="p">(</span>
</span><span id="LabelsCalc-834"><a href="#LabelsCalc-834"><span class="linenos"> 834</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LabelsCalc-835"><a href="#LabelsCalc-835"><span class="linenos"> 835</span></a>        <span class="n">plot_obj</span><span class="p">:</span> <span class="n">BytesIO</span><span class="p">,</span>
</span><span id="LabelsCalc-836"><a href="#LabelsCalc-836"><span class="linenos"> 836</span></a>        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="LabelsCalc-837"><a href="#LabelsCalc-837"><span class="linenos"> 837</span></a>        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="LabelsCalc-838"><a href="#LabelsCalc-838"><span class="linenos"> 838</span></a>        <span class="n">x_position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="LabelsCalc-839"><a href="#LabelsCalc-839"><span class="linenos"> 839</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LabelsCalc-840"><a href="#LabelsCalc-840"><span class="linenos"> 840</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-841"><a href="#LabelsCalc-841"><span class="linenos"> 841</span></a><span class="sd">        Add a plot to the PDF.</span>
</span><span id="LabelsCalc-842"><a href="#LabelsCalc-842"><span class="linenos"> 842</span></a>
</span><span id="LabelsCalc-843"><a href="#LabelsCalc-843"><span class="linenos"> 843</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-844"><a href="#LabelsCalc-844"><span class="linenos"> 844</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-845"><a href="#LabelsCalc-845"><span class="linenos"> 845</span></a><span class="sd">        plot_obj : BytesIO</span>
</span><span id="LabelsCalc-846"><a href="#LabelsCalc-846"><span class="linenos"> 846</span></a><span class="sd">            A BytesIO object containing the plot image.</span>
</span><span id="LabelsCalc-847"><a href="#LabelsCalc-847"><span class="linenos"> 847</span></a><span class="sd">        image_width : int</span>
</span><span id="LabelsCalc-848"><a href="#LabelsCalc-848"><span class="linenos"> 848</span></a><span class="sd">            Width of the plot in the PDF.</span>
</span><span id="LabelsCalc-849"><a href="#LabelsCalc-849"><span class="linenos"> 849</span></a><span class="sd">        image_height : int</span>
</span><span id="LabelsCalc-850"><a href="#LabelsCalc-850"><span class="linenos"> 850</span></a><span class="sd">            Height of the plot in the PDF.</span>
</span><span id="LabelsCalc-851"><a href="#LabelsCalc-851"><span class="linenos"> 851</span></a><span class="sd">        x_position : int, optional</span>
</span><span id="LabelsCalc-852"><a href="#LabelsCalc-852"><span class="linenos"> 852</span></a><span class="sd">            X-coordinate position of the plot, by default 10.</span>
</span><span id="LabelsCalc-853"><a href="#LabelsCalc-853"><span class="linenos"> 853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-854"><a href="#LabelsCalc-854"><span class="linenos"> 854</span></a>
</span><span id="LabelsCalc-855"><a href="#LabelsCalc-855"><span class="linenos"> 855</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-856"><a href="#LabelsCalc-856"><span class="linenos"> 856</span></a>            <span class="n">y_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
</span><span id="LabelsCalc-857"><a href="#LabelsCalc-857"><span class="linenos"> 857</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">image</span><span class="p">(</span>
</span><span id="LabelsCalc-858"><a href="#LabelsCalc-858"><span class="linenos"> 858</span></a>                <span class="n">plot_obj</span><span class="p">,</span>
</span><span id="LabelsCalc-859"><a href="#LabelsCalc-859"><span class="linenos"> 859</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">x_position</span><span class="p">,</span>
</span><span id="LabelsCalc-860"><a href="#LabelsCalc-860"><span class="linenos"> 860</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">y_position</span><span class="p">,</span>
</span><span id="LabelsCalc-861"><a href="#LabelsCalc-861"><span class="linenos"> 861</span></a>                <span class="n">w</span><span class="o">=</span><span class="n">image_width</span><span class="p">,</span>
</span><span id="LabelsCalc-862"><a href="#LabelsCalc-862"><span class="linenos"> 862</span></a>                <span class="n">h</span><span class="o">=</span><span class="n">image_height</span>
</span><span id="LabelsCalc-863"><a href="#LabelsCalc-863"><span class="linenos"> 863</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-864"><a href="#LabelsCalc-864"><span class="linenos"> 864</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">y_position</span> <span class="o">+</span> <span class="n">image_height</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="LabelsCalc-865"><a href="#LabelsCalc-865"><span class="linenos"> 865</span></a>            <span class="n">plot_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="LabelsCalc-866"><a href="#LabelsCalc-866"><span class="linenos"> 866</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-867"><a href="#LabelsCalc-867"><span class="linenos"> 867</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to add plot to PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-868"><a href="#LabelsCalc-868"><span class="linenos"> 868</span></a>
</span><span id="LabelsCalc-869"><a href="#LabelsCalc-869"><span class="linenos"> 869</span></a>
</span><span id="LabelsCalc-870"><a href="#LabelsCalc-870"><span class="linenos"> 870</span></a>    <span class="k">def</span> <span class="nf">_compute_intervals</span><span class="p">(</span>
</span><span id="LabelsCalc-871"><a href="#LabelsCalc-871"><span class="linenos"> 871</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">max_time_between</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span>
</span><span id="LabelsCalc-872"><a href="#LabelsCalc-872"><span class="linenos"> 872</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="LabelsCalc-873"><a href="#LabelsCalc-873"><span class="linenos"> 873</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-874"><a href="#LabelsCalc-874"><span class="linenos"> 874</span></a><span class="sd">        Compute stop and move intervals based on labels and timestamps.</span>
</span><span id="LabelsCalc-875"><a href="#LabelsCalc-875"><span class="linenos"> 875</span></a>
</span><span id="LabelsCalc-876"><a href="#LabelsCalc-876"><span class="linenos"> 876</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-877"><a href="#LabelsCalc-877"><span class="linenos"> 877</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-878"><a href="#LabelsCalc-878"><span class="linenos"> 878</span></a><span class="sd">        labels : np.ndarray</span>
</span><span id="LabelsCalc-879"><a href="#LabelsCalc-879"><span class="linenos"> 879</span></a><span class="sd">            Array of labels assigned to data points (e.g., stops or moves).</span>
</span><span id="LabelsCalc-880"><a href="#LabelsCalc-880"><span class="linenos"> 880</span></a><span class="sd">        times : np.ndarray</span>
</span><span id="LabelsCalc-881"><a href="#LabelsCalc-881"><span class="linenos"> 881</span></a><span class="sd">            Array of timestamps corresponding to the labels.</span>
</span><span id="LabelsCalc-882"><a href="#LabelsCalc-882"><span class="linenos"> 882</span></a><span class="sd">        max_time_between : int, optional</span>
</span><span id="LabelsCalc-883"><a href="#LabelsCalc-883"><span class="linenos"> 883</span></a><span class="sd">            Maximum allowable time (in seconds) between consecutive points,</span>
</span><span id="LabelsCalc-884"><a href="#LabelsCalc-884"><span class="linenos"> 884</span></a><span class="sd">            by default 86400.</span>
</span><span id="LabelsCalc-885"><a href="#LabelsCalc-885"><span class="linenos"> 885</span></a>
</span><span id="LabelsCalc-886"><a href="#LabelsCalc-886"><span class="linenos"> 886</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-887"><a href="#LabelsCalc-887"><span class="linenos"> 887</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-888"><a href="#LabelsCalc-888"><span class="linenos"> 888</span></a><span class="sd">        list : A list of intervals with columns: label, start_time, end_time,</span>
</span><span id="LabelsCalc-889"><a href="#LabelsCalc-889"><span class="linenos"> 889</span></a><span class="sd">            latitude, longitude.</span>
</span><span id="LabelsCalc-890"><a href="#LabelsCalc-890"><span class="linenos"> 890</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-891"><a href="#LabelsCalc-891"><span class="linenos"> 891</span></a>
</span><span id="LabelsCalc-892"><a href="#LabelsCalc-892"><span class="linenos"> 892</span></a>        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">times</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-893"><a href="#LabelsCalc-893"><span class="linenos"> 893</span></a>        <span class="n">final_trajectory</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LabelsCalc-894"><a href="#LabelsCalc-894"><span class="linenos"> 894</span></a>
</span><span id="LabelsCalc-895"><a href="#LabelsCalc-895"><span class="linenos"> 895</span></a>        <span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LabelsCalc-896"><a href="#LabelsCalc-896"><span class="linenos"> 896</span></a>        <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_start</span>
</span><span id="LabelsCalc-897"><a href="#LabelsCalc-897"><span class="linenos"> 897</span></a>
</span><span id="LabelsCalc-898"><a href="#LabelsCalc-898"><span class="linenos"> 898</span></a>        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="LabelsCalc-899"><a href="#LabelsCalc-899"><span class="linenos"> 899</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">loc</span> <span class="o">==</span> <span class="n">loc_prev</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_time_between</span><span class="p">:</span>
</span><span id="LabelsCalc-900"><a href="#LabelsCalc-900"><span class="linenos"> 900</span></a>                <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="LabelsCalc-901"><a href="#LabelsCalc-901"><span class="linenos"> 901</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LabelsCalc-902"><a href="#LabelsCalc-902"><span class="linenos"> 902</span></a>                <span class="n">final_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">])</span>
</span><span id="LabelsCalc-903"><a href="#LabelsCalc-903"><span class="linenos"> 903</span></a>                <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="LabelsCalc-904"><a href="#LabelsCalc-904"><span class="linenos"> 904</span></a>                <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="LabelsCalc-905"><a href="#LabelsCalc-905"><span class="linenos"> 905</span></a>            <span class="n">loc_prev</span> <span class="o">=</span> <span class="n">loc</span>
</span><span id="LabelsCalc-906"><a href="#LabelsCalc-906"><span class="linenos"> 906</span></a>        <span class="k">if</span> <span class="n">loc_prev</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="LabelsCalc-907"><a href="#LabelsCalc-907"><span class="linenos"> 907</span></a>            <span class="n">final_trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">loc_prev</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">])</span>
</span><span id="LabelsCalc-908"><a href="#LabelsCalc-908"><span class="linenos"> 908</span></a>
</span><span id="LabelsCalc-909"><a href="#LabelsCalc-909"><span class="linenos"> 909</span></a>        <span class="k">return</span> <span class="n">final_trajectory</span>
</span><span id="LabelsCalc-910"><a href="#LabelsCalc-910"><span class="linenos"> 910</span></a>
</span><span id="LabelsCalc-911"><a href="#LabelsCalc-911"><span class="linenos"> 911</span></a>
</span><span id="LabelsCalc-912"><a href="#LabelsCalc-912"><span class="linenos"> 912</span></a>    <span class="k">def</span> <span class="nf">_process_combination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="LabelsCalc-913"><a href="#LabelsCalc-913"><span class="linenos"> 913</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-914"><a href="#LabelsCalc-914"><span class="linenos"> 914</span></a><span class="sd">        Process a single combination of parameters and compute trajectories.</span>
</span><span id="LabelsCalc-915"><a href="#LabelsCalc-915"><span class="linenos"> 915</span></a>
</span><span id="LabelsCalc-916"><a href="#LabelsCalc-916"><span class="linenos"> 916</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-917"><a href="#LabelsCalc-917"><span class="linenos"> 917</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-918"><a href="#LabelsCalc-918"><span class="linenos"> 918</span></a><span class="sd">        args : Tuple</span>
</span><span id="LabelsCalc-919"><a href="#LabelsCalc-919"><span class="linenos"> 919</span></a><span class="sd">            A tuple containing user_id, group, r1, r2, and min_staying_time.</span>
</span><span id="LabelsCalc-920"><a href="#LabelsCalc-920"><span class="linenos"> 920</span></a>
</span><span id="LabelsCalc-921"><a href="#LabelsCalc-921"><span class="linenos"> 921</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-922"><a href="#LabelsCalc-922"><span class="linenos"> 922</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-923"><a href="#LabelsCalc-923"><span class="linenos"> 923</span></a><span class="sd">        dict : Results containing user ID, trajectories, and parameter values.</span>
</span><span id="LabelsCalc-924"><a href="#LabelsCalc-924"><span class="linenos"> 924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-925"><a href="#LabelsCalc-925"><span class="linenos"> 925</span></a>
</span><span id="LabelsCalc-926"><a href="#LabelsCalc-926"><span class="linenos"> 926</span></a>        <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="LabelsCalc-927"><a href="#LabelsCalc-927"><span class="linenos"> 927</span></a>
</span><span id="LabelsCalc-928"><a href="#LabelsCalc-928"><span class="linenos"> 928</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-929"><a href="#LabelsCalc-929"><span class="linenos"> 929</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-930"><a href="#LabelsCalc-930"><span class="linenos"> 930</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-931"><a href="#LabelsCalc-931"><span class="linenos"> 931</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="LabelsCalc-932"><a href="#LabelsCalc-932"><span class="linenos"> 932</span></a>                <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="LabelsCalc-933"><a href="#LabelsCalc-933"><span class="linenos"> 933</span></a>                <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="LabelsCalc-934"><a href="#LabelsCalc-934"><span class="linenos"> 934</span></a>                <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LabelsCalc-935"><a href="#LabelsCalc-935"><span class="linenos"> 935</span></a>                <span class="n">min_staying_time</span><span class="o">=</span><span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="LabelsCalc-936"><a href="#LabelsCalc-936"><span class="linenos"> 936</span></a>                <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="LabelsCalc-937"><a href="#LabelsCalc-937"><span class="linenos"> 937</span></a>                <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="LabelsCalc-938"><a href="#LabelsCalc-938"><span class="linenos"> 938</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-939"><a href="#LabelsCalc-939"><span class="linenos"> 939</span></a>
</span><span id="LabelsCalc-940"><a href="#LabelsCalc-940"><span class="linenos"> 940</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc-941"><a href="#LabelsCalc-941"><span class="linenos"> 941</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_intervals</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc-942"><a href="#LabelsCalc-942"><span class="linenos"> 942</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="LabelsCalc-943"><a href="#LabelsCalc-943"><span class="linenos"> 943</span></a>                <span class="n">trajectory</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="LabelsCalc-944"><a href="#LabelsCalc-944"><span class="linenos"> 944</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-945"><a href="#LabelsCalc-945"><span class="linenos"> 945</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LabelsCalc-946"><a href="#LabelsCalc-946"><span class="linenos"> 946</span></a>
</span><span id="LabelsCalc-947"><a href="#LabelsCalc-947"><span class="linenos"> 947</span></a>            <span class="n">pts</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-948"><a href="#LabelsCalc-948"><span class="linenos"> 948</span></a>            <span class="n">lbls</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-949"><a href="#LabelsCalc-949"><span class="linenos"> 949</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lbls</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lbls</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
</span><span id="LabelsCalc-950"><a href="#LabelsCalc-950"><span class="linenos"> 950</span></a>                <span class="n">silhouette</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="LabelsCalc-951"><a href="#LabelsCalc-951"><span class="linenos"> 951</span></a>                <span class="n">calinski</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LabelsCalc-952"><a href="#LabelsCalc-952"><span class="linenos"> 952</span></a>                <span class="n">davies_bouldin</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="LabelsCalc-953"><a href="#LabelsCalc-953"><span class="linenos"> 953</span></a>
</span><span id="LabelsCalc-954"><a href="#LabelsCalc-954"><span class="linenos"> 954</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LabelsCalc-955"><a href="#LabelsCalc-955"><span class="linenos"> 955</span></a>                <span class="n">silhouette</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="LabelsCalc-956"><a href="#LabelsCalc-956"><span class="linenos"> 956</span></a>                <span class="n">calinski</span> <span class="o">=</span> <span class="n">calinski_harabasz_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="LabelsCalc-957"><a href="#LabelsCalc-957"><span class="linenos"> 957</span></a>                <span class="n">davies_bouldin</span> <span class="o">=</span> <span class="n">davies_bouldin_score</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">lbls</span><span class="p">)</span>
</span><span id="LabelsCalc-958"><a href="#LabelsCalc-958"><span class="linenos"> 958</span></a>
</span><span id="LabelsCalc-959"><a href="#LabelsCalc-959"><span class="linenos"> 959</span></a>
</span><span id="LabelsCalc-960"><a href="#LabelsCalc-960"><span class="linenos"> 960</span></a>            <span class="n">total_stops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="LabelsCalc-961"><a href="#LabelsCalc-961"><span class="linenos"> 961</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LabelsCalc-962"><a href="#LabelsCalc-962"><span class="linenos"> 962</span></a>                <span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="LabelsCalc-963"><a href="#LabelsCalc-963"><span class="linenos"> 963</span></a>                <span class="s2">&quot;Trajectory&quot;</span><span class="p">:</span> <span class="n">trajectory</span><span class="p">,</span>
</span><span id="LabelsCalc-964"><a href="#LabelsCalc-964"><span class="linenos"> 964</span></a>                <span class="s2">&quot;Total_stops&quot;</span><span class="p">:</span> <span class="n">total_stops</span><span class="p">,</span>
</span><span id="LabelsCalc-965"><a href="#LabelsCalc-965"><span class="linenos"> 965</span></a>                <span class="s2">&quot;R1&quot;</span><span class="p">:</span> <span class="n">r1</span><span class="p">,</span>
</span><span id="LabelsCalc-966"><a href="#LabelsCalc-966"><span class="linenos"> 966</span></a>                <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
</span><span id="LabelsCalc-967"><a href="#LabelsCalc-967"><span class="linenos"> 967</span></a>                <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span> <span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="LabelsCalc-968"><a href="#LabelsCalc-968"><span class="linenos"> 968</span></a>                <span class="s1">&#39;SHTT&#39;</span><span class="p">:</span><span class="n">silhouette</span><span class="p">,</span>
</span><span id="LabelsCalc-969"><a href="#LabelsCalc-969"><span class="linenos"> 969</span></a>                <span class="s1">&#39;CH&#39;</span><span class="p">:</span> <span class="n">calinski</span><span class="p">,</span>
</span><span id="LabelsCalc-970"><a href="#LabelsCalc-970"><span class="linenos"> 970</span></a>                <span class="s1">&#39;DB&#39;</span><span class="p">:</span><span class="n">davies_bouldin</span>
</span><span id="LabelsCalc-971"><a href="#LabelsCalc-971"><span class="linenos"> 971</span></a>            <span class="p">}</span>
</span><span id="LabelsCalc-972"><a href="#LabelsCalc-972"><span class="linenos"> 972</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="LabelsCalc-973"><a href="#LabelsCalc-973"><span class="linenos"> 973</span></a>
</span><span id="LabelsCalc-974"><a href="#LabelsCalc-974"><span class="linenos"> 974</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-975"><a href="#LabelsCalc-975"><span class="linenos"> 975</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing user </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-976"><a href="#LabelsCalc-976"><span class="linenos"> 976</span></a>
</span><span id="LabelsCalc-977"><a href="#LabelsCalc-977"><span class="linenos"> 977</span></a>
</span><span id="LabelsCalc-978"><a href="#LabelsCalc-978"><span class="linenos"> 978</span></a>    <span class="k">def</span> <span class="nf">_calc_params_matrix_parallel</span><span class="p">(</span>
</span><span id="LabelsCalc-979"><a href="#LabelsCalc-979"><span class="linenos"> 979</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="LabelsCalc-980"><a href="#LabelsCalc-980"><span class="linenos"> 980</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="LabelsCalc-981"><a href="#LabelsCalc-981"><span class="linenos"> 981</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-982"><a href="#LabelsCalc-982"><span class="linenos"> 982</span></a><span class="sd">        Calculate the parameter sensitivity matrix using parallel processing.</span>
</span><span id="LabelsCalc-983"><a href="#LabelsCalc-983"><span class="linenos"> 983</span></a>
</span><span id="LabelsCalc-984"><a href="#LabelsCalc-984"><span class="linenos"> 984</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-985"><a href="#LabelsCalc-985"><span class="linenos"> 985</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-986"><a href="#LabelsCalc-986"><span class="linenos"> 986</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc-987"><a href="#LabelsCalc-987"><span class="linenos"> 987</span></a><span class="sd">            Input trajectory data grouped by user ID.</span>
</span><span id="LabelsCalc-988"><a href="#LabelsCalc-988"><span class="linenos"> 988</span></a>
</span><span id="LabelsCalc-989"><a href="#LabelsCalc-989"><span class="linenos"> 989</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-990"><a href="#LabelsCalc-990"><span class="linenos"> 990</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-991"><a href="#LabelsCalc-991"><span class="linenos"> 991</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LabelsCalc-992"><a href="#LabelsCalc-992"><span class="linenos"> 992</span></a><span class="sd">            A DataFrame with sensitivity analysis results.</span>
</span><span id="LabelsCalc-993"><a href="#LabelsCalc-993"><span class="linenos"> 993</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-994"><a href="#LabelsCalc-994"><span class="linenos"> 994</span></a>
</span><span id="LabelsCalc-995"><a href="#LabelsCalc-995"><span class="linenos"> 995</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-996"><a href="#LabelsCalc-996"><span class="linenos"> 996</span></a>            <span class="n">rs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="LabelsCalc-997"><a href="#LabelsCalc-997"><span class="linenos"> 997</span></a>            <span class="n">rs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="LabelsCalc-998"><a href="#LabelsCalc-998"><span class="linenos"> 998</span></a>            <span class="n">min_staying_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span>
</span><span id="LabelsCalc-999"><a href="#LabelsCalc-999"><span class="linenos"> 999</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
</span><span id="LabelsCalc-1000"><a href="#LabelsCalc-1000"><span class="linenos">1000</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7200</span><span class="p">),</span>
</span><span id="LabelsCalc-1001"><a href="#LabelsCalc-1001"><span class="linenos">1001</span></a>                <span class="n">num</span><span class="o">=</span><span class="mi">20</span>
</span><span id="LabelsCalc-1002"><a href="#LabelsCalc-1002"><span class="linenos">1002</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1003"><a href="#LabelsCalc-1003"><span class="linenos">1003</span></a>
</span><span id="LabelsCalc-1004"><a href="#LabelsCalc-1004"><span class="linenos">1004</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LabelsCalc-1005"><a href="#LabelsCalc-1005"><span class="linenos">1005</span></a>            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1006"><a href="#LabelsCalc-1006"><span class="linenos">1006</span></a>                <span class="k">for</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="LabelsCalc-1007"><a href="#LabelsCalc-1007"><span class="linenos">1007</span></a>                    <span class="n">rs1</span><span class="p">,</span>
</span><span id="LabelsCalc-1008"><a href="#LabelsCalc-1008"><span class="linenos">1008</span></a>                    <span class="n">rs2</span><span class="p">,</span>
</span><span id="LabelsCalc-1009"><a href="#LabelsCalc-1009"><span class="linenos">1009</span></a>                    <span class="n">min_staying_times</span>
</span><span id="LabelsCalc-1010"><a href="#LabelsCalc-1010"><span class="linenos">1010</span></a>                <span class="p">):</span>
</span><span id="LabelsCalc-1011"><a href="#LabelsCalc-1011"><span class="linenos">1011</span></a>                    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">user_id</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">min_staying_time</span><span class="p">))</span>
</span><span id="LabelsCalc-1012"><a href="#LabelsCalc-1012"><span class="linenos">1012</span></a>
</span><span id="LabelsCalc-1013"><a href="#LabelsCalc-1013"><span class="linenos">1013</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span><span id="LabelsCalc-1014"><a href="#LabelsCalc-1014"><span class="linenos">1014</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="LabelsCalc-1015"><a href="#LabelsCalc-1015"><span class="linenos">1015</span></a>                    <span class="n">tqdm</span><span class="p">(</span>
</span><span id="LabelsCalc-1016"><a href="#LabelsCalc-1016"><span class="linenos">1016</span></a>                        <span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
</span><span id="LabelsCalc-1017"><a href="#LabelsCalc-1017"><span class="linenos">1017</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_process_combination</span><span class="p">,</span>
</span><span id="LabelsCalc-1018"><a href="#LabelsCalc-1018"><span class="linenos">1018</span></a>                            <span class="n">tasks</span>
</span><span id="LabelsCalc-1019"><a href="#LabelsCalc-1019"><span class="linenos">1019</span></a>                        <span class="p">),</span>
</span><span id="LabelsCalc-1020"><a href="#LabelsCalc-1020"><span class="linenos">1020</span></a>                        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="LabelsCalc-1021"><a href="#LabelsCalc-1021"><span class="linenos">1021</span></a>                    <span class="p">)</span>
</span><span id="LabelsCalc-1022"><a href="#LabelsCalc-1022"><span class="linenos">1022</span></a>                <span class="p">)</span>
</span><span id="LabelsCalc-1023"><a href="#LabelsCalc-1023"><span class="linenos">1023</span></a>
</span><span id="LabelsCalc-1024"><a href="#LabelsCalc-1024"><span class="linenos">1024</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="LabelsCalc-1025"><a href="#LabelsCalc-1025"><span class="linenos">1025</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-1026"><a href="#LabelsCalc-1026"><span class="linenos">1026</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating parameter matrix in &quot;</span>
</span><span id="LabelsCalc-1027"><a href="#LabelsCalc-1027"><span class="linenos">1027</span></a>                               <span class="sa">f</span><span class="s2">&quot;parallel: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1028"><a href="#LabelsCalc-1028"><span class="linenos">1028</span></a>
</span><span id="LabelsCalc-1029"><a href="#LabelsCalc-1029"><span class="linenos">1029</span></a>
</span><span id="LabelsCalc-1030"><a href="#LabelsCalc-1030"><span class="linenos">1030</span></a>    <span class="k">def</span> <span class="nf">_calc_params_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="LabelsCalc-1031"><a href="#LabelsCalc-1031"><span class="linenos">1031</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1032"><a href="#LabelsCalc-1032"><span class="linenos">1032</span></a><span class="sd">        Calculate the parameter sensitivity matrix.</span>
</span><span id="LabelsCalc-1033"><a href="#LabelsCalc-1033"><span class="linenos">1033</span></a>
</span><span id="LabelsCalc-1034"><a href="#LabelsCalc-1034"><span class="linenos">1034</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1035"><a href="#LabelsCalc-1035"><span class="linenos">1035</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1036"><a href="#LabelsCalc-1036"><span class="linenos">1036</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc-1037"><a href="#LabelsCalc-1037"><span class="linenos">1037</span></a><span class="sd">            Input trajectory data grouped by user ID.</span>
</span><span id="LabelsCalc-1038"><a href="#LabelsCalc-1038"><span class="linenos">1038</span></a>
</span><span id="LabelsCalc-1039"><a href="#LabelsCalc-1039"><span class="linenos">1039</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1040"><a href="#LabelsCalc-1040"><span class="linenos">1040</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1041"><a href="#LabelsCalc-1041"><span class="linenos">1041</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LabelsCalc-1042"><a href="#LabelsCalc-1042"><span class="linenos">1042</span></a><span class="sd">            A DataFrame with sensitivity analysis results.</span>
</span><span id="LabelsCalc-1043"><a href="#LabelsCalc-1043"><span class="linenos">1043</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1044"><a href="#LabelsCalc-1044"><span class="linenos">1044</span></a>
</span><span id="LabelsCalc-1045"><a href="#LabelsCalc-1045"><span class="linenos">1045</span></a>        <span class="n">rs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="LabelsCalc-1046"><a href="#LabelsCalc-1046"><span class="linenos">1046</span></a>        <span class="n">rs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span id="LabelsCalc-1047"><a href="#LabelsCalc-1047"><span class="linenos">1047</span></a>        <span class="n">min_staying_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">7200</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="LabelsCalc-1048"><a href="#LabelsCalc-1048"><span class="linenos">1048</span></a>
</span><span id="LabelsCalc-1049"><a href="#LabelsCalc-1049"><span class="linenos">1049</span></a>        <span class="n">dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LabelsCalc-1050"><a href="#LabelsCalc-1050"><span class="linenos">1050</span></a>        <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1051"><a href="#LabelsCalc-1051"><span class="linenos">1051</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1052"><a href="#LabelsCalc-1052"><span class="linenos">1052</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-1053"><a href="#LabelsCalc-1053"><span class="linenos">1053</span></a>            <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="n">rs1</span><span class="p">:</span>
</span><span id="LabelsCalc-1054"><a href="#LabelsCalc-1054"><span class="linenos">1054</span></a>                <span class="k">for</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">rs2</span><span class="p">:</span>
</span><span id="LabelsCalc-1055"><a href="#LabelsCalc-1055"><span class="linenos">1055</span></a>                    <span class="k">for</span> <span class="n">min_staying_time</span> <span class="ow">in</span> <span class="n">min_staying_times</span><span class="p">:</span>
</span><span id="LabelsCalc-1056"><a href="#LabelsCalc-1056"><span class="linenos">1056</span></a>                        <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="LabelsCalc-1057"><a href="#LabelsCalc-1057"><span class="linenos">1057</span></a>                            <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="LabelsCalc-1058"><a href="#LabelsCalc-1058"><span class="linenos">1058</span></a>                            <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="LabelsCalc-1059"><a href="#LabelsCalc-1059"><span class="linenos">1059</span></a>                            <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LabelsCalc-1060"><a href="#LabelsCalc-1060"><span class="linenos">1060</span></a>                            <span class="n">min_staying_time</span><span class="o">=</span><span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="LabelsCalc-1061"><a href="#LabelsCalc-1061"><span class="linenos">1061</span></a>                            <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="LabelsCalc-1062"><a href="#LabelsCalc-1062"><span class="linenos">1062</span></a>                            <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="LabelsCalc-1063"><a href="#LabelsCalc-1063"><span class="linenos">1063</span></a>                        <span class="p">)</span>
</span><span id="LabelsCalc-1064"><a href="#LabelsCalc-1064"><span class="linenos">1064</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-1065"><a href="#LabelsCalc-1065"><span class="linenos">1065</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc-1066"><a href="#LabelsCalc-1066"><span class="linenos">1066</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_intervals</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1067"><a href="#LabelsCalc-1067"><span class="linenos">1067</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="LabelsCalc-1068"><a href="#LabelsCalc-1068"><span class="linenos">1068</span></a>                                <span class="n">trajectory</span><span class="p">,</span>
</span><span id="LabelsCalc-1069"><a href="#LabelsCalc-1069"><span class="linenos">1069</span></a>                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="LabelsCalc-1070"><a href="#LabelsCalc-1070"><span class="linenos">1070</span></a>                                    <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span>
</span><span id="LabelsCalc-1071"><a href="#LabelsCalc-1071"><span class="linenos">1071</span></a>                                <span class="p">],</span>
</span><span id="LabelsCalc-1072"><a href="#LabelsCalc-1072"><span class="linenos">1072</span></a>                            <span class="p">)</span>
</span><span id="LabelsCalc-1073"><a href="#LabelsCalc-1073"><span class="linenos">1073</span></a>                            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LabelsCalc-1074"><a href="#LabelsCalc-1074"><span class="linenos">1074</span></a>
</span><span id="LabelsCalc-1075"><a href="#LabelsCalc-1075"><span class="linenos">1075</span></a>                            <span class="n">total_stops</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="LabelsCalc-1076"><a href="#LabelsCalc-1076"><span class="linenos">1076</span></a>                            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LabelsCalc-1077"><a href="#LabelsCalc-1077"><span class="linenos">1077</span></a>                                <span class="s2">&quot;animal_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span><span id="LabelsCalc-1078"><a href="#LabelsCalc-1078"><span class="linenos">1078</span></a>                                <span class="s2">&quot;Trajectory&quot;</span><span class="p">:</span> <span class="n">trajectory</span><span class="p">,</span>
</span><span id="LabelsCalc-1079"><a href="#LabelsCalc-1079"><span class="linenos">1079</span></a>                                <span class="s2">&quot;Total_stops&quot;</span><span class="p">:</span> <span class="n">total_stops</span><span class="p">,</span>
</span><span id="LabelsCalc-1080"><a href="#LabelsCalc-1080"><span class="linenos">1080</span></a>                                <span class="s2">&quot;R1&quot;</span><span class="p">:</span> <span class="n">r1</span><span class="p">,</span>
</span><span id="LabelsCalc-1081"><a href="#LabelsCalc-1081"><span class="linenos">1081</span></a>                                <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2</span><span class="p">,</span>
</span><span id="LabelsCalc-1082"><a href="#LabelsCalc-1082"><span class="linenos">1082</span></a>                                <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span> <span class="n">min_staying_time</span><span class="p">,</span>
</span><span id="LabelsCalc-1083"><a href="#LabelsCalc-1083"><span class="linenos">1083</span></a>                            <span class="p">}</span>
</span><span id="LabelsCalc-1084"><a href="#LabelsCalc-1084"><span class="linenos">1084</span></a>                            <span class="n">dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="LabelsCalc-1085"><a href="#LabelsCalc-1085"><span class="linenos">1085</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-1086"><a href="#LabelsCalc-1086"><span class="linenos">1086</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1087"><a href="#LabelsCalc-1087"><span class="linenos">1087</span></a>
</span><span id="LabelsCalc-1088"><a href="#LabelsCalc-1088"><span class="linenos">1088</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dfs_list</span><span class="p">)</span>
</span><span id="LabelsCalc-1089"><a href="#LabelsCalc-1089"><span class="linenos">1089</span></a>
</span><span id="LabelsCalc-1090"><a href="#LabelsCalc-1090"><span class="linenos">1090</span></a>
</span><span id="LabelsCalc-1091"><a href="#LabelsCalc-1091"><span class="linenos">1091</span></a>    <span class="k">def</span> <span class="nf">_plot_param</span><span class="p">(</span>
</span><span id="LabelsCalc-1092"><a href="#LabelsCalc-1092"><span class="linenos">1092</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LabelsCalc-1093"><a href="#LabelsCalc-1093"><span class="linenos">1093</span></a>        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="LabelsCalc-1094"><a href="#LabelsCalc-1094"><span class="linenos">1094</span></a>        <span class="n">stabilization_point_index</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="LabelsCalc-1095"><a href="#LabelsCalc-1095"><span class="linenos">1095</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="LabelsCalc-1096"><a href="#LabelsCalc-1096"><span class="linenos">1096</span></a>        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="LabelsCalc-1097"><a href="#LabelsCalc-1097"><span class="linenos">1097</span></a>        <span class="n">dy_dx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="LabelsCalc-1098"><a href="#LabelsCalc-1098"><span class="linenos">1098</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="LabelsCalc-1099"><a href="#LabelsCalc-1099"><span class="linenos">1099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1100"><a href="#LabelsCalc-1100"><span class="linenos">1100</span></a><span class="sd">        Create and return a plot visualizing parameter sensitivity.</span>
</span><span id="LabelsCalc-1101"><a href="#LabelsCalc-1101"><span class="linenos">1101</span></a>
</span><span id="LabelsCalc-1102"><a href="#LabelsCalc-1102"><span class="linenos">1102</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1103"><a href="#LabelsCalc-1103"><span class="linenos">1103</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1104"><a href="#LabelsCalc-1104"><span class="linenos">1104</span></a><span class="sd">        param : str</span>
</span><span id="LabelsCalc-1105"><a href="#LabelsCalc-1105"><span class="linenos">1105</span></a><span class="sd">            The parameter being analyzed.</span>
</span><span id="LabelsCalc-1106"><a href="#LabelsCalc-1106"><span class="linenos">1106</span></a><span class="sd">        stabilization_point_index : float</span>
</span><span id="LabelsCalc-1107"><a href="#LabelsCalc-1107"><span class="linenos">1107</span></a><span class="sd">            The selected stabilization point for the parameter.</span>
</span><span id="LabelsCalc-1108"><a href="#LabelsCalc-1108"><span class="linenos">1108</span></a><span class="sd">        x : np.ndarray</span>
</span><span id="LabelsCalc-1109"><a href="#LabelsCalc-1109"><span class="linenos">1109</span></a><span class="sd">            X-axis values (parameter values).</span>
</span><span id="LabelsCalc-1110"><a href="#LabelsCalc-1110"><span class="linenos">1110</span></a><span class="sd">        y : np.ndarray</span>
</span><span id="LabelsCalc-1111"><a href="#LabelsCalc-1111"><span class="linenos">1111</span></a><span class="sd">            Y-axis values (total stops).</span>
</span><span id="LabelsCalc-1112"><a href="#LabelsCalc-1112"><span class="linenos">1112</span></a><span class="sd">        dy_dx : np.ndarray</span>
</span><span id="LabelsCalc-1113"><a href="#LabelsCalc-1113"><span class="linenos">1113</span></a><span class="sd">            Change in total stops with respect to the parameter.</span>
</span><span id="LabelsCalc-1114"><a href="#LabelsCalc-1114"><span class="linenos">1114</span></a>
</span><span id="LabelsCalc-1115"><a href="#LabelsCalc-1115"><span class="linenos">1115</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1116"><a href="#LabelsCalc-1116"><span class="linenos">1116</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1117"><a href="#LabelsCalc-1117"><span class="linenos">1117</span></a><span class="sd">        BytesIO</span>
</span><span id="LabelsCalc-1118"><a href="#LabelsCalc-1118"><span class="linenos">1118</span></a><span class="sd">            A BytesIO object containing the plot image.</span>
</span><span id="LabelsCalc-1119"><a href="#LabelsCalc-1119"><span class="linenos">1119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1120"><a href="#LabelsCalc-1120"><span class="linenos">1120</span></a>
</span><span id="LabelsCalc-1121"><a href="#LabelsCalc-1121"><span class="linenos">1121</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span><span id="LabelsCalc-1122"><a href="#LabelsCalc-1122"><span class="linenos">1122</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="LabelsCalc-1123"><a href="#LabelsCalc-1123"><span class="linenos">1123</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
</span><span id="LabelsCalc-1124"><a href="#LabelsCalc-1124"><span class="linenos">1124</span></a>            <span class="n">stabilization_point_index</span><span class="p">,</span>
</span><span id="LabelsCalc-1125"><a href="#LabelsCalc-1125"><span class="linenos">1125</span></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="LabelsCalc-1126"><a href="#LabelsCalc-1126"><span class="linenos">1126</span></a>            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="LabelsCalc-1127"><a href="#LabelsCalc-1127"><span class="linenos">1127</span></a>            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Stable </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LabelsCalc-1128"><a href="#LabelsCalc-1128"><span class="linenos">1128</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1129"><a href="#LabelsCalc-1129"><span class="linenos">1129</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="LabelsCalc-1130"><a href="#LabelsCalc-1130"><span class="linenos">1130</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Total Stops&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1131"><a href="#LabelsCalc-1131"><span class="linenos">1131</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1132"><a href="#LabelsCalc-1132"><span class="linenos">1132</span></a>
</span><span id="LabelsCalc-1133"><a href="#LabelsCalc-1133"><span class="linenos">1133</span></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
</span><span id="LabelsCalc-1134"><a href="#LabelsCalc-1134"><span class="linenos">1134</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="LabelsCalc-1135"><a href="#LabelsCalc-1135"><span class="linenos">1135</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">dy_dx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span>
</span><span id="LabelsCalc-1136"><a href="#LabelsCalc-1136"><span class="linenos">1136</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1137"><a href="#LabelsCalc-1137"><span class="linenos">1137</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LabelsCalc-1138"><a href="#LabelsCalc-1138"><span class="linenos">1138</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1139"><a href="#LabelsCalc-1139"><span class="linenos">1139</span></a>
</span><span id="LabelsCalc-1140"><a href="#LabelsCalc-1140"><span class="linenos">1140</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median Total Stops by </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1141"><a href="#LabelsCalc-1141"><span class="linenos">1141</span></a>
</span><span id="LabelsCalc-1142"><a href="#LabelsCalc-1142"><span class="linenos">1142</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="LabelsCalc-1143"><a href="#LabelsCalc-1143"><span class="linenos">1143</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="LabelsCalc-1144"><a href="#LabelsCalc-1144"><span class="linenos">1144</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LabelsCalc-1145"><a href="#LabelsCalc-1145"><span class="linenos">1145</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="LabelsCalc-1146"><a href="#LabelsCalc-1146"><span class="linenos">1146</span></a>                <span class="sa">f</span><span class="s2">&quot;Median Total Stops by </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LabelsCalc-1147"><a href="#LabelsCalc-1147"><span class="linenos">1147</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1148"><a href="#LabelsCalc-1148"><span class="linenos">1148</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1149"><a href="#LabelsCalc-1149"><span class="linenos">1149</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1150"><a href="#LabelsCalc-1150"><span class="linenos">1150</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="LabelsCalc-1151"><a href="#LabelsCalc-1151"><span class="linenos">1151</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="LabelsCalc-1152"><a href="#LabelsCalc-1152"><span class="linenos">1152</span></a>
</span><span id="LabelsCalc-1153"><a href="#LabelsCalc-1153"><span class="linenos">1153</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="LabelsCalc-1154"><a href="#LabelsCalc-1154"><span class="linenos">1154</span></a>
</span><span id="LabelsCalc-1155"><a href="#LabelsCalc-1155"><span class="linenos">1155</span></a>
</span><span id="LabelsCalc-1156"><a href="#LabelsCalc-1156"><span class="linenos">1156</span></a>    <span class="k">def</span> <span class="nf">_choose_param_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="LabelsCalc-1157"><a href="#LabelsCalc-1157"><span class="linenos">1157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1158"><a href="#LabelsCalc-1158"><span class="linenos">1158</span></a><span class="sd">        Choose the optimal value for a given parameter based on</span>
</span><span id="LabelsCalc-1159"><a href="#LabelsCalc-1159"><span class="linenos">1159</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="LabelsCalc-1160"><a href="#LabelsCalc-1160"><span class="linenos">1160</span></a>
</span><span id="LabelsCalc-1161"><a href="#LabelsCalc-1161"><span class="linenos">1161</span></a><span class="sd">        The method identifies a stabilization point for the parameter,</span>
</span><span id="LabelsCalc-1162"><a href="#LabelsCalc-1162"><span class="linenos">1162</span></a><span class="sd">        where the total stops stabilize with minimal changes in the</span>
</span><span id="LabelsCalc-1163"><a href="#LabelsCalc-1163"><span class="linenos">1163</span></a><span class="sd">        corresponding value.</span>
</span><span id="LabelsCalc-1164"><a href="#LabelsCalc-1164"><span class="linenos">1164</span></a>
</span><span id="LabelsCalc-1165"><a href="#LabelsCalc-1165"><span class="linenos">1165</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1166"><a href="#LabelsCalc-1166"><span class="linenos">1166</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1167"><a href="#LabelsCalc-1167"><span class="linenos">1167</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc-1168"><a href="#LabelsCalc-1168"><span class="linenos">1168</span></a><span class="sd">            The data containing the results of parameter sensitivity.</span>
</span><span id="LabelsCalc-1169"><a href="#LabelsCalc-1169"><span class="linenos">1169</span></a><span class="sd">        param : str</span>
</span><span id="LabelsCalc-1170"><a href="#LabelsCalc-1170"><span class="linenos">1170</span></a><span class="sd">            The parameter to optimize. Should be one of [&quot;R1&quot;, &quot;Tmin&quot;].</span>
</span><span id="LabelsCalc-1171"><a href="#LabelsCalc-1171"><span class="linenos">1171</span></a>
</span><span id="LabelsCalc-1172"><a href="#LabelsCalc-1172"><span class="linenos">1172</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1173"><a href="#LabelsCalc-1173"><span class="linenos">1173</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1174"><a href="#LabelsCalc-1174"><span class="linenos">1174</span></a><span class="sd">        float</span>
</span><span id="LabelsCalc-1175"><a href="#LabelsCalc-1175"><span class="linenos">1175</span></a><span class="sd">            The selected optimal parameter value based on</span>
</span><span id="LabelsCalc-1176"><a href="#LabelsCalc-1176"><span class="linenos">1176</span></a><span class="sd">            the stabilization point.</span>
</span><span id="LabelsCalc-1177"><a href="#LabelsCalc-1177"><span class="linenos">1177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1178"><a href="#LabelsCalc-1178"><span class="linenos">1178</span></a>
</span><span id="LabelsCalc-1179"><a href="#LabelsCalc-1179"><span class="linenos">1179</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;R1&quot;</span><span class="p">:</span>
</span><span id="LabelsCalc-1180"><a href="#LabelsCalc-1180"><span class="linenos">1180</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">R1_MIN</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;R1&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">R1_MAX</span><span class="p">)]</span>
</span><span id="LabelsCalc-1181"><a href="#LabelsCalc-1181"><span class="linenos">1181</span></a>        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;Tmin&quot;</span><span class="p">:</span>
</span><span id="LabelsCalc-1182"><a href="#LabelsCalc-1182"><span class="linenos">1182</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Tmin&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TMIN_MIN</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Tmin&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">TMIN_MAX</span><span class="p">)]</span>
</span><span id="LabelsCalc-1183"><a href="#LabelsCalc-1183"><span class="linenos">1183</span></a>
</span><span id="LabelsCalc-1184"><a href="#LabelsCalc-1184"><span class="linenos">1184</span></a>        <span class="n">result_med</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1185"><a href="#LabelsCalc-1185"><span class="linenos">1185</span></a>        <span class="n">result_med_agg</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="LabelsCalc-1186"><a href="#LabelsCalc-1186"><span class="linenos">1186</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="LabelsCalc-1187"><a href="#LabelsCalc-1187"><span class="linenos">1187</span></a>        <span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1188"><a href="#LabelsCalc-1188"><span class="linenos">1188</span></a>
</span><span id="LabelsCalc-1189"><a href="#LabelsCalc-1189"><span class="linenos">1189</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">result_med_agg</span><span class="o">.</span><span class="n">index</span>
</span><span id="LabelsCalc-1190"><a href="#LabelsCalc-1190"><span class="linenos">1190</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">result_med_agg</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-1191"><a href="#LabelsCalc-1191"><span class="linenos">1191</span></a>
</span><span id="LabelsCalc-1192"><a href="#LabelsCalc-1192"><span class="linenos">1192</span></a>        <span class="n">dy_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1193"><a href="#LabelsCalc-1193"><span class="linenos">1193</span></a>        <span class="n">dy_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">dy_dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="LabelsCalc-1194"><a href="#LabelsCalc-1194"><span class="linenos">1194</span></a>
</span><span id="LabelsCalc-1195"><a href="#LabelsCalc-1195"><span class="linenos">1195</span></a>        <span class="n">dxdy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="LabelsCalc-1196"><a href="#LabelsCalc-1196"><span class="linenos">1196</span></a>            <span class="p">{</span><span class="s2">&quot;de_value&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy_dx</span><span class="p">)}</span>
</span><span id="LabelsCalc-1197"><a href="#LabelsCalc-1197"><span class="linenos">1197</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;de_value&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1198"><a href="#LabelsCalc-1198"><span class="linenos">1198</span></a>
</span><span id="LabelsCalc-1199"><a href="#LabelsCalc-1199"><span class="linenos">1199</span></a>        <span class="n">stabilization_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">dxdy</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">const</span><span class="o">.</span><span class="n">BEST_POINT_NO</span><span class="p">]]</span>
</span><span id="LabelsCalc-1200"><a href="#LabelsCalc-1200"><span class="linenos">1200</span></a>        <span class="n">filtred</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stabilization_x</span><span class="p">)]</span>
</span><span id="LabelsCalc-1201"><a href="#LabelsCalc-1201"><span class="linenos">1201</span></a>        <span class="n">suma_total_stops</span> <span class="o">=</span> <span class="n">filtred</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">param</span><span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="LabelsCalc-1202"><a href="#LabelsCalc-1202"><span class="linenos">1202</span></a>        <span class="n">stabilization_point_index</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">suma_total_stops</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
</span><span id="LabelsCalc-1203"><a href="#LabelsCalc-1203"><span class="linenos">1203</span></a>
</span><span id="LabelsCalc-1204"><a href="#LabelsCalc-1204"><span class="linenos">1204</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_param</span><span class="p">(</span>
</span><span id="LabelsCalc-1205"><a href="#LabelsCalc-1205"><span class="linenos">1205</span></a>            <span class="n">param</span><span class="p">,</span> <span class="n">stabilization_point_index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy_dx</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1206"><a href="#LabelsCalc-1206"><span class="linenos">1206</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1207"><a href="#LabelsCalc-1207"><span class="linenos">1207</span></a>
</span><span id="LabelsCalc-1208"><a href="#LabelsCalc-1208"><span class="linenos">1208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> value: </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1209"><a href="#LabelsCalc-1209"><span class="linenos">1209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span id="LabelsCalc-1210"><a href="#LabelsCalc-1210"><span class="linenos">1210</span></a>
</span><span id="LabelsCalc-1211"><a href="#LabelsCalc-1211"><span class="linenos">1211</span></a>        <span class="k">return</span> <span class="n">stabilization_point_index</span>
</span><span id="LabelsCalc-1212"><a href="#LabelsCalc-1212"><span class="linenos">1212</span></a>
</span><span id="LabelsCalc-1213"><a href="#LabelsCalc-1213"><span class="linenos">1213</span></a>
</span><span id="LabelsCalc-1214"><a href="#LabelsCalc-1214"><span class="linenos">1214</span></a>    <span class="k">def</span> <span class="nf">_choose_param_value_with_clustering_params</span><span class="p">(</span>
</span><span id="LabelsCalc-1215"><a href="#LabelsCalc-1215"><span class="linenos">1215</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="LabelsCalc-1216"><a href="#LabelsCalc-1216"><span class="linenos">1216</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="LabelsCalc-1217"><a href="#LabelsCalc-1217"><span class="linenos">1217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1218"><a href="#LabelsCalc-1218"><span class="linenos">1218</span></a><span class="sd">        Choose the optimal value for a given parameter based on</span>
</span><span id="LabelsCalc-1219"><a href="#LabelsCalc-1219"><span class="linenos">1219</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="LabelsCalc-1220"><a href="#LabelsCalc-1220"><span class="linenos">1220</span></a>
</span><span id="LabelsCalc-1221"><a href="#LabelsCalc-1221"><span class="linenos">1221</span></a><span class="sd">        The method identifies a stabilization point for the parameter,</span>
</span><span id="LabelsCalc-1222"><a href="#LabelsCalc-1222"><span class="linenos">1222</span></a><span class="sd">        where the total stops stabilize with minimal changes in the</span>
</span><span id="LabelsCalc-1223"><a href="#LabelsCalc-1223"><span class="linenos">1223</span></a><span class="sd">        corresponding value.</span>
</span><span id="LabelsCalc-1224"><a href="#LabelsCalc-1224"><span class="linenos">1224</span></a>
</span><span id="LabelsCalc-1225"><a href="#LabelsCalc-1225"><span class="linenos">1225</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1226"><a href="#LabelsCalc-1226"><span class="linenos">1226</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1227"><a href="#LabelsCalc-1227"><span class="linenos">1227</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc-1228"><a href="#LabelsCalc-1228"><span class="linenos">1228</span></a><span class="sd">            The data containing the results of parameter sensitivity.</span>
</span><span id="LabelsCalc-1229"><a href="#LabelsCalc-1229"><span class="linenos">1229</span></a><span class="sd">        param : str</span>
</span><span id="LabelsCalc-1230"><a href="#LabelsCalc-1230"><span class="linenos">1230</span></a><span class="sd">            The parameter to optimize. Should be one of [&quot;R1&quot;, &quot;Tmin&quot;].</span>
</span><span id="LabelsCalc-1231"><a href="#LabelsCalc-1231"><span class="linenos">1231</span></a>
</span><span id="LabelsCalc-1232"><a href="#LabelsCalc-1232"><span class="linenos">1232</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1233"><a href="#LabelsCalc-1233"><span class="linenos">1233</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1234"><a href="#LabelsCalc-1234"><span class="linenos">1234</span></a><span class="sd">        float</span>
</span><span id="LabelsCalc-1235"><a href="#LabelsCalc-1235"><span class="linenos">1235</span></a><span class="sd">            The selected optimal parameter value based on</span>
</span><span id="LabelsCalc-1236"><a href="#LabelsCalc-1236"><span class="linenos">1236</span></a><span class="sd">            the stabilization point.</span>
</span><span id="LabelsCalc-1237"><a href="#LabelsCalc-1237"><span class="linenos">1237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1238"><a href="#LabelsCalc-1238"><span class="linenos">1238</span></a>
</span><span id="LabelsCalc-1239"><a href="#LabelsCalc-1239"><span class="linenos">1239</span></a>        <span class="n">result_med</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1240"><a href="#LabelsCalc-1240"><span class="linenos">1240</span></a>        <span class="n">param_value</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">index</span>
</span><span id="LabelsCalc-1241"><a href="#LabelsCalc-1241"><span class="linenos">1241</span></a>        <span class="n">med_totalstops</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="LabelsCalc-1242"><a href="#LabelsCalc-1242"><span class="linenos">1242</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="LabelsCalc-1243"><a href="#LabelsCalc-1243"><span class="linenos">1243</span></a>        <span class="p">)[</span><span class="s2">&quot;Total_stops&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1244"><a href="#LabelsCalc-1244"><span class="linenos">1244</span></a>
</span><span id="LabelsCalc-1245"><a href="#LabelsCalc-1245"><span class="linenos">1245</span></a>        <span class="n">med_sh</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="LabelsCalc-1246"><a href="#LabelsCalc-1246"><span class="linenos">1246</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="LabelsCalc-1247"><a href="#LabelsCalc-1247"><span class="linenos">1247</span></a>        <span class="p">)[</span><span class="s2">&quot;SHTT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1248"><a href="#LabelsCalc-1248"><span class="linenos">1248</span></a>
</span><span id="LabelsCalc-1249"><a href="#LabelsCalc-1249"><span class="linenos">1249</span></a>        <span class="n">med_ch</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="LabelsCalc-1250"><a href="#LabelsCalc-1250"><span class="linenos">1250</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="LabelsCalc-1251"><a href="#LabelsCalc-1251"><span class="linenos">1251</span></a>        <span class="p">)[</span><span class="s2">&quot;CH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1252"><a href="#LabelsCalc-1252"><span class="linenos">1252</span></a>
</span><span id="LabelsCalc-1253"><a href="#LabelsCalc-1253"><span class="linenos">1253</span></a>        <span class="n">med_db</span> <span class="o">=</span> <span class="n">result_med</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
</span><span id="LabelsCalc-1254"><a href="#LabelsCalc-1254"><span class="linenos">1254</span></a>            <span class="n">level</span><span class="o">=</span><span class="n">param</span>
</span><span id="LabelsCalc-1255"><a href="#LabelsCalc-1255"><span class="linenos">1255</span></a>        <span class="p">)[</span><span class="s2">&quot;DB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span id="LabelsCalc-1256"><a href="#LabelsCalc-1256"><span class="linenos">1256</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">med_sh</span><span class="p">)</span>
</span><span id="LabelsCalc-1257"><a href="#LabelsCalc-1257"><span class="linenos">1257</span></a>
</span><span id="LabelsCalc-1258"><a href="#LabelsCalc-1258"><span class="linenos">1258</span></a>        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="LabelsCalc-1259"><a href="#LabelsCalc-1259"><span class="linenos">1259</span></a>        <span class="c1"># f&quot;{param}&quot;: param_value,</span>
</span><span id="LabelsCalc-1260"><a href="#LabelsCalc-1260"><span class="linenos">1260</span></a>        <span class="s2">&quot;totalstops&quot;</span><span class="p">:</span> <span class="n">med_totalstops</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LabelsCalc-1261"><a href="#LabelsCalc-1261"><span class="linenos">1261</span></a>        <span class="s2">&quot;sh&quot;</span><span class="p">:</span> <span class="n">med_sh</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LabelsCalc-1262"><a href="#LabelsCalc-1262"><span class="linenos">1262</span></a>        <span class="s2">&quot;ch&quot;</span><span class="p">:</span> <span class="n">med_ch</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LabelsCalc-1263"><a href="#LabelsCalc-1263"><span class="linenos">1263</span></a>        <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">med_db</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LabelsCalc-1264"><a href="#LabelsCalc-1264"><span class="linenos">1264</span></a>        <span class="p">})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">_scores_values.csv&#39;</span><span class="p">)</span>
</span><span id="LabelsCalc-1265"><a href="#LabelsCalc-1265"><span class="linenos">1265</span></a>        <span class="n">stabilization_point_index</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="LabelsCalc-1266"><a href="#LabelsCalc-1266"><span class="linenos">1266</span></a>
</span><span id="LabelsCalc-1267"><a href="#LabelsCalc-1267"><span class="linenos">1267</span></a>        <span class="n">plot_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot_param_with_clustering_measures</span><span class="p">(</span>
</span><span id="LabelsCalc-1268"><a href="#LabelsCalc-1268"><span class="linenos">1268</span></a>            <span class="n">param</span><span class="p">,</span> <span class="n">med_totalstops</span><span class="p">,</span> <span class="n">med_sh</span><span class="p">,</span> <span class="n">med_ch</span><span class="p">,</span><span class="n">med_db</span>   <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1269"><a href="#LabelsCalc-1269"><span class="linenos">1269</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1270"><a href="#LabelsCalc-1270"><span class="linenos">1270</span></a>
</span><span id="LabelsCalc-1271"><a href="#LabelsCalc-1271"><span class="linenos">1271</span></a>
</span><span id="LabelsCalc-1272"><a href="#LabelsCalc-1272"><span class="linenos">1272</span></a>
</span><span id="LabelsCalc-1273"><a href="#LabelsCalc-1273"><span class="linenos">1273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> value: </span><span class="si">{</span><span class="n">stabilization_point_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1274"><a href="#LabelsCalc-1274"><span class="linenos">1274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_plot</span><span class="p">(</span><span class="n">plot_obj</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span><span id="LabelsCalc-1275"><a href="#LabelsCalc-1275"><span class="linenos">1275</span></a>
</span><span id="LabelsCalc-1276"><a href="#LabelsCalc-1276"><span class="linenos">1276</span></a>        <span class="k">return</span> <span class="n">stabilization_point_index</span>
</span><span id="LabelsCalc-1277"><a href="#LabelsCalc-1277"><span class="linenos">1277</span></a>
</span><span id="LabelsCalc-1278"><a href="#LabelsCalc-1278"><span class="linenos">1278</span></a>
</span><span id="LabelsCalc-1279"><a href="#LabelsCalc-1279"><span class="linenos">1279</span></a>    <span class="k">def</span> <span class="nf">_plot_param_with_clustering_measures</span><span class="p">(</span>
</span><span id="LabelsCalc-1280"><a href="#LabelsCalc-1280"><span class="linenos">1280</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LabelsCalc-1281"><a href="#LabelsCalc-1281"><span class="linenos">1281</span></a>        <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="LabelsCalc-1282"><a href="#LabelsCalc-1282"><span class="linenos">1282</span></a>        <span class="n">total_stops</span><span class="p">,</span>
</span><span id="LabelsCalc-1283"><a href="#LabelsCalc-1283"><span class="linenos">1283</span></a>        <span class="n">shtt</span><span class="p">,</span>
</span><span id="LabelsCalc-1284"><a href="#LabelsCalc-1284"><span class="linenos">1284</span></a>        <span class="n">ch</span><span class="p">,</span>
</span><span id="LabelsCalc-1285"><a href="#LabelsCalc-1285"><span class="linenos">1285</span></a>        <span class="n">db</span>
</span><span id="LabelsCalc-1286"><a href="#LabelsCalc-1286"><span class="linenos">1286</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BytesIO</span><span class="p">:</span>
</span><span id="LabelsCalc-1287"><a href="#LabelsCalc-1287"><span class="linenos">1287</span></a>
</span><span id="LabelsCalc-1288"><a href="#LabelsCalc-1288"><span class="linenos">1288</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span><span id="LabelsCalc-1289"><a href="#LabelsCalc-1289"><span class="linenos">1289</span></a>
</span><span id="LabelsCalc-1290"><a href="#LabelsCalc-1290"><span class="linenos">1290</span></a>        <span class="c1"># Dodanie serii jako wykresw liniowych</span>
</span><span id="LabelsCalc-1291"><a href="#LabelsCalc-1291"><span class="linenos">1291</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_stops</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total stops&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="LabelsCalc-1292"><a href="#LabelsCalc-1292"><span class="linenos">1292</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shtt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Silhouette&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="LabelsCalc-1293"><a href="#LabelsCalc-1293"><span class="linenos">1293</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calinski-Harabasz&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="LabelsCalc-1294"><a href="#LabelsCalc-1294"><span class="linenos">1294</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Davies Bouldin&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="LabelsCalc-1295"><a href="#LabelsCalc-1295"><span class="linenos">1295</span></a>
</span><span id="LabelsCalc-1296"><a href="#LabelsCalc-1296"><span class="linenos">1296</span></a>        <span class="c1"># Dodanie tytuu, etykiet osi i legendy</span>
</span><span id="LabelsCalc-1297"><a href="#LabelsCalc-1297"><span class="linenos">1297</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Medians of scors for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1298"><a href="#LabelsCalc-1298"><span class="linenos">1298</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span><span id="LabelsCalc-1299"><a href="#LabelsCalc-1299"><span class="linenos">1299</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Values&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1300"><a href="#LabelsCalc-1300"><span class="linenos">1300</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1"># Wywietlenie legendy</span>
</span><span id="LabelsCalc-1301"><a href="#LabelsCalc-1301"><span class="linenos">1301</span></a>
</span><span id="LabelsCalc-1302"><a href="#LabelsCalc-1302"><span class="linenos">1302</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="LabelsCalc-1303"><a href="#LabelsCalc-1303"><span class="linenos">1303</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="LabelsCalc-1304"><a href="#LabelsCalc-1304"><span class="linenos">1304</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="LabelsCalc-1305"><a href="#LabelsCalc-1305"><span class="linenos">1305</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span>
</span><span id="LabelsCalc-1306"><a href="#LabelsCalc-1306"><span class="linenos">1306</span></a>                <span class="sa">f</span><span class="s2">&quot;Medians of scors for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LabelsCalc-1307"><a href="#LabelsCalc-1307"><span class="linenos">1307</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1308"><a href="#LabelsCalc-1308"><span class="linenos">1308</span></a>        <span class="p">)</span>
</span><span id="LabelsCalc-1309"><a href="#LabelsCalc-1309"><span class="linenos">1309</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1310"><a href="#LabelsCalc-1310"><span class="linenos">1310</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="LabelsCalc-1311"><a href="#LabelsCalc-1311"><span class="linenos">1311</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="LabelsCalc-1312"><a href="#LabelsCalc-1312"><span class="linenos">1312</span></a>
</span><span id="LabelsCalc-1313"><a href="#LabelsCalc-1313"><span class="linenos">1313</span></a>        <span class="k">return</span> <span class="n">buffer</span>
</span><span id="LabelsCalc-1314"><a href="#LabelsCalc-1314"><span class="linenos">1314</span></a>
</span><span id="LabelsCalc-1315"><a href="#LabelsCalc-1315"><span class="linenos">1315</span></a>
</span><span id="LabelsCalc-1316"><a href="#LabelsCalc-1316"><span class="linenos">1316</span></a>    <span class="k">def</span> <span class="nf">_choose_best_params</span><span class="p">(</span>
</span><span id="LabelsCalc-1317"><a href="#LabelsCalc-1317"><span class="linenos">1317</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">sensitivity_matrix</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="LabelsCalc-1318"><a href="#LabelsCalc-1318"><span class="linenos">1318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="LabelsCalc-1319"><a href="#LabelsCalc-1319"><span class="linenos">1319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1320"><a href="#LabelsCalc-1320"><span class="linenos">1320</span></a><span class="sd">        Choose the best parameter values for R1, R2, and Tmin based on</span>
</span><span id="LabelsCalc-1321"><a href="#LabelsCalc-1321"><span class="linenos">1321</span></a><span class="sd">        the sensitivity matrix.</span>
</span><span id="LabelsCalc-1322"><a href="#LabelsCalc-1322"><span class="linenos">1322</span></a>
</span><span id="LabelsCalc-1323"><a href="#LabelsCalc-1323"><span class="linenos">1323</span></a><span class="sd">        The method sequentially selects the best values for R1, R2,</span>
</span><span id="LabelsCalc-1324"><a href="#LabelsCalc-1324"><span class="linenos">1324</span></a><span class="sd">        and Tmin based on their stabilization point and the effect</span>
</span><span id="LabelsCalc-1325"><a href="#LabelsCalc-1325"><span class="linenos">1325</span></a><span class="sd">        on the total stops.</span>
</span><span id="LabelsCalc-1326"><a href="#LabelsCalc-1326"><span class="linenos">1326</span></a>
</span><span id="LabelsCalc-1327"><a href="#LabelsCalc-1327"><span class="linenos">1327</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1328"><a href="#LabelsCalc-1328"><span class="linenos">1328</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1329"><a href="#LabelsCalc-1329"><span class="linenos">1329</span></a><span class="sd">        sensitivity_matrix : pd.DataFrame</span>
</span><span id="LabelsCalc-1330"><a href="#LabelsCalc-1330"><span class="linenos">1330</span></a><span class="sd">            The sensitivity matrix with parameters (R1, R2, Tmin)</span>
</span><span id="LabelsCalc-1331"><a href="#LabelsCalc-1331"><span class="linenos">1331</span></a><span class="sd">            and their respective total stops.</span>
</span><span id="LabelsCalc-1332"><a href="#LabelsCalc-1332"><span class="linenos">1332</span></a>
</span><span id="LabelsCalc-1333"><a href="#LabelsCalc-1333"><span class="linenos">1333</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1334"><a href="#LabelsCalc-1334"><span class="linenos">1334</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1335"><a href="#LabelsCalc-1335"><span class="linenos">1335</span></a><span class="sd">        Tuple[float, float, float]</span>
</span><span id="LabelsCalc-1336"><a href="#LabelsCalc-1336"><span class="linenos">1336</span></a><span class="sd">            A tuple containing the selected values for R1, R2, and Tmin.</span>
</span><span id="LabelsCalc-1337"><a href="#LabelsCalc-1337"><span class="linenos">1337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1338"><a href="#LabelsCalc-1338"><span class="linenos">1338</span></a>
</span><span id="LabelsCalc-1339"><a href="#LabelsCalc-1339"><span class="linenos">1339</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-1340"><a href="#LabelsCalc-1340"><span class="linenos">1340</span></a>            <span class="n">r1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;R1&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1341"><a href="#LabelsCalc-1341"><span class="linenos">1341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="LabelsCalc-1342"><a href="#LabelsCalc-1342"><span class="linenos">1342</span></a>            <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1343"><a href="#LabelsCalc-1343"><span class="linenos">1343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>  <span class="c1"># Start a new page for the next section of raport</span>
</span><span id="LabelsCalc-1344"><a href="#LabelsCalc-1344"><span class="linenos">1344</span></a>            <span class="n">Tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_param_value</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">,</span> <span class="s2">&quot;Tmin&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1345"><a href="#LabelsCalc-1345"><span class="linenos">1345</span></a>
</span><span id="LabelsCalc-1346"><a href="#LabelsCalc-1346"><span class="linenos">1346</span></a>            <span class="k">return</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span>
</span><span id="LabelsCalc-1347"><a href="#LabelsCalc-1347"><span class="linenos">1347</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-1348"><a href="#LabelsCalc-1348"><span class="linenos">1348</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error selecting best parameters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1349"><a href="#LabelsCalc-1349"><span class="linenos">1349</span></a>
</span><span id="LabelsCalc-1350"><a href="#LabelsCalc-1350"><span class="linenos">1350</span></a>
</span><span id="LabelsCalc-1351"><a href="#LabelsCalc-1351"><span class="linenos">1351</span></a>    <span class="k">def</span> <span class="nf">_calc_labels</span><span class="p">(</span>
</span><span id="LabelsCalc-1352"><a href="#LabelsCalc-1352"><span class="linenos">1352</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">r1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="LabelsCalc-1353"><a href="#LabelsCalc-1353"><span class="linenos">1353</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="LabelsCalc-1354"><a href="#LabelsCalc-1354"><span class="linenos">1354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1355"><a href="#LabelsCalc-1355"><span class="linenos">1355</span></a><span class="sd">        Calculates stop location labels for trajectory data using</span>
</span><span id="LabelsCalc-1356"><a href="#LabelsCalc-1356"><span class="linenos">1356</span></a><span class="sd">        the Infostop model.</span>
</span><span id="LabelsCalc-1357"><a href="#LabelsCalc-1357"><span class="linenos">1357</span></a>
</span><span id="LabelsCalc-1358"><a href="#LabelsCalc-1358"><span class="linenos">1358</span></a><span class="sd">        Args:</span>
</span><span id="LabelsCalc-1359"><a href="#LabelsCalc-1359"><span class="linenos">1359</span></a><span class="sd">            data (iterable): Iterable containing user_id and associated</span>
</span><span id="LabelsCalc-1360"><a href="#LabelsCalc-1360"><span class="linenos">1360</span></a><span class="sd">                trajectory data.</span>
</span><span id="LabelsCalc-1361"><a href="#LabelsCalc-1361"><span class="linenos">1361</span></a><span class="sd">            r1 (float): Primary clustering radius for Infostop.</span>
</span><span id="LabelsCalc-1362"><a href="#LabelsCalc-1362"><span class="linenos">1362</span></a><span class="sd">            r2 (float): Secondary clustering radius for merging clusters.</span>
</span><span id="LabelsCalc-1363"><a href="#LabelsCalc-1363"><span class="linenos">1363</span></a><span class="sd">            Tmin (int): Minimum duration (in seconds) for a stop to</span>
</span><span id="LabelsCalc-1364"><a href="#LabelsCalc-1364"><span class="linenos">1364</span></a><span class="sd">                be considered valid.</span>
</span><span id="LabelsCalc-1365"><a href="#LabelsCalc-1365"><span class="linenos">1365</span></a>
</span><span id="LabelsCalc-1366"><a href="#LabelsCalc-1366"><span class="linenos">1366</span></a><span class="sd">        Returns:</span>
</span><span id="LabelsCalc-1367"><a href="#LabelsCalc-1367"><span class="linenos">1367</span></a><span class="sd">            pd.DataFrame: DataFrame containing labeled stop locations</span>
</span><span id="LabelsCalc-1368"><a href="#LabelsCalc-1368"><span class="linenos">1368</span></a><span class="sd">                with the following columns:</span>
</span><span id="LabelsCalc-1369"><a href="#LabelsCalc-1369"><span class="linenos">1369</span></a><span class="sd">                - &#39;animal_id&#39;: The ID of the tracked individual.</span>
</span><span id="LabelsCalc-1370"><a href="#LabelsCalc-1370"><span class="linenos">1370</span></a><span class="sd">                - &#39;labels&#39;: Cluster labels assigned to stop locations.</span>
</span><span id="LabelsCalc-1371"><a href="#LabelsCalc-1371"><span class="linenos">1371</span></a><span class="sd">                - &#39;lat&#39;: Latitude of each recorded point.</span>
</span><span id="LabelsCalc-1372"><a href="#LabelsCalc-1372"><span class="linenos">1372</span></a><span class="sd">                - &#39;lon&#39;: Longitude of each recorded point.</span>
</span><span id="LabelsCalc-1373"><a href="#LabelsCalc-1373"><span class="linenos">1373</span></a><span class="sd">                - &#39;time&#39;: Timestamp of each recorded point.</span>
</span><span id="LabelsCalc-1374"><a href="#LabelsCalc-1374"><span class="linenos">1374</span></a>
</span><span id="LabelsCalc-1375"><a href="#LabelsCalc-1375"><span class="linenos">1375</span></a><span class="sd">        Raises:</span>
</span><span id="LabelsCalc-1376"><a href="#LabelsCalc-1376"><span class="linenos">1376</span></a><span class="sd">            ValueError: If the input data format is invalid.</span>
</span><span id="LabelsCalc-1377"><a href="#LabelsCalc-1377"><span class="linenos">1377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1378"><a href="#LabelsCalc-1378"><span class="linenos">1378</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LabelsCalc-1379"><a href="#LabelsCalc-1379"><span class="linenos">1379</span></a>        <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span><span id="LabelsCalc-1380"><a href="#LabelsCalc-1380"><span class="linenos">1380</span></a>            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1381"><a href="#LabelsCalc-1381"><span class="linenos">1381</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">group</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="LabelsCalc-1382"><a href="#LabelsCalc-1382"><span class="linenos">1382</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">Infostop</span><span class="p">(</span>
</span><span id="LabelsCalc-1383"><a href="#LabelsCalc-1383"><span class="linenos">1383</span></a>                <span class="n">r1</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span>
</span><span id="LabelsCalc-1384"><a href="#LabelsCalc-1384"><span class="linenos">1384</span></a>                <span class="n">r2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
</span><span id="LabelsCalc-1385"><a href="#LabelsCalc-1385"><span class="linenos">1385</span></a>                <span class="n">label_singleton</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LabelsCalc-1386"><a href="#LabelsCalc-1386"><span class="linenos">1386</span></a>                <span class="n">min_staying_time</span><span class="o">=</span><span class="n">Tmin</span><span class="p">,</span>
</span><span id="LabelsCalc-1387"><a href="#LabelsCalc-1387"><span class="linenos">1387</span></a>                <span class="n">max_time_between</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_TIME_BETWEEN</span><span class="p">,</span>
</span><span id="LabelsCalc-1388"><a href="#LabelsCalc-1388"><span class="linenos">1388</span></a>                <span class="n">min_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="LabelsCalc-1389"><a href="#LabelsCalc-1389"><span class="linenos">1389</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1390"><a href="#LabelsCalc-1390"><span class="linenos">1390</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc-1391"><a href="#LabelsCalc-1391"><span class="linenos">1391</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
</span><span id="LabelsCalc-1392"><a href="#LabelsCalc-1392"><span class="linenos">1392</span></a>                <span class="p">[</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>  <span class="c1"># type: ignore</span>
</span><span id="LabelsCalc-1393"><a href="#LabelsCalc-1393"><span class="linenos">1393</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1394"><a href="#LabelsCalc-1394"><span class="linenos">1394</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="LabelsCalc-1395"><a href="#LabelsCalc-1395"><span class="linenos">1395</span></a>                <span class="n">trajectory</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="LabelsCalc-1396"><a href="#LabelsCalc-1396"><span class="linenos">1396</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1397"><a href="#LabelsCalc-1397"><span class="linenos">1397</span></a>            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="n">trajectory</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LabelsCalc-1398"><a href="#LabelsCalc-1398"><span class="linenos">1398</span></a>            <span class="n">trajectory</span><span class="p">[</span><span class="s2">&quot;animal_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
</span><span id="LabelsCalc-1399"><a href="#LabelsCalc-1399"><span class="linenos">1399</span></a>
</span><span id="LabelsCalc-1400"><a href="#LabelsCalc-1400"><span class="linenos">1400</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="LabelsCalc-1401"><a href="#LabelsCalc-1401"><span class="linenos">1401</span></a>                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="LabelsCalc-1402"><a href="#LabelsCalc-1402"><span class="linenos">1402</span></a>                    <span class="n">trajectory</span><span class="p">,</span>
</span><span id="LabelsCalc-1403"><a href="#LabelsCalc-1403"><span class="linenos">1403</span></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;animal_id&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="LabelsCalc-1404"><a href="#LabelsCalc-1404"><span class="linenos">1404</span></a>                <span class="p">)</span>
</span><span id="LabelsCalc-1405"><a href="#LabelsCalc-1405"><span class="linenos">1405</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1406"><a href="#LabelsCalc-1406"><span class="linenos">1406</span></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LabelsCalc-1407"><a href="#LabelsCalc-1407"><span class="linenos">1407</span></a>
</span><span id="LabelsCalc-1408"><a href="#LabelsCalc-1408"><span class="linenos">1408</span></a>    <span class="k">def</span> <span class="nf">calculate_infostop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="LabelsCalc-1409"><a href="#LabelsCalc-1409"><span class="linenos">1409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1410"><a href="#LabelsCalc-1410"><span class="linenos">1410</span></a><span class="sd">        Perform Infostop calculation, including sensitivity analysis</span>
</span><span id="LabelsCalc-1411"><a href="#LabelsCalc-1411"><span class="linenos">1411</span></a><span class="sd">        and trajectory labeling.</span>
</span><span id="LabelsCalc-1412"><a href="#LabelsCalc-1412"><span class="linenos">1412</span></a>
</span><span id="LabelsCalc-1413"><a href="#LabelsCalc-1413"><span class="linenos">1413</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc-1414"><a href="#LabelsCalc-1414"><span class="linenos">1414</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc-1415"><a href="#LabelsCalc-1415"><span class="linenos">1415</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc-1416"><a href="#LabelsCalc-1416"><span class="linenos">1416</span></a><span class="sd">            Input data containing user trajectories.</span>
</span><span id="LabelsCalc-1417"><a href="#LabelsCalc-1417"><span class="linenos">1417</span></a>
</span><span id="LabelsCalc-1418"><a href="#LabelsCalc-1418"><span class="linenos">1418</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc-1419"><a href="#LabelsCalc-1419"><span class="linenos">1419</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc-1420"><a href="#LabelsCalc-1420"><span class="linenos">1420</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LabelsCalc-1421"><a href="#LabelsCalc-1421"><span class="linenos">1421</span></a><span class="sd">            Final labeled trajectories.</span>
</span><span id="LabelsCalc-1422"><a href="#LabelsCalc-1422"><span class="linenos">1422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc-1423"><a href="#LabelsCalc-1423"><span class="linenos">1423</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc-1424"><a href="#LabelsCalc-1424"><span class="linenos">1424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Infostop calculations&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc-1425"><a href="#LabelsCalc-1425"><span class="linenos">1425</span></a>            <span class="n">sensitivity_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_params_matrix_parallel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc-1426"><a href="#LabelsCalc-1426"><span class="linenos">1426</span></a>            <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_best_params</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">)</span>
</span><span id="LabelsCalc-1427"><a href="#LabelsCalc-1427"><span class="linenos">1427</span></a>            <span class="n">final_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">)</span>
</span><span id="LabelsCalc-1428"><a href="#LabelsCalc-1428"><span class="linenos">1428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="LabelsCalc-1429"><a href="#LabelsCalc-1429"><span class="linenos">1429</span></a>                <span class="sa">f</span><span class="s2">&quot;Final number of animals: &quot;</span>
</span><span id="LabelsCalc-1430"><a href="#LabelsCalc-1430"><span class="linenos">1430</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">final_data</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LabelsCalc-1431"><a href="#LabelsCalc-1431"><span class="linenos">1431</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc-1432"><a href="#LabelsCalc-1432"><span class="linenos">1432</span></a>            <span class="k">return</span> <span class="n">final_data</span>
</span><span id="LabelsCalc-1433"><a href="#LabelsCalc-1433"><span class="linenos">1433</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc-1434"><a href="#LabelsCalc-1434"><span class="linenos">1434</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Infostop calculation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class for processing and labeling movement data using
the Infostop algorithm. Includes functionality for parameter optimization,
trajectory segmentation, and result visualization.</p>

<h2 id="attributes">Attributes</h2>

<p>pdf_object : FPDF
    A PDF object for documenting results and calculations.
output_path : str
    The directory where plots and other outputs will be saved.</p>
</div>


                            <div id="LabelsCalc.__init__" class="classattr">
                                        <input id="LabelsCalc.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LabelsCalc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pdf_object</span><span class="p">:</span> <span class="n">fpdf</span><span class="o">.</span><span class="n">fpdf</span><span class="o">.</span><span class="n">FPDF</span>, </span><span class="param"><span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="LabelsCalc.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LabelsCalc.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LabelsCalc.__init__-804"><a href="#LabelsCalc.__init__-804"><span class="linenos">804</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_object</span><span class="p">:</span> <span class="n">FPDF</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LabelsCalc.__init__-805"><a href="#LabelsCalc.__init__-805"><span class="linenos">805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc.__init__-806"><a href="#LabelsCalc.__init__-806"><span class="linenos">806</span></a><span class="sd">        Initialize the LabelsCalc instance.</span>
</span><span id="LabelsCalc.__init__-807"><a href="#LabelsCalc.__init__-807"><span class="linenos">807</span></a>
</span><span id="LabelsCalc.__init__-808"><a href="#LabelsCalc.__init__-808"><span class="linenos">808</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc.__init__-809"><a href="#LabelsCalc.__init__-809"><span class="linenos">809</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc.__init__-810"><a href="#LabelsCalc.__init__-810"><span class="linenos">810</span></a><span class="sd">        pdf_object : FPDF</span>
</span><span id="LabelsCalc.__init__-811"><a href="#LabelsCalc.__init__-811"><span class="linenos">811</span></a><span class="sd">            PDF object for logging and documentation.</span>
</span><span id="LabelsCalc.__init__-812"><a href="#LabelsCalc.__init__-812"><span class="linenos">812</span></a><span class="sd">        output_path : str</span>
</span><span id="LabelsCalc.__init__-813"><a href="#LabelsCalc.__init__-813"><span class="linenos">813</span></a><span class="sd">            Path to save generated plots and outputs.</span>
</span><span id="LabelsCalc.__init__-814"><a href="#LabelsCalc.__init__-814"><span class="linenos">814</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc.__init__-815"><a href="#LabelsCalc.__init__-815"><span class="linenos">815</span></a>
</span><span id="LabelsCalc.__init__-816"><a href="#LabelsCalc.__init__-816"><span class="linenos">816</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf_object</span> <span class="o">=</span> <span class="n">pdf_object</span>
</span><span id="LabelsCalc.__init__-817"><a href="#LabelsCalc.__init__-817"><span class="linenos">817</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the LabelsCalc instance.</p>

<h2 id="parameters">Parameters</h2>

<p>pdf_object : FPDF
    PDF object for logging and documentation.
output_path : str
    Path to save generated plots and outputs.</p>
</div>


                            </div>
                            <div id="LabelsCalc.pdf_object" class="classattr">
                                <div class="attr variable">
            <span class="name">pdf_object</span>

        
    </div>
    <a class="headerlink" href="#LabelsCalc.pdf_object"></a>
    
    

                            </div>
                            <div id="LabelsCalc.output_path" class="classattr">
                                <div class="attr variable">
            <span class="name">output_path</span>

        
    </div>
    <a class="headerlink" href="#LabelsCalc.output_path"></a>
    
    

                            </div>
                            <div id="LabelsCalc.calculate_infostop" class="classattr">
                                        <input id="LabelsCalc.calculate_infostop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_infostop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="LabelsCalc.calculate_infostop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LabelsCalc.calculate_infostop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LabelsCalc.calculate_infostop-1408"><a href="#LabelsCalc.calculate_infostop-1408"><span class="linenos">1408</span></a>    <span class="k">def</span> <span class="nf">calculate_infostop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="LabelsCalc.calculate_infostop-1409"><a href="#LabelsCalc.calculate_infostop-1409"><span class="linenos">1409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LabelsCalc.calculate_infostop-1410"><a href="#LabelsCalc.calculate_infostop-1410"><span class="linenos">1410</span></a><span class="sd">        Perform Infostop calculation, including sensitivity analysis</span>
</span><span id="LabelsCalc.calculate_infostop-1411"><a href="#LabelsCalc.calculate_infostop-1411"><span class="linenos">1411</span></a><span class="sd">        and trajectory labeling.</span>
</span><span id="LabelsCalc.calculate_infostop-1412"><a href="#LabelsCalc.calculate_infostop-1412"><span class="linenos">1412</span></a>
</span><span id="LabelsCalc.calculate_infostop-1413"><a href="#LabelsCalc.calculate_infostop-1413"><span class="linenos">1413</span></a><span class="sd">        Parameters</span>
</span><span id="LabelsCalc.calculate_infostop-1414"><a href="#LabelsCalc.calculate_infostop-1414"><span class="linenos">1414</span></a><span class="sd">        ----------</span>
</span><span id="LabelsCalc.calculate_infostop-1415"><a href="#LabelsCalc.calculate_infostop-1415"><span class="linenos">1415</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="LabelsCalc.calculate_infostop-1416"><a href="#LabelsCalc.calculate_infostop-1416"><span class="linenos">1416</span></a><span class="sd">            Input data containing user trajectories.</span>
</span><span id="LabelsCalc.calculate_infostop-1417"><a href="#LabelsCalc.calculate_infostop-1417"><span class="linenos">1417</span></a>
</span><span id="LabelsCalc.calculate_infostop-1418"><a href="#LabelsCalc.calculate_infostop-1418"><span class="linenos">1418</span></a><span class="sd">        Returns</span>
</span><span id="LabelsCalc.calculate_infostop-1419"><a href="#LabelsCalc.calculate_infostop-1419"><span class="linenos">1419</span></a><span class="sd">        -------</span>
</span><span id="LabelsCalc.calculate_infostop-1420"><a href="#LabelsCalc.calculate_infostop-1420"><span class="linenos">1420</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="LabelsCalc.calculate_infostop-1421"><a href="#LabelsCalc.calculate_infostop-1421"><span class="linenos">1421</span></a><span class="sd">            Final labeled trajectories.</span>
</span><span id="LabelsCalc.calculate_infostop-1422"><a href="#LabelsCalc.calculate_infostop-1422"><span class="linenos">1422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LabelsCalc.calculate_infostop-1423"><a href="#LabelsCalc.calculate_infostop-1423"><span class="linenos">1423</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LabelsCalc.calculate_infostop-1424"><a href="#LabelsCalc.calculate_infostop-1424"><span class="linenos">1424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span><span class="s2">&quot;Infostop calculations&quot;</span><span class="p">)</span>
</span><span id="LabelsCalc.calculate_infostop-1425"><a href="#LabelsCalc.calculate_infostop-1425"><span class="linenos">1425</span></a>            <span class="n">sensitivity_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_params_matrix_parallel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="LabelsCalc.calculate_infostop-1426"><a href="#LabelsCalc.calculate_infostop-1426"><span class="linenos">1426</span></a>            <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_best_params</span><span class="p">(</span><span class="n">sensitivity_matrix</span><span class="p">)</span>
</span><span id="LabelsCalc.calculate_infostop-1427"><a href="#LabelsCalc.calculate_infostop-1427"><span class="linenos">1427</span></a>            <span class="n">final_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">)</span>
</span><span id="LabelsCalc.calculate_infostop-1428"><a href="#LabelsCalc.calculate_infostop-1428"><span class="linenos">1428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_pdf_cell</span><span class="p">(</span>
</span><span id="LabelsCalc.calculate_infostop-1429"><a href="#LabelsCalc.calculate_infostop-1429"><span class="linenos">1429</span></a>                <span class="sa">f</span><span class="s2">&quot;Final number of animals: &quot;</span>
</span><span id="LabelsCalc.calculate_infostop-1430"><a href="#LabelsCalc.calculate_infostop-1430"><span class="linenos">1430</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">final_data</span><span class="p">[</span><span class="s1">&#39;animal_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LabelsCalc.calculate_infostop-1431"><a href="#LabelsCalc.calculate_infostop-1431"><span class="linenos">1431</span></a>            <span class="p">)</span>
</span><span id="LabelsCalc.calculate_infostop-1432"><a href="#LabelsCalc.calculate_infostop-1432"><span class="linenos">1432</span></a>            <span class="k">return</span> <span class="n">final_data</span>
</span><span id="LabelsCalc.calculate_infostop-1433"><a href="#LabelsCalc.calculate_infostop-1433"><span class="linenos">1433</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LabelsCalc.calculate_infostop-1434"><a href="#LabelsCalc.calculate_infostop-1434"><span class="linenos">1434</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Infostop calculation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform Infostop calculation, including sensitivity analysis
and trajectory labeling.</p>

<h2 id="parameters">Parameters</h2>

<p>data : pd.DataFrame
    Input data containing user trajectories.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    Final labeled trajectories.</p>
</div>


                            </div>
                </section>
                <section id="InfoStopData">
                            <input id="InfoStopData-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InfoStopData</span>:

                <label class="view-source-button" for="InfoStopData-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfoStopData"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InfoStopData-1437"><a href="#InfoStopData-1437"><span class="linenos">1437</span></a><span class="k">class</span> <span class="nc">InfoStopData</span><span class="p">:</span>
</span><span id="InfoStopData-1438"><a href="#InfoStopData-1438"><span class="linenos">1438</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfoStopData-1439"><a href="#InfoStopData-1439"><span class="linenos">1439</span></a><span class="sd">    A class responsible for analyzing animal data and generating reports in</span>
</span><span id="InfoStopData-1440"><a href="#InfoStopData-1440"><span class="linenos">1440</span></a><span class="sd">    PDF and CSV formats.</span>
</span><span id="InfoStopData-1441"><a href="#InfoStopData-1441"><span class="linenos">1441</span></a>
</span><span id="InfoStopData-1442"><a href="#InfoStopData-1442"><span class="linenos">1442</span></a><span class="sd">    Attributes:</span>
</span><span id="InfoStopData-1443"><a href="#InfoStopData-1443"><span class="linenos">1443</span></a><span class="sd">        clean_data (TrajectoriesFrame): Raw input data related to animals.</span>
</span><span id="InfoStopData-1444"><a href="#InfoStopData-1444"><span class="linenos">1444</span></a><span class="sd">        animal_name (str): The name of the analyzed animal.</span>
</span><span id="InfoStopData-1445"><a href="#InfoStopData-1445"><span class="linenos">1445</span></a><span class="sd">        output_dir (str): Path to the main output directory.</span>
</span><span id="InfoStopData-1446"><a href="#InfoStopData-1446"><span class="linenos">1446</span></a><span class="sd">        output_dir_animal (str): Path to the output directory for the</span>
</span><span id="InfoStopData-1447"><a href="#InfoStopData-1447"><span class="linenos">1447</span></a><span class="sd">            specific animal.</span>
</span><span id="InfoStopData-1448"><a href="#InfoStopData-1448"><span class="linenos">1448</span></a><span class="sd">        pdf (FPDF): FPDF object used for generating PDF reports.</span>
</span><span id="InfoStopData-1449"><a href="#InfoStopData-1449"><span class="linenos">1449</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="InfoStopData-1450"><a href="#InfoStopData-1450"><span class="linenos">1450</span></a>
</span><span id="InfoStopData-1451"><a href="#InfoStopData-1451"><span class="linenos">1451</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="InfoStopData-1452"><a href="#InfoStopData-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="InfoStopData-1453"><a href="#InfoStopData-1453"><span class="linenos">1453</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfoStopData-1454"><a href="#InfoStopData-1454"><span class="linenos">1454</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfoStopData-1455"><a href="#InfoStopData-1455"><span class="linenos">1455</span></a><span class="sd">        Initializes the InfoStopData object, creates an output directory,</span>
</span><span id="InfoStopData-1456"><a href="#InfoStopData-1456"><span class="linenos">1456</span></a><span class="sd">        and sets up a PDF report.</span>
</span><span id="InfoStopData-1457"><a href="#InfoStopData-1457"><span class="linenos">1457</span></a>
</span><span id="InfoStopData-1458"><a href="#InfoStopData-1458"><span class="linenos">1458</span></a><span class="sd">        Args:</span>
</span><span id="InfoStopData-1459"><a href="#InfoStopData-1459"><span class="linenos">1459</span></a><span class="sd">            data (TrajectoriesFrame): The input data for analysis.</span>
</span><span id="InfoStopData-1460"><a href="#InfoStopData-1460"><span class="linenos">1460</span></a><span class="sd">            data_name (str): The name of the analyzed animal.</span>
</span><span id="InfoStopData-1461"><a href="#InfoStopData-1461"><span class="linenos">1461</span></a><span class="sd">            output_dir (str): Path to the main output directory.</span>
</span><span id="InfoStopData-1462"><a href="#InfoStopData-1462"><span class="linenos">1462</span></a>
</span><span id="InfoStopData-1463"><a href="#InfoStopData-1463"><span class="linenos">1463</span></a><span class="sd">        Raises:</span>
</span><span id="InfoStopData-1464"><a href="#InfoStopData-1464"><span class="linenos">1464</span></a><span class="sd">            FileExistsError: If the output directory for the animal</span>
</span><span id="InfoStopData-1465"><a href="#InfoStopData-1465"><span class="linenos">1465</span></a><span class="sd">                already exists.</span>
</span><span id="InfoStopData-1466"><a href="#InfoStopData-1466"><span class="linenos">1466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfoStopData-1467"><a href="#InfoStopData-1467"><span class="linenos">1467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="InfoStopData-1468"><a href="#InfoStopData-1468"><span class="linenos">1468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span> <span class="o">=</span> <span class="n">data_name</span>
</span><span id="InfoStopData-1469"><a href="#InfoStopData-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="InfoStopData-1470"><a href="#InfoStopData-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">)</span>
</span><span id="InfoStopData-1471"><a href="#InfoStopData-1471"><span class="linenos">1471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">FPDF</span><span class="p">()</span>
</span><span id="InfoStopData-1472"><a href="#InfoStopData-1472"><span class="linenos">1472</span></a>
</span><span id="InfoStopData-1473"><a href="#InfoStopData-1473"><span class="linenos">1473</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="InfoStopData-1474"><a href="#InfoStopData-1474"><span class="linenos">1474</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData-1475"><a href="#InfoStopData-1475"><span class="linenos">1475</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="InfoStopData-1476"><a href="#InfoStopData-1476"><span class="linenos">1476</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
</span><span id="InfoStopData-1477"><a href="#InfoStopData-1477"><span class="linenos">1477</span></a>                <span class="sa">f</span><span class="s2">&quot;The directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="si">}</span><span class="s2"> already exists. &quot;</span>
</span><span id="InfoStopData-1478"><a href="#InfoStopData-1478"><span class="linenos">1478</span></a>                <span class="sa">f</span><span class="s2">&quot;Please remove it or specify a different name.&quot;</span>
</span><span id="InfoStopData-1479"><a href="#InfoStopData-1479"><span class="linenos">1479</span></a>            <span class="p">)</span>
</span><span id="InfoStopData-1480"><a href="#InfoStopData-1480"><span class="linenos">1480</span></a>
</span><span id="InfoStopData-1481"><a href="#InfoStopData-1481"><span class="linenos">1481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="InfoStopData-1482"><a href="#InfoStopData-1482"><span class="linenos">1482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><span id="InfoStopData-1483"><a href="#InfoStopData-1483"><span class="linenos">1483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
</span><span id="InfoStopData-1484"><a href="#InfoStopData-1484"><span class="linenos">1484</span></a>
</span><span id="InfoStopData-1485"><a href="#InfoStopData-1485"><span class="linenos">1485</span></a>    <span class="k">def</span> <span class="nf">calculate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfoStopData-1486"><a href="#InfoStopData-1486"><span class="linenos">1486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfoStopData-1487"><a href="#InfoStopData-1487"><span class="linenos">1487</span></a><span class="sd">        Performs a complete analysis of the data, generates reports</span>
</span><span id="InfoStopData-1488"><a href="#InfoStopData-1488"><span class="linenos">1488</span></a><span class="sd">        in PDF format, and saves the results to a CSV file.</span>
</span><span id="InfoStopData-1489"><a href="#InfoStopData-1489"><span class="linenos">1489</span></a>
</span><span id="InfoStopData-1490"><a href="#InfoStopData-1490"><span class="linenos">1490</span></a><span class="sd">        Process:</span>
</span><span id="InfoStopData-1491"><a href="#InfoStopData-1491"><span class="linenos">1491</span></a><span class="sd">            1. Generates an initial report.</span>
</span><span id="InfoStopData-1492"><a href="#InfoStopData-1492"><span class="linenos">1492</span></a><span class="sd">            2. Selects the best period of data.</span>
</span><span id="InfoStopData-1493"><a href="#InfoStopData-1493"><span class="linenos">1493</span></a><span class="sd">            3. Filters the data.</span>
</span><span id="InfoStopData-1494"><a href="#InfoStopData-1494"><span class="linenos">1494</span></a><span class="sd">            4. Sorts the data.</span>
</span><span id="InfoStopData-1495"><a href="#InfoStopData-1495"><span class="linenos">1495</span></a><span class="sd">            5. Processes the data using the infostop module.</span>
</span><span id="InfoStopData-1496"><a href="#InfoStopData-1496"><span class="linenos">1496</span></a><span class="sd">            6. Exports results to CSV and PDF files.</span>
</span><span id="InfoStopData-1497"><a href="#InfoStopData-1497"><span class="linenos">1497</span></a>
</span><span id="InfoStopData-1498"><a href="#InfoStopData-1498"><span class="linenos">1498</span></a><span class="sd">        Raises:</span>
</span><span id="InfoStopData-1499"><a href="#InfoStopData-1499"><span class="linenos">1499</span></a><span class="sd">            FileNotFoundError: If a required file is missing during</span>
</span><span id="InfoStopData-1500"><a href="#InfoStopData-1500"><span class="linenos">1500</span></a><span class="sd">                the process.</span>
</span><span id="InfoStopData-1501"><a href="#InfoStopData-1501"><span class="linenos">1501</span></a><span class="sd">            ValueError: If the data contains invalid values.</span>
</span><span id="InfoStopData-1502"><a href="#InfoStopData-1502"><span class="linenos">1502</span></a><span class="sd">            Exception: For any unexpected errors that occur during</span>
</span><span id="InfoStopData-1503"><a href="#InfoStopData-1503"><span class="linenos">1503</span></a><span class="sd">                the process.</span>
</span><span id="InfoStopData-1504"><a href="#InfoStopData-1504"><span class="linenos">1504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfoStopData-1505"><a href="#InfoStopData-1505"><span class="linenos">1505</span></a>
</span><span id="InfoStopData-1506"><a href="#InfoStopData-1506"><span class="linenos">1506</span></a>        <span class="n">raport</span> <span class="o">=</span> <span class="n">DataAnalystInfostop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData-1507"><a href="#InfoStopData-1507"><span class="linenos">1507</span></a>        <span class="nb">filter</span> <span class="o">=</span> <span class="n">DataFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">)</span>
</span><span id="InfoStopData-1508"><a href="#InfoStopData-1508"><span class="linenos">1508</span></a>        <span class="n">labels_calculator</span> <span class="o">=</span> <span class="n">LabelsCalc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData-1509"><a href="#InfoStopData-1509"><span class="linenos">1509</span></a>
</span><span id="InfoStopData-1510"><a href="#InfoStopData-1510"><span class="linenos">1510</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="InfoStopData-1511"><a href="#InfoStopData-1511"><span class="linenos">1511</span></a>            <span class="c1"># Step 1: Generate the initial report</span>
</span><span id="InfoStopData-1512"><a href="#InfoStopData-1512"><span class="linenos">1512</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="InfoStopData-1513"><a href="#InfoStopData-1513"><span class="linenos">1513</span></a>
</span><span id="InfoStopData-1514"><a href="#InfoStopData-1514"><span class="linenos">1514</span></a>            <span class="c1"># Step 2: Select the best period of data</span>
</span><span id="InfoStopData-1515"><a href="#InfoStopData-1515"><span class="linenos">1515</span></a>            <span class="n">extracted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">select_best_period</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">)</span>
</span><span id="InfoStopData-1516"><a href="#InfoStopData-1516"><span class="linenos">1516</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="InfoStopData-1517"><a href="#InfoStopData-1517"><span class="linenos">1517</span></a>
</span><span id="InfoStopData-1518"><a href="#InfoStopData-1518"><span class="linenos">1518</span></a>            <span class="c1"># Step 3: Filter the data</span>
</span><span id="InfoStopData-1519"><a href="#InfoStopData-1519"><span class="linenos">1519</span></a>            <span class="n">filtred_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">filter_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">)</span>
</span><span id="InfoStopData-1520"><a href="#InfoStopData-1520"><span class="linenos">1520</span></a>
</span><span id="InfoStopData-1521"><a href="#InfoStopData-1521"><span class="linenos">1521</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="InfoStopData-1522"><a href="#InfoStopData-1522"><span class="linenos">1522</span></a>                <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filtred_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="InfoStopData-1523"><a href="#InfoStopData-1523"><span class="linenos">1523</span></a>
</span><span id="InfoStopData-1524"><a href="#InfoStopData-1524"><span class="linenos">1524</span></a>                <span class="c1"># Step 4: Sort the data</span>
</span><span id="InfoStopData-1525"><a href="#InfoStopData-1525"><span class="linenos">1525</span></a>                <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span>
</span><span id="InfoStopData-1526"><a href="#InfoStopData-1526"><span class="linenos">1526</span></a>
</span><span id="InfoStopData-1527"><a href="#InfoStopData-1527"><span class="linenos">1527</span></a>
</span><span id="InfoStopData-1528"><a href="#InfoStopData-1528"><span class="linenos">1528</span></a>                <span class="c1"># Step 5: Process data with the infostop module</span>
</span><span id="InfoStopData-1529"><a href="#InfoStopData-1529"><span class="linenos">1529</span></a>                <span class="n">trajectory_processed_data</span> <span class="o">=</span> <span class="n">labels_calculator</span><span class="o">.</span><span class="n">calculate_infostop</span><span class="p">(</span>
</span><span id="InfoStopData-1530"><a href="#InfoStopData-1530"><span class="linenos">1530</span></a>                    <span class="n">sorted_data</span>
</span><span id="InfoStopData-1531"><a href="#InfoStopData-1531"><span class="linenos">1531</span></a>                <span class="p">)</span>
</span><span id="InfoStopData-1532"><a href="#InfoStopData-1532"><span class="linenos">1532</span></a>
</span><span id="InfoStopData-1533"><a href="#InfoStopData-1533"><span class="linenos">1533</span></a>                <span class="c1"># Save results to CSV</span>
</span><span id="InfoStopData-1534"><a href="#InfoStopData-1534"><span class="linenos">1534</span></a>                <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData-1535"><a href="#InfoStopData-1535"><span class="linenos">1535</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="InfoStopData-1536"><a href="#InfoStopData-1536"><span class="linenos">1536</span></a>                    <span class="sa">f</span><span class="s2">&quot;Trajectory_processed_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
</span><span id="InfoStopData-1537"><a href="#InfoStopData-1537"><span class="linenos">1537</span></a>                <span class="p">)</span>
</span><span id="InfoStopData-1538"><a href="#InfoStopData-1538"><span class="linenos">1538</span></a>                <span class="n">trajectory_processed_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="InfoStopData-1539"><a href="#InfoStopData-1539"><span class="linenos">1539</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InfoStopData-1540"><a href="#InfoStopData-1540"><span class="linenos">1540</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No animals after filtration&#39;</span><span class="p">)</span>
</span><span id="InfoStopData-1541"><a href="#InfoStopData-1541"><span class="linenos">1541</span></a>
</span><span id="InfoStopData-1542"><a href="#InfoStopData-1542"><span class="linenos">1542</span></a>            <span class="c1"># Save report to PDF</span>
</span><span id="InfoStopData-1543"><a href="#InfoStopData-1543"><span class="linenos">1543</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData-1544"><a href="#InfoStopData-1544"><span class="linenos">1544</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="InfoStopData-1545"><a href="#InfoStopData-1545"><span class="linenos">1545</span></a>            <span class="p">)</span>
</span><span id="InfoStopData-1546"><a href="#InfoStopData-1546"><span class="linenos">1546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="InfoStopData-1547"><a href="#InfoStopData-1547"><span class="linenos">1547</span></a>
</span><span id="InfoStopData-1548"><a href="#InfoStopData-1548"><span class="linenos">1548</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData-1549"><a href="#InfoStopData-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData-1550"><a href="#InfoStopData-1550"><span class="linenos">1550</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData-1551"><a href="#InfoStopData-1551"><span class="linenos">1551</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData-1552"><a href="#InfoStopData-1552"><span class="linenos">1552</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData-1553"><a href="#InfoStopData-1553"><span class="linenos">1553</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData-1554"><a href="#InfoStopData-1554"><span class="linenos">1554</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData-1555"><a href="#InfoStopData-1555"><span class="linenos">1555</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData-1556"><a href="#InfoStopData-1556"><span class="linenos">1556</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData-1557"><a href="#InfoStopData-1557"><span class="linenos">1557</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="InfoStopData-1558"><a href="#InfoStopData-1558"><span class="linenos">1558</span></a>            <span class="c1"># Ensure the PDF is saved even if an error occurs</span>
</span><span id="InfoStopData-1559"><a href="#InfoStopData-1559"><span class="linenos">1559</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData-1560"><a href="#InfoStopData-1560"><span class="linenos">1560</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="InfoStopData-1561"><a href="#InfoStopData-1561"><span class="linenos">1561</span></a>            <span class="p">)</span>
</span><span id="InfoStopData-1562"><a href="#InfoStopData-1562"><span class="linenos">1562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class responsible for analyzing animal data and generating reports in
PDF and CSV formats.</p>

<p>Attributes:
    clean_data (TrajectoriesFrame): Raw input data related to animals.
    animal_name (str): The name of the analyzed animal.
    output_dir (str): Path to the main output directory.
    output_dir_animal (str): Path to the output directory for the
        specific animal.
    pdf (FPDF): FPDF object used for generating PDF reports.</p>
</div>


                            <div id="InfoStopData.__init__" class="classattr">
                                        <input id="InfoStopData.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">InfoStopData</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">humobi</span><span class="o">.</span><span class="n">structures</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">TrajectoriesFrame</span>,</span><span class="param">	<span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="InfoStopData.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfoStopData.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InfoStopData.__init__-1451"><a href="#InfoStopData.__init__-1451"><span class="linenos">1451</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="InfoStopData.__init__-1452"><a href="#InfoStopData.__init__-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">TrajectoriesFrame</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="InfoStopData.__init__-1453"><a href="#InfoStopData.__init__-1453"><span class="linenos">1453</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfoStopData.__init__-1454"><a href="#InfoStopData.__init__-1454"><span class="linenos">1454</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfoStopData.__init__-1455"><a href="#InfoStopData.__init__-1455"><span class="linenos">1455</span></a><span class="sd">        Initializes the InfoStopData object, creates an output directory,</span>
</span><span id="InfoStopData.__init__-1456"><a href="#InfoStopData.__init__-1456"><span class="linenos">1456</span></a><span class="sd">        and sets up a PDF report.</span>
</span><span id="InfoStopData.__init__-1457"><a href="#InfoStopData.__init__-1457"><span class="linenos">1457</span></a>
</span><span id="InfoStopData.__init__-1458"><a href="#InfoStopData.__init__-1458"><span class="linenos">1458</span></a><span class="sd">        Args:</span>
</span><span id="InfoStopData.__init__-1459"><a href="#InfoStopData.__init__-1459"><span class="linenos">1459</span></a><span class="sd">            data (TrajectoriesFrame): The input data for analysis.</span>
</span><span id="InfoStopData.__init__-1460"><a href="#InfoStopData.__init__-1460"><span class="linenos">1460</span></a><span class="sd">            data_name (str): The name of the analyzed animal.</span>
</span><span id="InfoStopData.__init__-1461"><a href="#InfoStopData.__init__-1461"><span class="linenos">1461</span></a><span class="sd">            output_dir (str): Path to the main output directory.</span>
</span><span id="InfoStopData.__init__-1462"><a href="#InfoStopData.__init__-1462"><span class="linenos">1462</span></a>
</span><span id="InfoStopData.__init__-1463"><a href="#InfoStopData.__init__-1463"><span class="linenos">1463</span></a><span class="sd">        Raises:</span>
</span><span id="InfoStopData.__init__-1464"><a href="#InfoStopData.__init__-1464"><span class="linenos">1464</span></a><span class="sd">            FileExistsError: If the output directory for the animal</span>
</span><span id="InfoStopData.__init__-1465"><a href="#InfoStopData.__init__-1465"><span class="linenos">1465</span></a><span class="sd">                already exists.</span>
</span><span id="InfoStopData.__init__-1466"><a href="#InfoStopData.__init__-1466"><span class="linenos">1466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfoStopData.__init__-1467"><a href="#InfoStopData.__init__-1467"><span class="linenos">1467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="InfoStopData.__init__-1468"><a href="#InfoStopData.__init__-1468"><span class="linenos">1468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span> <span class="o">=</span> <span class="n">data_name</span>
</span><span id="InfoStopData.__init__-1469"><a href="#InfoStopData.__init__-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="InfoStopData.__init__-1470"><a href="#InfoStopData.__init__-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">)</span>
</span><span id="InfoStopData.__init__-1471"><a href="#InfoStopData.__init__-1471"><span class="linenos">1471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">FPDF</span><span class="p">()</span>
</span><span id="InfoStopData.__init__-1472"><a href="#InfoStopData.__init__-1472"><span class="linenos">1472</span></a>
</span><span id="InfoStopData.__init__-1473"><a href="#InfoStopData.__init__-1473"><span class="linenos">1473</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="InfoStopData.__init__-1474"><a href="#InfoStopData.__init__-1474"><span class="linenos">1474</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData.__init__-1475"><a href="#InfoStopData.__init__-1475"><span class="linenos">1475</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="InfoStopData.__init__-1476"><a href="#InfoStopData.__init__-1476"><span class="linenos">1476</span></a>            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
</span><span id="InfoStopData.__init__-1477"><a href="#InfoStopData.__init__-1477"><span class="linenos">1477</span></a>                <span class="sa">f</span><span class="s2">&quot;The directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="si">}</span><span class="s2"> already exists. &quot;</span>
</span><span id="InfoStopData.__init__-1478"><a href="#InfoStopData.__init__-1478"><span class="linenos">1478</span></a>                <span class="sa">f</span><span class="s2">&quot;Please remove it or specify a different name.&quot;</span>
</span><span id="InfoStopData.__init__-1479"><a href="#InfoStopData.__init__-1479"><span class="linenos">1479</span></a>            <span class="p">)</span>
</span><span id="InfoStopData.__init__-1480"><a href="#InfoStopData.__init__-1480"><span class="linenos">1480</span></a>
</span><span id="InfoStopData.__init__-1481"><a href="#InfoStopData.__init__-1481"><span class="linenos">1481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">add_page</span><span class="p">()</span>
</span><span id="InfoStopData.__init__-1482"><a href="#InfoStopData.__init__-1482"><span class="linenos">1482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><span id="InfoStopData.__init__-1483"><a href="#InfoStopData.__init__-1483"><span class="linenos">1483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the InfoStopData object, creates an output directory,
and sets up a PDF report.</p>

<p>Args:
    data (TrajectoriesFrame): The input data for analysis.
    data_name (str): The name of the analyzed animal.
    output_dir (str): Path to the main output directory.</p>

<p>Raises:
    FileExistsError: If the output directory for the animal
        already exists.</p>
</div>


                            </div>
                            <div id="InfoStopData.clean_data" class="classattr">
                                <div class="attr variable">
            <span class="name">clean_data</span>

        
    </div>
    <a class="headerlink" href="#InfoStopData.clean_data"></a>
    
    

                            </div>
                            <div id="InfoStopData.animal_name" class="classattr">
                                <div class="attr variable">
            <span class="name">animal_name</span>

        
    </div>
    <a class="headerlink" href="#InfoStopData.animal_name"></a>
    
    

                            </div>
                            <div id="InfoStopData.output_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">output_dir</span>

        
    </div>
    <a class="headerlink" href="#InfoStopData.output_dir"></a>
    
    

                            </div>
                            <div id="InfoStopData.output_dir_animal" class="classattr">
                                <div class="attr variable">
            <span class="name">output_dir_animal</span>

        
    </div>
    <a class="headerlink" href="#InfoStopData.output_dir_animal"></a>
    
    

                            </div>
                            <div id="InfoStopData.pdf" class="classattr">
                                <div class="attr variable">
            <span class="name">pdf</span>

        
    </div>
    <a class="headerlink" href="#InfoStopData.pdf"></a>
    
    

                            </div>
                            <div id="InfoStopData.calculate_all" class="classattr">
                                        <input id="InfoStopData.calculate_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="InfoStopData.calculate_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfoStopData.calculate_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InfoStopData.calculate_all-1485"><a href="#InfoStopData.calculate_all-1485"><span class="linenos">1485</span></a>    <span class="k">def</span> <span class="nf">calculate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1486"><a href="#InfoStopData.calculate_all-1486"><span class="linenos">1486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfoStopData.calculate_all-1487"><a href="#InfoStopData.calculate_all-1487"><span class="linenos">1487</span></a><span class="sd">        Performs a complete analysis of the data, generates reports</span>
</span><span id="InfoStopData.calculate_all-1488"><a href="#InfoStopData.calculate_all-1488"><span class="linenos">1488</span></a><span class="sd">        in PDF format, and saves the results to a CSV file.</span>
</span><span id="InfoStopData.calculate_all-1489"><a href="#InfoStopData.calculate_all-1489"><span class="linenos">1489</span></a>
</span><span id="InfoStopData.calculate_all-1490"><a href="#InfoStopData.calculate_all-1490"><span class="linenos">1490</span></a><span class="sd">        Process:</span>
</span><span id="InfoStopData.calculate_all-1491"><a href="#InfoStopData.calculate_all-1491"><span class="linenos">1491</span></a><span class="sd">            1. Generates an initial report.</span>
</span><span id="InfoStopData.calculate_all-1492"><a href="#InfoStopData.calculate_all-1492"><span class="linenos">1492</span></a><span class="sd">            2. Selects the best period of data.</span>
</span><span id="InfoStopData.calculate_all-1493"><a href="#InfoStopData.calculate_all-1493"><span class="linenos">1493</span></a><span class="sd">            3. Filters the data.</span>
</span><span id="InfoStopData.calculate_all-1494"><a href="#InfoStopData.calculate_all-1494"><span class="linenos">1494</span></a><span class="sd">            4. Sorts the data.</span>
</span><span id="InfoStopData.calculate_all-1495"><a href="#InfoStopData.calculate_all-1495"><span class="linenos">1495</span></a><span class="sd">            5. Processes the data using the infostop module.</span>
</span><span id="InfoStopData.calculate_all-1496"><a href="#InfoStopData.calculate_all-1496"><span class="linenos">1496</span></a><span class="sd">            6. Exports results to CSV and PDF files.</span>
</span><span id="InfoStopData.calculate_all-1497"><a href="#InfoStopData.calculate_all-1497"><span class="linenos">1497</span></a>
</span><span id="InfoStopData.calculate_all-1498"><a href="#InfoStopData.calculate_all-1498"><span class="linenos">1498</span></a><span class="sd">        Raises:</span>
</span><span id="InfoStopData.calculate_all-1499"><a href="#InfoStopData.calculate_all-1499"><span class="linenos">1499</span></a><span class="sd">            FileNotFoundError: If a required file is missing during</span>
</span><span id="InfoStopData.calculate_all-1500"><a href="#InfoStopData.calculate_all-1500"><span class="linenos">1500</span></a><span class="sd">                the process.</span>
</span><span id="InfoStopData.calculate_all-1501"><a href="#InfoStopData.calculate_all-1501"><span class="linenos">1501</span></a><span class="sd">            ValueError: If the data contains invalid values.</span>
</span><span id="InfoStopData.calculate_all-1502"><a href="#InfoStopData.calculate_all-1502"><span class="linenos">1502</span></a><span class="sd">            Exception: For any unexpected errors that occur during</span>
</span><span id="InfoStopData.calculate_all-1503"><a href="#InfoStopData.calculate_all-1503"><span class="linenos">1503</span></a><span class="sd">                the process.</span>
</span><span id="InfoStopData.calculate_all-1504"><a href="#InfoStopData.calculate_all-1504"><span class="linenos">1504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfoStopData.calculate_all-1505"><a href="#InfoStopData.calculate_all-1505"><span class="linenos">1505</span></a>
</span><span id="InfoStopData.calculate_all-1506"><a href="#InfoStopData.calculate_all-1506"><span class="linenos">1506</span></a>        <span class="n">raport</span> <span class="o">=</span> <span class="n">DataAnalystInfostop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1507"><a href="#InfoStopData.calculate_all-1507"><span class="linenos">1507</span></a>        <span class="nb">filter</span> <span class="o">=</span> <span class="n">DataFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1508"><a href="#InfoStopData.calculate_all-1508"><span class="linenos">1508</span></a>        <span class="n">labels_calculator</span> <span class="o">=</span> <span class="n">LabelsCalc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1509"><a href="#InfoStopData.calculate_all-1509"><span class="linenos">1509</span></a>
</span><span id="InfoStopData.calculate_all-1510"><a href="#InfoStopData.calculate_all-1510"><span class="linenos">1510</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1511"><a href="#InfoStopData.calculate_all-1511"><span class="linenos">1511</span></a>            <span class="c1"># Step 1: Generate the initial report</span>
</span><span id="InfoStopData.calculate_all-1512"><a href="#InfoStopData.calculate_all-1512"><span class="linenos">1512</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1513"><a href="#InfoStopData.calculate_all-1513"><span class="linenos">1513</span></a>
</span><span id="InfoStopData.calculate_all-1514"><a href="#InfoStopData.calculate_all-1514"><span class="linenos">1514</span></a>            <span class="c1"># Step 2: Select the best period of data</span>
</span><span id="InfoStopData.calculate_all-1515"><a href="#InfoStopData.calculate_all-1515"><span class="linenos">1515</span></a>            <span class="n">extracted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">select_best_period</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_data</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1516"><a href="#InfoStopData.calculate_all-1516"><span class="linenos">1516</span></a>            <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1517"><a href="#InfoStopData.calculate_all-1517"><span class="linenos">1517</span></a>
</span><span id="InfoStopData.calculate_all-1518"><a href="#InfoStopData.calculate_all-1518"><span class="linenos">1518</span></a>            <span class="c1"># Step 3: Filter the data</span>
</span><span id="InfoStopData.calculate_all-1519"><a href="#InfoStopData.calculate_all-1519"><span class="linenos">1519</span></a>            <span class="n">filtred_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">filter_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1520"><a href="#InfoStopData.calculate_all-1520"><span class="linenos">1520</span></a>
</span><span id="InfoStopData.calculate_all-1521"><a href="#InfoStopData.calculate_all-1521"><span class="linenos">1521</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1522"><a href="#InfoStopData.calculate_all-1522"><span class="linenos">1522</span></a>                <span class="n">raport</span><span class="o">.</span><span class="n">generate_raport</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filtred_data</span><span class="p">,</span> <span class="n">data_analyst_no</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1523"><a href="#InfoStopData.calculate_all-1523"><span class="linenos">1523</span></a>
</span><span id="InfoStopData.calculate_all-1524"><a href="#InfoStopData.calculate_all-1524"><span class="linenos">1524</span></a>                <span class="c1"># Step 4: Sort the data</span>
</span><span id="InfoStopData.calculate_all-1525"><a href="#InfoStopData.calculate_all-1525"><span class="linenos">1525</span></a>                <span class="n">sorted_data</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="n">filtred_data</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1526"><a href="#InfoStopData.calculate_all-1526"><span class="linenos">1526</span></a>
</span><span id="InfoStopData.calculate_all-1527"><a href="#InfoStopData.calculate_all-1527"><span class="linenos">1527</span></a>
</span><span id="InfoStopData.calculate_all-1528"><a href="#InfoStopData.calculate_all-1528"><span class="linenos">1528</span></a>                <span class="c1"># Step 5: Process data with the infostop module</span>
</span><span id="InfoStopData.calculate_all-1529"><a href="#InfoStopData.calculate_all-1529"><span class="linenos">1529</span></a>                <span class="n">trajectory_processed_data</span> <span class="o">=</span> <span class="n">labels_calculator</span><span class="o">.</span><span class="n">calculate_infostop</span><span class="p">(</span>
</span><span id="InfoStopData.calculate_all-1530"><a href="#InfoStopData.calculate_all-1530"><span class="linenos">1530</span></a>                    <span class="n">sorted_data</span>
</span><span id="InfoStopData.calculate_all-1531"><a href="#InfoStopData.calculate_all-1531"><span class="linenos">1531</span></a>                <span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1532"><a href="#InfoStopData.calculate_all-1532"><span class="linenos">1532</span></a>
</span><span id="InfoStopData.calculate_all-1533"><a href="#InfoStopData.calculate_all-1533"><span class="linenos">1533</span></a>                <span class="c1"># Save results to CSV</span>
</span><span id="InfoStopData.calculate_all-1534"><a href="#InfoStopData.calculate_all-1534"><span class="linenos">1534</span></a>                <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData.calculate_all-1535"><a href="#InfoStopData.calculate_all-1535"><span class="linenos">1535</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="InfoStopData.calculate_all-1536"><a href="#InfoStopData.calculate_all-1536"><span class="linenos">1536</span></a>                    <span class="sa">f</span><span class="s2">&quot;Trajectory_processed_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.csv&quot;</span>
</span><span id="InfoStopData.calculate_all-1537"><a href="#InfoStopData.calculate_all-1537"><span class="linenos">1537</span></a>                <span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1538"><a href="#InfoStopData.calculate_all-1538"><span class="linenos">1538</span></a>                <span class="n">trajectory_processed_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1539"><a href="#InfoStopData.calculate_all-1539"><span class="linenos">1539</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1540"><a href="#InfoStopData.calculate_all-1540"><span class="linenos">1540</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No animals after filtration&#39;</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1541"><a href="#InfoStopData.calculate_all-1541"><span class="linenos">1541</span></a>
</span><span id="InfoStopData.calculate_all-1542"><a href="#InfoStopData.calculate_all-1542"><span class="linenos">1542</span></a>            <span class="c1"># Save report to PDF</span>
</span><span id="InfoStopData.calculate_all-1543"><a href="#InfoStopData.calculate_all-1543"><span class="linenos">1543</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData.calculate_all-1544"><a href="#InfoStopData.calculate_all-1544"><span class="linenos">1544</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="InfoStopData.calculate_all-1545"><a href="#InfoStopData.calculate_all-1545"><span class="linenos">1545</span></a>            <span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1546"><a href="#InfoStopData.calculate_all-1546"><span class="linenos">1546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1547"><a href="#InfoStopData.calculate_all-1547"><span class="linenos">1547</span></a>
</span><span id="InfoStopData.calculate_all-1548"><a href="#InfoStopData.calculate_all-1548"><span class="linenos">1548</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1549"><a href="#InfoStopData.calculate_all-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1550"><a href="#InfoStopData.calculate_all-1550"><span class="linenos">1550</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData.calculate_all-1551"><a href="#InfoStopData.calculate_all-1551"><span class="linenos">1551</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1552"><a href="#InfoStopData.calculate_all-1552"><span class="linenos">1552</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1553"><a href="#InfoStopData.calculate_all-1553"><span class="linenos">1553</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData.calculate_all-1554"><a href="#InfoStopData.calculate_all-1554"><span class="linenos">1554</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1555"><a href="#InfoStopData.calculate_all-1555"><span class="linenos">1555</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1556"><a href="#InfoStopData.calculate_all-1556"><span class="linenos">1556</span></a>            <span class="k">raise</span>
</span><span id="InfoStopData.calculate_all-1557"><a href="#InfoStopData.calculate_all-1557"><span class="linenos">1557</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="InfoStopData.calculate_all-1558"><a href="#InfoStopData.calculate_all-1558"><span class="linenos">1558</span></a>            <span class="c1"># Ensure the PDF is saved even if an error occurs</span>
</span><span id="InfoStopData.calculate_all-1559"><a href="#InfoStopData.calculate_all-1559"><span class="linenos">1559</span></a>            <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="InfoStopData.calculate_all-1560"><a href="#InfoStopData.calculate_all-1560"><span class="linenos">1560</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_animal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">animal_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
</span><span id="InfoStopData.calculate_all-1561"><a href="#InfoStopData.calculate_all-1561"><span class="linenos">1561</span></a>            <span class="p">)</span>
</span><span id="InfoStopData.calculate_all-1562"><a href="#InfoStopData.calculate_all-1562"><span class="linenos">1562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs a complete analysis of the data, generates reports
in PDF format, and saves the results to a CSV file.</p>

<p>Process:
    1. Generates an initial report.
    2. Selects the best period of data.
    3. Filters the data.
    4. Sorts the data.
    5. Processes the data using the infostop module.
    6. Exports results to CSV and PDF files.</p>

<p>Raises:
    FileNotFoundError: If a required file is missing during
        the process.
    ValueError: If the data contains invalid values.
    Exception: For any unexpected errors that occur during
        the process.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>